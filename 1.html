<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Factory Management System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f8fafc;
            color: #334155;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Navigation */
        .nav-tabs {
            display: flex;
            background: white;
            border-radius: 12px;
            padding: 8px;
            margin-bottom: 24px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            gap: 4px;
            overflow-x: auto;
        }

        .nav-tab {
            padding: 12px 20px;
            border: none;
            background: transparent;
            color: #64748b;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            white-space: nowrap;
            font-weight: 500;
        }

        .nav-tab.active {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }

        .nav-tab:hover:not(.active) {
            background: #f1f5f9;
            color: #475569;
        }

        /* Page Content */
        .page {
            display: none;
            animation: fadeIn 0.3s ease-in;
        }

        .page.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Cards */
        .card {
            background: white;
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            margin-bottom: 24px;
            border: 1px solid #e2e8f0;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 16px;
            border-bottom: 1px solid #e2e8f0;
        }

        .card-title {
            font-size: 20px;
            font-weight: 600;
            color: #1e293b;
        }

        /* Login Form */
        .login-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
        }

        .login-card {
            background: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 400px;
            text-align: center;
        }

        .login-header {
            margin-bottom: 32px;
        }

        .login-title {
            font-size: 28px;
            font-weight: 700;
            color: #1e293b;
            margin-bottom: 8px;
        }

        .login-subtitle {
            color: #64748b;
            font-size: 16px;
        }

        .form-group {
            margin-bottom: 20px;
            text-align: left;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #374151;
        }

        .form-input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            font-size: 16px;
            transition: all 0.2s;
            background: #fafafa;
        }

        .form-input:focus {
            outline: none;
            border-color: #3b82f6;
            background: white;
            box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.1);
        }

        .form-select {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            font-size: 16px;
            background: #fafafa;
            cursor: pointer;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
        }

        .btn-primary {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            color: white;
            width: 100%;
            justify-content: center;
            font-size: 16px;
            padding: 14px;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(59, 130, 246, 0.3);
        }

        .btn-secondary {
            background: #f8fafc;
            color: #475569;
            border: 1px solid #e2e8f0;
        }

        .btn-success {
            background: #10b981;
            color: white;
        }

        .btn-warning {
            background: #f59e0b;
            color: white;
        }

        .btn-danger {
            background: #ef4444;
            color: white;
        }

        .btn-sm {
            padding: 8px 16px;
            font-size: 14px;
        }

        /* Dashboard Stats */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 32px;
        }

        .stat-card {
            background: white;
            padding: 24px;
            border-radius: 16px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            border-left: 4px solid #3b82f6;
            transition: transform 0.2s;
        }

        .stat-card:hover {
            transform: translateY(-2px);
        }

        .stat-card:nth-child(2) { border-left-color: #10b981; }
        .stat-card:nth-child(3) { border-left-color: #f59e0b; }
        .stat-card:nth-child(4) { border-left-color: #ef4444; }

        .stat-number {
            font-size: 32px;
            font-weight: 700;
            color: #1e293b;
            margin-bottom: 4px;
        }

        .stat-label {
            color: #64748b;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Tables */
        .table-container {
            overflow-x: auto;
            border-radius: 12px;
            border: 1px solid #e2e8f0;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
            background: white;
        }

        .table th,
        .table td {
            padding: 16px;
            text-align: left;
            border-bottom: 1px solid #e2e8f0;
        }

        .table th {
            background: #f8fafc;
            font-weight: 600;
            color: #374151;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .table tbody tr:hover {
            background: #f8fafc;
        }

        /* Status Badges */
        .status-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .status-pending {
            background: #fef3c7;
            color: #92400e;
        }

        .status-processing {
            background: #dbeafe;
            color: #1e40af;
        }

        .status-ready {
            background: #d1fae5;
            color: #065f46;
        }

        .status-shipped {
            background: #e0e7ff;
            color: #3730a3;
        }

        /* Forms */
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 24px;
        }

        .form-row {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-row .form-group {
            flex: 1;
        }

        /* Charts Placeholder */
        .chart-placeholder {
            height: 300px;
            background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #64748b;
            font-size: 18px;
            font-weight: 500;
            border: 2px dashed #cbd5e1;
        }

        /* Alerts */
        .alert {
            padding: 16px;
            border-radius: 12px;
            margin-bottom: 20px;
            border-left: 4px solid;
        }

        .alert-warning {
            background: #fffbeb;
            border-color: #f59e0b;
            color: #92400e;
        }

        .alert-success {
            background: #ecfdf5;
            border-color: #10b981;
            color: #065f46;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #64748b;
        }

        .empty-state h3 {
            font-size: 20px;
            margin-bottom: 8px;
            color: #374151;
        }

        .empty-state p {
            font-size: 16px;
            margin-bottom: 24px;
        }

        /* Raw Material Styles */
        .raw-material-tab {
            transition: all 0.2s;
            border-radius: 6px !important;
        }
        
        .raw-material-tab.active {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%) !important;
            color: white !important;
        }
        
        .raw-material-tab:not(.active):hover {
            background: #e2e8f0 !important;
            color: #374151 !important;
        }
        
        .raw-material-section {
            display: none;
        }
        
        .raw-material-section.active {
            display: block;
        }
        
        /* Role-based visibility */
        .admin-only {
            display: none;
        }
        
        .manager-feature {
            display: none;
        }
        
        .role-admin .admin-only {
            display: inline-block;
        }
        
        .role-manager .manager-feature {
            display: inline-block;
        }
        
        .role-manager .admin-only {
            display: none !important;
        }
        
        /* Form value styling for detail views */
        .form-value {
            padding: 8px 12px;
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            font-size: 14px;
            color: #334155;
            min-height: 20px;
        }
        
        /* Raw Material Status Badges */
        .status-badge.material-high {
            background: #fecaca;
            color: #991b1b;
        }
        
        .status-badge.material-medium {
            background: #fef3c7;
            color: #92400e;
        }
        
        .status-badge.material-low {
            background: #ecfdf5;
            color: #065f46;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .container {
                padding: 12px;
            }
            
            .nav-tabs {
                padding: 4px;
            }
            
            .nav-tab {
                padding: 8px 12px;
                font-size: 14px;
            }
            
            .card {
                padding: 16px;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .form-row {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div id="loginPage" class="login-container">
        <div class="login-card">
            <div class="login-header">
                <h1 class="login-title">Inventoeasy</h1>
                <p class="login-subtitle">Inventory & Order Tracking System</p>
            </div>
            
            <form id="loginForm">
                <div class="form-group">
                    <label class="form-label">User Role</label>
                    <select class="form-select" id="userRole">
                        <option value="admin">Admin</option>
                        <option value="manager">Manager</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Username</label>
                    <input type="text" class="form-input" id="username" placeholder="Enter username" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Password</label>
                    <input type="password" class="form-input" id="password" placeholder="Enter password" required>
                </div>
                
                <button type="submit" class="btn btn-primary">
                    Sign In
                </button>
            </form>
        </div>
    </div>

    <!-- Main Application (Hidden initially) -->
    <div id="mainApp" style="display: none;">
        <div class="container">
            <!-- Navigation -->
            <nav class="nav-tabs" id="navigation">
                <button class="nav-tab active" data-page="dashboard">üìä Dashboard</button>
                <button class="nav-tab" data-page="orders">üì¶ Orders</button>
                <button class="nav-tab" data-page="inventory">üìã Inventory</button>
                <button class="nav-tab" data-page="reports">üìà Reports</button>
                <button class="nav-tab" data-page="raw-materials">üì¶ Raw Materials</button>
                <button class="nav-tab" data-page="users" id="usersTab">üë• Users</button>
                <button class="nav-tab" data-page="profile">üë§ Profile</button>
                <button class="nav-tab" onclick="logout()" style="margin-left: auto;">üö™ Logout</button>
            </nav>

            <!-- Dashboard Page -->
            <div id="dashboard" class="page active">
                <!-- Stats Overview -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number" id="dashboardTotalOrders">0</div>
                        <div class="stat-label">Total Orders</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="dashboardProcessingOrders">0</div>
                        <div class="stat-label">In Production</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="dashboardReadyOrders">0</div>
                        <div class="stat-label">Ready to Ship</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="dashboardLowStock">0</div>
                        <div class="stat-label">Low Stock Items</div>
                    </div>
                </div>

                <!-- Admin Dashboard Features -->
                <div id="adminDashboard">
                    <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 24px; margin-bottom: 24px;">
                        <!-- Quick Actions -->
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">Quick Actions</h3>
                            </div>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px;">
                                <button class="btn btn-primary" onclick="showPage('orders')">
                                    üì¶ Manage Orders
                                </button>
                                <button class="btn btn-success" onclick="showPage('inventory')">
                                    üìã Manage Inventory
                                </button>
                                <button class="btn btn-warning" onclick="showPage('users')">
                                    üë• Manage Users
                                </button>
                                <button class="btn btn-secondary" onclick="showPage('reports')">
                                    üìà Generate Reports
                                </button>
                            </div>
                        </div>
                        
                        <!-- Recent Activity -->
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">Recent Activity</h3>
                            </div>
                            <div style="space-y: 12px;">
                                <div style="padding: 12px; background: #f8fafc; border-radius: 8px; margin-bottom: 8px;">
                                    <div style="font-weight: 600; font-size: 14px;">Order #ORD-001 shipped</div>
                                    <div style="color: #64748b; font-size: 12px;">2 hours ago</div>
                                </div>
                                <div style="padding: 12px; background: #f8fafc; border-radius: 8px; margin-bottom: 8px;">
                                    <div style="font-weight: 600; font-size: 14px;">New user added: Sarah M.</div>
                                    <div style="color: #64748b; font-size: 12px;">4 hours ago</div>
                                </div>
                                <div style="padding: 12px; background: #f8fafc; border-radius: 8px;">
                                    <div style="font-weight: 600; font-size: 14px;">Inventory updated: Steel Rods</div>
                                    <div style="color: #64748b; font-size: 12px;">6 hours ago</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Orders Overview -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Orders Overview</h3>
                            <div style="display: flex; gap: 12px;">
                                <button class="btn btn-primary btn-sm" onclick="showPage('orders')">View All Orders</button>
                                <button class="btn btn-success btn-sm" id="addOrderBtn">+ Add Order</button>
                            </div>
                        </div>
                        <div class="table-container">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Order ID</th>
                                        <th>Customer</th>
                                        <th>Product</th>
                                        <th>Status</th>
                                        <th>Deadline</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="dashboardOrdersTable">
                                    <!-- Orders will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Manager Dashboard Features -->
                <div id="managerDashboard" style="display: none;">
                    <!-- Current Orders Focus -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Current Orders - Status Update</h3>
                            <button class="btn btn-primary btn-sm" onclick="showPage('orders')">View All Orders</button>
                        </div>
                        <div class="table-container">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Order ID</th>
                                        <th>Customer</th>
                                        <th>Product</th>
                                        <th>Quantity</th>
                                        <th>Current Status</th>
                                        <th>Deadline</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="managerDashboardOrdersTable">
                                    <!-- Orders will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Status Update Quick Actions -->
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px;">
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">Priority Orders</h3>
                            </div>
                            <div style="space-y: 12px;">
                                <div style="padding: 12px; background: #fef3c7; border-left: 4px solid #f59e0b; border-radius: 8px; margin-bottom: 12px;">
                                    <div style="font-weight: 600; font-size: 14px; color: #92400e;">ORD-002 - Due Tomorrow</div>
                                    <div style="color: #64748b; font-size: 12px;">XYZ Corp - Metal Sheets</div>
                                    <button class="btn btn-warning btn-sm" style="margin-top: 8px;" onclick="updateStatus('ORD-002')">Update Status</button>
                                </div>
                                <div style="padding: 12px; background: #fecaca; border-left: 4px solid #ef4444; border-radius: 8px; margin-bottom: 12px;">
                                    <div style="font-weight: 600; font-size: 14px; color: #991b1b;">ORD-004 - Urgent</div>
                                    <div style="color: #64748b; font-size: 12px;">GHI Solutions - Copper Wire</div>
                                    <button class="btn btn-danger btn-sm" style="margin-top: 8px;" onclick="updateStatus('ORD-004')">Update Status</button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">Production Status</h3>
                            </div>
                            <div style="space-y: 12px;">
                                <div style="padding: 12px; background: #dbeafe; border-radius: 8px; margin-bottom: 12px;">
                                    <div style="font-weight: 600; font-size: 14px;">In Production: 2 Orders</div>
                                    <div style="color: #64748b; font-size: 12px;">ORD-001, ORD-004</div>
                                </div>
                                <div style="padding: 12px; background: #d1fae5; border-radius: 8px; margin-bottom: 12px;">
                                    <div style="font-weight: 600; font-size: 14px;">Ready to Ship: 1 Order</div>
                                    <div style="color: #64748b; font-size: 12px;">ORD-002</div>
                                </div>
                                <div style="padding: 12px; background: #fef3c7; border-radius: 8px;">
                                    <div style="font-weight: 600; font-size: 14px;">Pending: 1 Order</div>
                                    <div style="color: #64748b; font-size: 12px;">ORD-003</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Low Stock Alert (Both) -->
                <div class="alert alert-warning">
                    <strong>‚ö†Ô∏è Inventory Alert:</strong> 12 items are running low on stock. 
                    <button class="btn btn-warning btn-sm" onclick="showPage('inventory')" style="margin-left: 12px;">View Inventory</button>
                </div>
            </div>

            <!-- Orders Page -->
            <div id="orders" class="page">
                <!-- Order List View -->
                <div id="orderListView">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Orders Management</h3>
                            <button class="btn btn-primary btn-sm" id="addOrderBtn" onclick="showAddOrderForm()">+ Add New Order</button>
                        </div>

                        <!-- Search and Filter Options -->
                        <div style="display: flex; gap: 16px; margin-bottom: 20px; flex-wrap: wrap; align-items: center;">
                            <div style="display: flex; gap: 12px; flex-wrap: wrap;">
                                <select class="form-select" style="width: auto;" id="statusFilter">
                                    <option value="">All Status</option>
                                    <option value="yet-to-process">Yet to Process</option>
                                    <option value="under-process">Under Process</option>
                                    <option value="ready-to-dispatch">Ready to Dispatch</option>
                                    <option value="shipped">Shipped</option>
                                </select>
                                
                                <input type="text" class="form-input" placeholder="Search orders..." style="width: 250px;" id="orderSearch">
                                
                                <input type="date" class="form-input" style="width: auto;" id="dateFilter" placeholder="Filter by date">
                                
                                <select class="form-select" style="width: auto;" id="customerFilter">
                                    <option value="">All Customers</option>
                                    <option value="abc-industries">ABC Industries</option>
                                    <option value="xyz-corp">XYZ Corp</option>
                                    <option value="def-manufacturing">DEF Manufacturing</option>
                                    <option value="ghi-solutions">GHI Solutions</option>
                                    <option value="jkl-industries">JKL Industries</option>
                                </select>
                            </div>
                            
                            <button class="btn btn-secondary btn-sm" onclick="clearFilters()">Clear Filters</button>
                        </div>

                        <!-- Orders Table -->
                        <div class="table-container">
                            <table class="table" id="ordersTable">
                                <thead>
                                    <tr>
                                        <th>Order ID</th>
                                        <th>Customer</th>
                                        <th>Product</th>
                                        <th>Quantity</th>
                                        <th>Status</th>
                                        <th>Deadline</th>
                                        <th>Created</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr data-order-id="ORD-001" data-status="under-process" data-customer="abc-industries">
                                        <td><strong>ORD-001</strong></td>
                                        <td>ABC Industries</td>
                                        <td>Steel Pipes</td>
                                        <td>500 units</td>
                                        <td><span class="status-badge status-processing">Under Process</span></td>
                                        <td>2025-10-15</td>
                                        <td>2025-09-20</td>
                                        <td>
                                            <button class="btn btn-secondary btn-sm" onclick="viewOrderDetail('ORD-001')">View</button>
                                            <button class="btn btn-warning btn-sm admin-only" onclick="editOrder('ORD-001')">Edit</button>
                                            <button class="btn btn-success btn-sm manager-feature" onclick="updateOrderStatus('ORD-001', 'Under Process')">Update Status</button>
                                            <button class="btn btn-danger btn-sm admin-only" onclick="deleteOrder('ORD-001')">Delete</button>
                                        </td>
                                    </tr>
                                    <tr data-order-id="ORD-002" data-status="ready-to-dispatch" data-customer="xyz-corp">
                                        <td><strong>ORD-002</strong></td>
                                        <td>XYZ Corp</td>
                                        <td>Metal Sheets</td>
                                        <td>200 units</td>
                                        <td><span class="status-badge status-ready">Ready to Dispatch</span></td>
                                        <td>2025-10-10</td>
                                        <td>2025-09-18</td>
                                        <td>
                                            <button class="btn btn-secondary btn-sm" onclick="viewOrderDetail('ORD-002')">View</button>
                                            <button class="btn btn-warning btn-sm admin-only" onclick="editOrder('ORD-002')">Edit</button>
                                            <button class="btn btn-success btn-sm manager-feature" onclick="updateOrderStatus('ORD-002', 'Ready to Dispatch')">Update Status</button>
                                            <button class="btn btn-danger btn-sm admin-only" onclick="deleteOrder('ORD-002')">Delete</button>
                                        </td>
                                    </tr>
                                    <tr data-order-id="ORD-003" data-status="yet-to-process" data-customer="def-manufacturing">
                                        <td><strong>ORD-003</strong></td>
                                        <td>DEF Manufacturing</td>
                                        <td>Aluminum Rods</td>
                                        <td>300 units</td>
                                        <td><span class="status-badge status-pending">Yet to Process</span></td>
                                        <td>2025-10-20</td>
                                        <td>2025-09-22</td>
                                        <td>
                                            <button class="btn btn-secondary btn-sm" onclick="viewOrderDetail('ORD-003')">View</button>
                                            <button class="btn btn-warning btn-sm admin-only" onclick="editOrder('ORD-003')">Edit</button>
                                            <button class="btn btn-success btn-sm manager-feature" onclick="updateOrderStatus('ORD-003', 'Yet to Process')">Update Status</button>
                                            <button class="btn btn-danger btn-sm admin-only" onclick="deleteOrder('ORD-003')">Delete</button>
                                        </td>
                                    </tr>
                                    <tr data-order-id="ORD-004" data-status="shipped" data-customer="ghi-solutions">
                                        <td><strong>ORD-004</strong></td>
                                        <td>GHI Solutions</td>
                                        <td>Copper Wire</td>
                                        <td>150 units</td>
                                        <td><span class="status-badge status-shipped">Shipped</span></td>
                                        <td>2025-10-08</td>
                                        <td>2025-09-15</td>
                                        <td>
                                            <button class="btn btn-secondary btn-sm" onclick="viewOrderDetail('ORD-004')">View</button>
                                            <button class="btn btn-warning btn-sm admin-only" onclick="editOrder('ORD-004')">Edit</button>
                                            <span class="manager-feature" style="color: #64748b; font-size: 12px;">Completed</span>
                                            <button class="btn btn-danger btn-sm admin-only" onclick="deleteOrder('ORD-004')">Delete</button>
                                        </td>
                                    </tr>
                                    <tr data-order-id="ORD-005" data-status="under-process" data-customer="jkl-industries">
                                        <td><strong>ORD-005</strong></td>
                                        <td>JKL Industries</td>
                                        <td>Steel Beams</td>
                                        <td>100 units</td>
                                        <td><span class="status-badge status-processing">Under Process</span></td>
                                        <td>2025-10-25</td>
                                        <td>2025-09-23</td>
                                        <td>
                                            <button class="btn btn-secondary btn-sm" onclick="viewOrderDetail('ORD-005')">View</button>
                                            <button class="btn btn-warning btn-sm admin-only" onclick="editOrder('ORD-005')">Edit</button>
                                            <button class="btn btn-success btn-sm manager-feature" onclick="updateOrderStatus('ORD-005', 'Under Process')">Update Status</button>
                                            <button class="btn btn-danger btn-sm admin-only" onclick="deleteOrder('ORD-005')">Delete</button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Order Detail View -->
                <div id="orderDetailView" style="display: none;">
                    <div style="display: flex; align-items: center; gap: 16px; margin-bottom: 24px;">
                        <button class="btn btn-secondary" onclick="showOrderList()">‚Üê Back to Orders</button>
                        <h2 id="orderDetailTitle">Order Details - ORD-001</h2>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 24px;">
                        <!-- Order Information -->
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">Order Information</h3>
                                <div id="orderDetailActions">
                                    <!-- Actions will be populated based on role -->
                                </div>
                            </div>
                            
                            <div class="form-grid" id="orderDetailInfo">
                                <!-- Order details will be populated here -->
                            </div>
                        </div>
                        
                        <!-- Status History -->
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">Status History</h3>
                            </div>
                            
                            <div id="statusHistory">
                                <!-- Status history will be populated here -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Add/Edit Order Form -->
                <div id="orderFormView" style="display: none;">
                    <div style="display: flex; align-items: center; gap: 16px; margin-bottom: 24px;">
                        <button class="btn btn-secondary" onclick="showOrderList()">‚Üê Back to Orders</button>
                        <h2 id="orderFormTitle">Add New Order</h2>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title" id="orderFormCardTitle">Order Details</h3>
                        </div>
                        
                        <form id="orderDetailsForm">
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">Order ID</label>
                                    <input type="text" class="form-input" id="formOrderId" placeholder="Auto-generated" readonly style="background: #f1f5f9;">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Customer Name *</label>
                                    <input type="text" class="form-input" id="formCustomer" placeholder="Enter customer name" required>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">Product *</label>
                                    <select class="form-select" id="formProduct" required>
                                        <option value="">Select Product</option>
                                        <option value="steel-pipes">Steel Pipes</option>
                                        <option value="metal-sheets">Metal Sheets</option>
                                        <option value="aluminum-rods">Aluminum Rods</option>
                                        <option value="copper-wire">Copper Wire</option>
                                        <option value="steel-beams">Steel Beams</option>
                                        <option value="welding-materials">Welding Materials</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Quantity *</label>
                                    <input type="number" class="form-input" id="formQuantity" placeholder="Enter quantity" min="1" required>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">Deadline *</label>
                                    <input type="date" class="form-input" id="formDeadline" required>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Priority</label>
                                    <select class="form-select" id="formPriority">
                                        <option value="low">Low</option>
                                        <option value="medium" selected>Medium</option>
                                        <option value="high">High</option>
                                        <option value="urgent">Urgent</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">Unit Price</label>
                                    <input type="number" class="form-input" id="formPrice" placeholder="Enter unit price" step="0.01">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Total Amount</label>
                                    <input type="number" class="form-input" id="formTotal" placeholder="Auto-calculated" readonly style="background: #f1f5f9;">
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Special Instructions</label>
                                <textarea class="form-input" id="formInstructions" rows="3" placeholder="Enter any special requirements or notes..."></textarea>
                            </div>
                            
                            <div style="display: flex; gap: 12px; justify-content: flex-end; margin-top: 24px;">
                                <button type="button" onclick="showOrderList()" class="btn btn-secondary">Cancel</button>
                                <button type="submit" class="btn btn-primary" id="orderFormSubmit">Create Order</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Inventory Page -->
            <div id="inventory" class="page">
                <!-- Inventory List View -->
                <div id="inventoryListView">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Inventory Management</h3>
                            <button class="btn btn-primary btn-sm admin-only" id="addInventoryBtn" onclick="showAddInventoryForm()">+ Add Item</button>
                        </div>

                        <!-- Low Stock Alert Banner -->
                        <div class="alert alert-warning" id="lowStockAlertBanner" style="display: none;">
                            <strong>‚ö†Ô∏è Low Stock Alert:</strong> 
                            <span id="lowStockCount">0</span> items are running low on stock. 
                            <button class="btn btn-warning btn-sm" onclick="filterByLowStock()" style="margin-left: 12px;">View Low Stock Items</button>
                        </div>

                        <!-- Search and Filter Options -->
                        <div style="display: flex; gap: 16px; margin-bottom: 20px; flex-wrap: wrap; align-items: center;">
                            <div style="display: flex; gap: 12px; flex-wrap: wrap;">
                                <select class="form-select" style="width: auto;" id="categoryFilter">
                                    <option value="">All Categories</option>
                                    <option value="raw-materials">Raw Materials</option>
                                    <option value="finished-goods">Finished Goods</option>
                                    <option value="tools-equipment">Tools & Equipment</option>
                                    <option value="consumables">Consumables</option>
                                </select>
                                
                                <select class="form-select" style="width: auto;" id="stockStatusFilter">
                                    <option value="">All Stock Levels</option>
                                    <option value="in-stock">In Stock</option>
                                    <option value="low-stock">Low Stock</option>
                                    <option value="out-of-stock">Out of Stock</option>
                                </select>
                                
                                <input type="text" class="form-input" placeholder="Search inventory..." style="width: 250px;" id="inventorySearch">
                            </div>
                            
                            <button class="btn btn-secondary btn-sm" onclick="clearInventoryFilters()">Clear Filters</button>
                        </div>

                        <!-- Inventory Stats -->
                        <div class="stats-grid" style="grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); margin-bottom: 24px;">
                            <div class="stat-card" style="border-left-color: #10b981;">
                                <div class="stat-number" id="totalItemsCount">0</div>
                                <div class="stat-label">Total Items</div>
                            </div>
                            <div class="stat-card" style="border-left-color: #3b82f6;">
                                <div class="stat-number" id="inStockCount">0</div>
                                <div class="stat-label">In Stock</div>
                            </div>
                            <div class="stat-card" style="border-left-color: #f59e0b;">
                                <div class="stat-number" id="lowStockCountStat">0</div>
                                <div class="stat-label">Low Stock</div>
                            </div>
                            <div class="stat-card" style="border-left-color: #ef4444;">
                                <div class="stat-number" id="outOfStockCount">0</div>
                                <div class="stat-label">Out of Stock</div>
                            </div>
                        </div>

                        <!-- Inventory Table -->
                        <div class="table-container">
                            <table class="table" id="inventoryTable">
                                <thead>
                                    <tr>
                                        <th>Item Code</th>
                                        <th>Name</th>
                                        <th>Category</th>
                                        <th>Available Stock</th>
                                        <th>Min Level</th>
                                        <th>Max Level</th>
                                        <th>Unit</th>
                                        <th>Status</th>
                                        <th>Last Updated</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr data-item-id="ITM-001" data-category="raw-materials" data-stock="45" data-min="50">
                                        <td><strong>ITM-001</strong></td>
                                        <td>Steel Rods</td>
                                        <td>Raw Materials</td>
                                        <td><strong style="color: #f59e0b;">45</strong></td>
                                        <td>50</td>
                                        <td>500</td>
                                        <td>Units</td>
                                        <td><span class="status-badge status-pending">‚ö†Ô∏è Low Stock</span></td>
                                        <td>2025-09-20</td>
                                        <td>
                                            <button class="btn btn-secondary btn-sm" onclick="viewInventoryDetail('ITM-001')">View</button>
                                            <button class="btn btn-warning btn-sm admin-only" onclick="editInventoryStock('ITM-001')">Edit Stock</button>
                                            <button class="btn btn-info btn-sm manager-feature" onclick="requestInventoryStockUpdate('ITM-001')">Request Update</button>
                                            <button class="btn btn-success btn-sm" onclick="viewStockHistory('ITM-001')">History</button>
                                        </td>
                                    </tr>
                                    <tr data-item-id="ITM-002" data-category="raw-materials" data-stock="150" data-min="100">
                                        <td><strong>ITM-002</strong></td>
                                        <td>Aluminum Sheets</td>
                                        <td>Raw Materials</td>
                                        <td><strong style="color: #10b981;">150</strong></td>
                                        <td>100</td>
                                        <td>300</td>
                                        <td>Units</td>
                                        <td><span class="status-badge status-ready">‚úì In Stock</span></td>
                                        <td>2025-09-22</td>
                                        <td>
                                            <button class="btn btn-secondary btn-sm" onclick="viewInventoryDetail('ITM-002')">View</button>
                                            <button class="btn btn-warning btn-sm admin-only" onclick="editInventoryStock('ITM-002')">Edit Stock</button>
                                            <button class="btn btn-info btn-sm manager-feature" onclick="requestInventoryStockUpdate('ITM-002')">Request Update</button>
                                            <button class="btn btn-success btn-sm" onclick="viewStockHistory('ITM-002')">History</button>
                                        </td>
                                    </tr>
                                    <tr data-item-id="ITM-003" data-category="tools-equipment" data-stock="0" data-min="20">
                                        <td><strong>ITM-003</strong></td>
                                        <td>Welding Wire</td>
                                        <td>Tools & Equipment</td>
                                        <td><strong style="color: #ef4444;">0</strong></td>
                                        <td>20</td>
                                        <td>100</td>
                                        <td>Kg</td>
                                        <td><span class="status-badge" style="background: #fecaca; color: #991b1b;">‚úó Out of Stock</span></td>
                                        <td>2025-09-18</td>
                                        <td>
                                            <button class="btn btn-secondary btn-sm" onclick="viewInventoryDetail('ITM-003')">View</button>
                                            <button class="btn btn-warning btn-sm admin-only" onclick="editInventoryStock('ITM-003')">Edit Stock</button>
                                            <button class="btn btn-danger btn-sm manager-feature" onclick="reportInventoryEmptyStock('ITM-003')">Report Empty</button>
                                            <button class="btn btn-success btn-sm" onclick="viewStockHistory('ITM-003')">History</button>
                                        </td>
                                    </tr>
                                    <tr data-item-id="ITM-004" data-category="finished-goods" data-stock="200" data-min="150">
                                        <td><strong>ITM-004</strong></td>
                                        <td>Steel Pipes (Finished)</td>
                                        <td>Finished Goods</td>
                                        <td><strong style="color: #10b981;">200</strong></td>
                                        <td>150</td>
                                        <td>400</td>
                                        <td>Units</td>
                                        <td><span class="status-badge status-ready">‚úì In Stock</span></td>
                                        <td>2025-09-23</td>
                                        <td>
                                            <button class="btn btn-secondary btn-sm" onclick="viewInventoryDetail('ITM-004')">View</button>
                                            <button class="btn btn-warning btn-sm admin-only" onclick="editInventoryStock('ITM-004')">Edit Stock</button>
                                            <button class="btn btn-info btn-sm manager-feature" onclick="requestInventoryStockUpdate('ITM-004')">Request Update</button>
                                            <button class="btn btn-success btn-sm" onclick="viewStockHistory('ITM-004')">History</button>
                                        </td>
                                    </tr>
                                    <tr data-item-id="ITM-005" data-category="consumables" data-stock="35" data-min="30">
                                        <td><strong>ITM-005</strong></td>
                                        <td>Cutting Blades</td>
                                        <td>Consumables</td>
                                        <td><strong style="color: #10b981;">35</strong></td>
                                        <td>30</td>
                                        <td>100</td>
                                        <td>Pcs</td>
                                        <td><span class="status-badge status-ready">‚úì In Stock</span></td>
                                        <td>2025-09-21</td>
                                        <td>
                                            <button class="btn btn-secondary btn-sm" onclick="viewInventoryDetail('ITM-005')">View</button>
                                            <button class="btn btn-warning btn-sm admin-only" onclick="editInventoryStock('ITM-005')">Edit Stock</button>
                                            <button class="btn btn-info btn-sm manager-feature" onclick="requestInventoryStockUpdate('ITM-005')">Request Update</button>
                                            <button class="btn btn-success btn-sm" onclick="viewStockHistory('ITM-005')">History</button>
                                        </td>
                                    </tr>
                                    <tr data-item-id="ITM-006" data-category="raw-materials" data-stock="25" data-min="40">
                                        <td><strong>ITM-006</strong></td>
                                        <td>Copper Wire</td>
                                        <td>Raw Materials</td>
                                        <td><strong style="color: #f59e0b;">25</strong></td>
                                        <td>40</td>
                                        <td>200</td>
                                        <td>Kg</td>
                                        <td><span class="status-badge status-pending">‚ö†Ô∏è Low Stock</span></td>
                                        <td>2025-09-19</td>
                                        <td>
                                            <button class="btn btn-secondary btn-sm" onclick="viewInventoryDetail('ITM-006')">View</button>
                                            <button class="btn btn-warning btn-sm admin-only" onclick="editInventoryStock('ITM-006')">Edit Stock</button>
                                            <button class="btn btn-info btn-sm manager-feature" onclick="requestInventoryStockUpdate('ITM-006')">Request Update</button>
                                            <button class="btn btn-success btn-sm" onclick="viewStockHistory('ITM-006')">History</button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Inventory Detail View -->
                <div id="inventoryDetailView" style="display: none;">
                    <div style="display: flex; align-items: center; gap: 16px; margin-bottom: 24px;">
                        <button class="btn btn-secondary" onclick="showInventoryList()">‚Üê Back to Inventory</button>
                        <h2 id="inventoryDetailTitle">Item Details</h2>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 24px;">
                        <!-- Item Information -->
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">Item Information</h3>
                                <button class="btn btn-warning btn-sm admin-only" id="editInventoryDetailBtn">Edit Stock</button>
                            </div>
                            
                            <div class="form-grid" id="inventoryDetailInfo">
                                <!-- Item details will be populated here -->
                            </div>
                        </div>
                        
                        <!-- Stock Level Chart -->
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">Stock Status</h3>
                            </div>
                            
                            <div id="stockLevelDisplay" style="padding: 20px;">
                                <!-- Stock level visualization -->
                            </div>
                        </div>
                    </div>
                    
                    <!-- Stock History -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Stock Movement History</h3>
                        </div>
                        <div class="table-container">
                            <table class="table" id="stockHistoryTable">
                                <thead>
                                    <tr>
                                        <th>Date</th>
                                        <th>Type</th>
                                        <th>Quantity</th>
                                        <th>Previous Stock</th>
                                        <th>New Stock</th>
                                        <th>Reason</th>
                                        <th>Updated By</th>
                                    </tr>
                                </thead>
                                <tbody id="stockHistoryBody">
                                    <!-- History will be populated here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Add/Edit Inventory Form -->
                <div id="inventoryFormView" style="display: none;">
                    <div style="display: flex; align-items: center; gap: 16px; margin-bottom: 24px;">
                        <button class="btn btn-secondary" onclick="showInventoryList()">‚Üê Back to Inventory</button>
                        <h2 id="inventoryFormTitle">Add New Item</h2>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title" id="inventoryFormCardTitle">Item Details</h3>
                        </div>
                        
                        <form id="inventoryDetailsForm">
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">Item Code</label>
                                    <input type="text" class="form-input" id="formItemCode" placeholder="Auto-generated" readonly style="background: #f1f5f9;">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Item Name *</label>
                                    <input type="text" class="form-input" id="formItemName" placeholder="Enter item name" required>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">Category *</label>
                                    <select class="form-select" id="formCategory" required>
                                        <option value="">Select Category</option>
                                        <option value="raw-materials">Raw Materials</option>
                                        <option value="finished-goods">Finished Goods</option>
                                        <option value="tools-equipment">Tools & Equipment</option>
                                        <option value="consumables">Consumables</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Unit *</label>
                                    <select class="form-select" id="formUnit" required>
                                        <option value="">Select Unit</option>
                                        <option value="units">Units</option>
                                        <option value="kg">Kilograms (Kg)</option>
                                        <option value="pcs">Pieces (Pcs)</option>
                                        <option value="ltr">Liters (Ltr)</option>
                                        <option value="mt">Metric Tons (MT)</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">Current Stock *</label>
                                    <input type="number" class="form-input" id="formCurrentStock" placeholder="Enter current stock" min="0" required>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Minimum Level *</label>
                                    <input type="number" class="form-input" id="formMinLevel" placeholder="Enter minimum stock level" min="0" required>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">Maximum Level *</label>
                                    <input type="number" class="form-input" id="formMaxLevel" placeholder="Enter maximum stock level" min="0" required>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Reorder Point</label>
                                    <input type="number" class="form-input" id="formReorderPoint" placeholder="Auto-calculated" readonly style="background: #f1f5f9;">
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Description</label>
                                <textarea class="form-input" id="formDescription" rows="3" placeholder="Enter item description..."></textarea>
                            </div>
                            
                            <div style="display: flex; gap: 12px; justify-content: flex-end; margin-top: 24px;">
                                <button type="button" onclick="showInventoryList()" class="btn btn-secondary">Cancel</button>
                                <button type="submit" class="btn btn-primary" id="inventoryFormSubmit">Save Item</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Reports Page -->
            <div id="reports" class="page">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Reports & Analytics</h3>
                        <div style="display: flex; gap: 12px;">
                            <button class="btn btn-primary btn-sm" onclick="generateOrderReport()">üìä Generate Order Report</button>
                            <button class="btn btn-success btn-sm" onclick="generateInventoryReport()">üìã Generate Inventory Report</button>
                        </div>
                    </div>
                    
                    <!-- Report Generation Section -->
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px; margin-bottom: 24px;">
                        <!-- Order Report Card -->
                        <div class="card" style="margin: 0;">
                            <div class="card-header">
                                <h4 style="font-size: 16px; font-weight: 600;">üì¶ Order Reports</h4>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Report Type</label>
                                <select class="form-select" id="orderReportType">
                                    <option value="all-orders">All Orders</option>
                                    <option value="pending-orders">Pending Orders</option>
                                    <option value="completed-orders">Completed Orders</option>
                                    <option value="customer-orders">Orders by Customer</option>
                                    <option value="monthly-orders">Monthly Orders</option>
                                </select>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">From Date</label>
                                    <input type="date" class="form-input" id="orderReportFromDate">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">To Date</label>
                                    <input type="date" class="form-input" id="orderReportToDate">
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Customer Filter</label>
                                <select class="form-select" id="orderReportCustomer">
                                    <option value="">All Customers</option>
                                    <option value="abc-industries">ABC Industries</option>
                                    <option value="xyz-corp">XYZ Corp</option>
                                    <option value="def-manufacturing">DEF Manufacturing</option>
                                    <option value="ghi-solutions">GHI Solutions</option>
                                    <option value="jkl-industries">JKL Industries</option>
                                </select>
                            </div>
                            <div style="display: flex; gap: 12px;">
                                <button class="btn btn-primary" onclick="generateOrderReport()">üìä Generate Report</button>
                                <button class="btn btn-success" onclick="downloadOrderReport('pdf')" id="downloadOrderPDF" disabled>üìÑ Download PDF</button>
                                <button class="btn btn-secondary" onclick="downloadOrderReport('excel')" id="downloadOrderExcel" disabled>üìä Download Excel</button>
                            </div>
                        </div>
                        
                        <!-- Inventory Report Card -->
                        <div class="card" style="margin: 0;">
                            <div class="card-header">
                                <h4 style="font-size: 16px; font-weight: 600;">üìã Inventory Reports</h4>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Report Type</label>
                                <select class="form-select" id="inventoryReportType">
                                    <option value="all-inventory">All Inventory</option>
                                    <option value="low-stock">Low Stock Items</option>
                                    <option value="out-of-stock">Out of Stock</option>
                                    <option value="by-category">By Category</option>
                                    <option value="stock-movement">Stock Movement</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Category Filter</label>
                                <select class="form-select" id="inventoryReportCategory">
                                    <option value="">All Categories</option>
                                    <option value="raw-materials">Raw Materials</option>
                                    <option value="finished-goods">Finished Goods</option>
                                    <option value="tools-equipment">Tools & Equipment</option>
                                    <option value="consumables">Consumables</option>
                                </select>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">From Date</label>
                                    <input type="date" class="form-input" id="inventoryReportFromDate">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">To Date</label>
                                    <input type="date" class="form-input" id="inventoryReportToDate">
                                </div>
                            </div>
                            <div style="display: flex; gap: 12px;">
                                <button class="btn btn-primary" onclick="generateInventoryReport()">üìä Generate Report</button>
                                <button class="btn btn-success" onclick="downloadInventoryReport('pdf')" id="downloadInventoryPDF" disabled>üìÑ Download PDF</button>
                                <button class="btn btn-secondary" onclick="downloadInventoryReport('excel')" id="downloadInventoryExcel" disabled>üìä Download Excel</button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Generated Reports Display -->
                    <div id="reportResults" style="display: none;">
                        <div class="card" style="margin: 0;">
                            <div class="card-header">
                                <h3 class="card-title" id="reportTitle">Generated Report</h3>
                                <div style="display: flex; gap: 12px;">
                                    <button class="btn btn-secondary btn-sm" onclick="hideReportResults()">Close Report</button>
                                    <button class="btn btn-primary btn-sm" onclick="printReport()">üñ®Ô∏è Print</button>
                                </div>
                            </div>
                            
                            <!-- Report Summary Stats -->
                            <div class="stats-grid" style="grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); margin-bottom: 20px;" id="reportStats">
                                <!-- Stats will be populated dynamically -->
                            </div>
                            
                            <!-- Report Table -->
                            <div class="table-container">
                                <table class="table" id="reportTable">
                                    <thead id="reportTableHead">
                                        <!-- Headers will be populated dynamically -->
                                    </thead>
                                    <tbody id="reportTableBody">
                                        <!-- Data will be populated dynamically -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Quick Stats Overview -->
                    <div class="stats-grid" style="margin-top: 24px;">
                        <div class="stat-card">
                            <div class="stat-number" id="totalOrdersReported">127</div>
                            <div class="stat-label">Total Orders This Month</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="totalRevenueReported">$156,800</div>
                            <div class="stat-label">Total Revenue</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="totalItemsReported">45</div>
                            <div class="stat-label">Total Inventory Items</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="lowStockItemsReported">12</div>
                            <div class="stat-label">Low Stock Alerts</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Raw Materials Page -->
            <div id="raw-materials" class="page">
                <!-- Raw Material Management Tabs -->
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Raw Material Management</h3>
                        <div style="display: flex; gap: 12px;">
                            <button class="btn btn-secondary btn-sm" onclick="refreshRawMaterials()">üîÑ Refresh</button>
                        </div>
                    </div>
                    
                    <!-- Raw Material Sub Navigation -->
                    <div style="display: flex; gap: 8px; margin-bottom: 20px; background: #f8fafc; padding: 8px; border-radius: 8px;">
                        <button class="btn btn-primary btn-sm raw-material-tab active" data-raw-tab="current">Current Stock</button>
                        <button class="btn btn-secondary btn-sm raw-material-tab" data-raw-tab="required">Required Materials</button>
                        <button class="btn btn-secondary btn-sm raw-material-tab" data-raw-tab="upcoming">Upcoming Deliveries</button>
                    </div>
                    
                    <!-- Current Raw Materials Table -->
                    <div id="currentRawMaterials" class="raw-material-section active">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                            <h4 style="font-size: 18px; font-weight: 600; color: #1e293b;">Current Raw Material Stock</h4>
                            <div style="display: flex; gap: 12px; align-items: center;">
                                <select class="form-select" style="width: auto;" id="currentCategoryFilter">
                                    <option value="">All Categories</option>
                                    <option value="metals">Metals</option>
                                    <option value="chemicals">Chemicals</option>
                                    <option value="plastics">Plastics</option>
                                    <option value="textiles">Textiles</option>
                                </select>
                                <input type="text" class="form-input" placeholder="Search materials..." style="width: 200px;" id="currentSearchInput">
                                <button class="btn btn-success btn-sm admin-only" onclick="showAddCurrentMaterialForm()">
                                    <i class="fas fa-plus"></i> Add to Current Stock
                                </button>
                            </div>
                        </div>
                        
                        <!-- Current Materials Stats -->
                        <div class="stats-grid" style="grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); margin-bottom: 20px;">
                            <div class="stat-card" style="border-left-color: #10b981;">
                                <div class="stat-number" id="totalCurrentMaterials">24</div>
                                <div class="stat-label">Total Materials</div>
                            </div>
                            <div class="stat-card" style="border-left-color: #3b82f6;">
                                <div class="stat-number" id="totalCurrentValue">$45,750</div>
                                <div class="stat-label">Total Stock Value</div>
                            </div>
                            <div class="stat-card" style="border-left-color: #f59e0b;">
                                <div class="stat-number" id="lowStockCurrentMaterials">5</div>
                                <div class="stat-label">Low Stock Items</div>
                            </div>
                            <div class="stat-card" style="border-left-color: #ef4444;">
                                <div class="stat-number" id="outOfStockCurrentMaterials">2</div>
                                <div class="stat-label">Out of Stock</div>
                            </div>
                        </div>
                        
                        <!-- Current Materials Table -->
                        <div class="table-container">
                            <table class="table" id="currentRawMaterialsTable">
                                <thead>
                                    <tr>
                                        <th>Material ID</th>
                                        <th>Material Name</th>
                                        <th>Category</th>
                                        <th>Current Stock</th>
                                        <th>Unit</th>
                                        <th>Unit Price</th>
                                        <th>Total Value</th>
                                        <th>Min Level</th>
                                        <th>Status</th>
                                        <th>Last Updated</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr data-material-id="RM-001" data-category="metals">
                                        <td><strong>RM-001</strong></td>
                                        <td>Steel Sheets</td>
                                        <td>Metals</td>
                                        <td><strong style="color: #10b981;">150</strong></td>
                                        <td>Kg</td>
                                        <td>$12.50</td>
                                        <td>$1,875.00</td>
                                        <td>50</td>
                                        <td><span class="status-badge status-ready">‚úì In Stock</span></td>
                                        <td>2025-09-28</td>
                                        <td>
                                            <button class="btn btn-secondary btn-sm" onclick="viewRawMaterialDetail('RM-001')">View</button>
                                            <button class="btn btn-warning btn-sm admin-only" onclick="editRawMaterial('RM-001')">Edit</button>
                                            <button class="btn btn-success btn-sm admin-only" onclick="editRawMaterialStock('RM-001')">Stock</button>
                                            <button class="btn btn-danger btn-sm admin-only" onclick="deleteRawMaterial('RM-001')">Delete</button>
                                            <button class="btn btn-info btn-sm manager-feature" onclick="requestStockUpdate('RM-001')">Request Update</button>
                                        </td>
                                    </tr>
                                    <tr data-material-id="RM-002" data-category="chemicals">
                                        <td><strong>RM-002</strong></td>
                                        <td>Industrial Adhesive</td>
                                        <td>Chemicals</td>
                                        <td><strong style="color: #f59e0b;">25</strong></td>
                                        <td>Ltr</td>
                                        <td>$35.00</td>
                                        <td>$875.00</td>
                                        <td>30</td>
                                        <td><span class="status-badge status-pending">‚ö†Ô∏è Low Stock</span></td>
                                        <td>2025-09-25</td>
                                        <td>
                                            <button class="btn btn-secondary btn-sm" onclick="viewRawMaterialDetail('RM-002')">View</button>
                                            <button class="btn btn-warning btn-sm admin-only" onclick="editRawMaterial('RM-002')">Edit</button>
                                            <button class="btn btn-success btn-sm admin-only" onclick="editRawMaterialStock('RM-002')">Stock</button>
                                            <button class="btn btn-danger btn-sm admin-only" onclick="deleteRawMaterial('RM-002')">Delete</button>
                                            <button class="btn btn-info btn-sm manager-feature" onclick="requestStockUpdate('RM-002')">Request Update</button>
                                        </td>
                                    </tr>
                                    <tr data-material-id="RM-003" data-category="plastics">
                                        <td><strong>RM-003</strong></td>
                                        <td>PVC Pipes</td>
                                        <td>Plastics</td>
                                        <td><strong style="color: #ef4444;">0</strong></td>
                                        <td>Units</td>
                                        <td>$8.75</td>
                                        <td>$0.00</td>
                                        <td>20</td>
                                        <td><span class="status-badge" style="background: #fecaca; color: #991b1b;">‚úó Out of Stock</span></td>
                                        <td>2025-09-22</td>
                                        <td>
                                            <button class="btn btn-secondary btn-sm" onclick="viewRawMaterialDetail('RM-003')">View</button>
                                            <button class="btn btn-warning btn-sm admin-only" onclick="editRawMaterial('RM-003')">Edit</button>
                                            <button class="btn btn-success btn-sm admin-only" onclick="editRawMaterialStock('RM-003')">Stock</button>
                                            <button class="btn btn-danger btn-sm admin-only" onclick="deleteRawMaterial('RM-003')">Delete</button>
                                            <button class="btn btn-danger btn-sm manager-feature" onclick="reportEmptyStock('RM-003')">Report Empty</button>
                                        </td>
                                    </tr>
                                    <tr data-material-id="RM-004" data-category="textiles">
                                        <td><strong>RM-004</strong></td>
                                        <td>Cotton Fabric</td>
                                        <td>Textiles</td>
                                        <td><strong style="color: #10b981;">200</strong></td>
                                        <td>Meters</td>
                                        <td>$15.25</td>
                                        <td>$3,050.00</td>
                                        <td>75</td>
                                        <td><span class="status-badge status-ready">‚úì In Stock</span></td>
                                        <td>2025-09-29</td>
                                        <td>
                                            <button class="btn btn-secondary btn-sm" onclick="viewRawMaterialDetail('RM-004')">View</button>
                                            <button class="btn btn-warning btn-sm admin-only" onclick="editRawMaterial('RM-004')">Edit</button>
                                            <button class="btn btn-success btn-sm admin-only" onclick="editRawMaterialStock('RM-004')">Stock</button>
                                            <button class="btn btn-danger btn-sm admin-only" onclick="deleteRawMaterial('RM-004')">Delete</button>
                                            <button class="btn btn-info btn-sm manager-feature" onclick="requestStockUpdate('RM-004')">Request Update</button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <!-- Required Raw Materials Table -->
                    <div id="requiredRawMaterials" class="raw-material-section" style="display: none;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                            <h4 style="font-size: 18px; font-weight: 600; color: #1e293b;">Required Raw Materials</h4>
                            <div style="display: flex; gap: 12px; align-items: center;">
                                <select class="form-select" style="width: auto;" id="requiredPriorityFilter">
                                    <option value="">All Priorities</option>
                                    <option value="high">High Priority</option>
                                    <option value="medium">Medium Priority</option>
                                    <option value="low">Low Priority</option>
                                </select>
                                <input type="text" class="form-input" placeholder="Search requirements..." style="width: 200px;" id="requiredSearchInput">
                                <button class="btn btn-warning btn-sm admin-only" onclick="showAddRequiredMaterialForm()">
                                    <i class="fas fa-plus"></i> Add Requirement
                                </button>
                            </div>
                        </div>
                        
                        <!-- Required Materials Stats -->
                        <div class="stats-grid" style="grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); margin-bottom: 20px;">
                            <div class="stat-card" style="border-left-color: #ef4444;">
                                <div class="stat-number" id="totalRequiredMaterials">8</div>
                                <div class="stat-label">Total Required</div>
                            </div>
                            <div class="stat-card" style="border-left-color: #f59e0b;">
                                <div class="stat-number" id="highPriorityRequired">3</div>
                                <div class="stat-label">High Priority</div>
                            </div>
                            <div class="stat-card" style="border-left-color: #3b82f6;">
                                <div class="stat-number" id="estimatedRequiredCost">$12,450</div>
                                <div class="stat-label">Estimated Cost</div>
                            </div>
                            <div class="stat-card" style="border-left-color: #10b981;">
                                <div class="stat-number" id="orderedMaterials">2</div>
                                <div class="stat-label">Already Ordered</div>
                            </div>
                        </div>
                        
                        <!-- Required Materials Table -->
                        <div class="table-container">
                            <table class="table" id="requiredRawMaterialsTable">
                                <thead>
                                    <tr>
                                        <th>Material ID</th>
                                        <th>Material Name</th>
                                        <th>Category</th>
                                        <th>Required Qty</th>
                                        <th>Current Stock</th>
                                        <th>Shortage</th>
                                        <th>Unit</th>
                                        <th>Estimated Cost</th>
                                        <th>Required By</th>
                                        <th>Priority</th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr data-material-id="RM-005" data-category="metals" data-priority="high">
                                        <td><strong>RM-005</strong></td>
                                        <td>Aluminum Bars</td>
                                        <td>Metals</td>
                                        <td>100</td>
                                        <td>0</td>
                                        <td><strong style="color: #ef4444;">100</strong></td>
                                        <td>Kg</td>
                                        <td>$2,500.00</td>
                                        <td>2025-10-05</td>
                                        <td><span class="status-badge" style="background: #fecaca; color: #991b1b;">High</span></td>
                                        <td><span class="status-badge status-pending">Pending Order</span></td>
                                        <td>
                                            <button class="btn btn-success btn-sm admin-only" onclick="orderRawMaterial('RM-005')">Order Now</button>
                                            <button class="btn btn-secondary btn-sm" onclick="viewRequiredMaterialDetail('RM-005')">Details</button>
                                            <button class="btn btn-warning btn-sm manager-feature" onclick="requestPurchaseOrder('RM-005')">Request Order</button>
                                        </td>
                                    </tr>
                                    <tr data-material-id="RM-006" data-category="chemicals" data-priority="medium">
                                        <td><strong>RM-006</strong></td>
                                        <td>Epoxy Resin</td>
                                        <td>Chemicals</td>
                                        <td>50</td>
                                        <td>15</td>
                                        <td><strong style="color: #f59e0b;">35</strong></td>
                                        <td>Ltr</td>
                                        <td>$1,750.00</td>
                                        <td>2025-10-12</td>
                                        <td><span class="status-badge" style="background: #fef3c7; color: #92400e;">Medium</span></td>
                                        <td><span class="status-badge status-processing">Ordered</span></td>
                                        <td>
                                            <button class="btn btn-secondary btn-sm" onclick="viewRequiredMaterialDetail('RM-006')">Details</button>
                                            <button class="btn btn-warning btn-sm admin-only" onclick="editRequirement('RM-006')">Edit</button>
                                            <button class="btn btn-info btn-sm manager-feature" onclick="checkOrderStatus('RM-006')">Check Status</button>
                                        </td>
                                    </tr>
                                    <tr data-material-id="RM-007" data-category="plastics" data-priority="low">
                                        <td><strong>RM-007</strong></td>
                                        <td>Polystyrene Sheets</td>
                                        <td>Plastics</td>
                                        <td>80</td>
                                        <td>60</td>
                                        <td><strong style="color: #10b981;">20</strong></td>
                                        <td>Units</td>
                                        <td>$400.00</td>
                                        <td>2025-10-20</td>
                                        <td><span class="status-badge" style="background: #ecfdf5; color: #065f46;">Low</span></td>
                                        <td><span class="status-badge status-pending">Pending Order</span></td>
                                        <td>
                                            <button class="btn btn-success btn-sm admin-only" onclick="orderRawMaterial('RM-007')">Order Now</button>
                                            <button class="btn btn-secondary btn-sm" onclick="viewRequiredMaterialDetail('RM-007')">Details</button>
                                            <button class="btn btn-warning btn-sm manager-feature" onclick="requestPurchaseOrder('RM-007')">Request Order</button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <!-- Upcoming Raw Materials Table -->
                    <div id="upcomingRawMaterials" class="raw-material-section" style="display: none;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                            <h4 style="font-size: 18px; font-weight: 600; color: #1e293b;">Upcoming Raw Material Deliveries</h4>
                            <div style="display: flex; gap: 12px; align-items: center;">
                                <select class="form-select" style="width: auto;" id="upcomingStatusFilter">
                                    <option value="">All Status</option>
                                    <option value="ordered">Ordered</option>
                                    <option value="shipped">Shipped</option>
                                    <option value="in-transit">In Transit</option>
                                    <option value="delayed">Delayed</option>
                                </select>
                                <input type="text" class="form-input" placeholder="Search deliveries..." style="width: 200px;" id="upcomingSearchInput">
                                <button class="btn btn-primary btn-sm admin-only" onclick="showAddUpcomingOrderForm()">
                                    <i class="fas fa-plus"></i> Add New Order
                                </button>
                            </div>
                        </div>
                        
                        <!-- Upcoming Materials Stats -->
                        <div class="stats-grid" style="grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); margin-bottom: 20px;">
                            <div class="stat-card" style="border-left-color: #3b82f6;">
                                <div class="stat-number" id="totalUpcomingOrders">6</div>
                                <div class="stat-label">Total Orders</div>
                            </div>
                            <div class="stat-card" style="border-left-color: #10b981;">
                                <div class="stat-number" id="totalUpcomingValue">$28,900</div>
                                <div class="stat-label">Total Value</div>
                            </div>
                            <div class="stat-card" style="border-left-color: #f59e0b;">
                                <div class="stat-number" id="inTransitOrders">4</div>
                                <div class="stat-label">In Transit</div>
                            </div>
                            <div class="stat-card" style="border-left-color: #ef4444;">
                                <div class="stat-number" id="delayedOrders">1</div>
                                <div class="stat-label">Delayed</div>
                            </div>
                        </div>
                        
                        <!-- Upcoming Materials Table -->
                        <div class="table-container">
                            <table class="table" id="upcomingRawMaterialsTable">
                                <thead>
                                    <tr>
                                        <th>Order ID</th>
                                        <th>Material Name</th>
                                        <th>Category</th>
                                        <th>Ordered Qty</th>
                                        <th>Unit</th>
                                        <th>Supplier</th>
                                        <th>Order Date</th>
                                        <th>Expected Date</th>
                                        <th>Unit Price</th>
                                        <th>Total Cost</th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr data-order-id="PO-001" data-status="shipped">
                                        <td><strong>PO-001</strong></td>
                                        <td>Steel Rods</td>
                                        <td>Metals</td>
                                        <td>200</td>
                                        <td>Kg</td>
                                        <td>MetalCorp Ltd</td>
                                        <td>2025-09-20</td>
                                        <td>2025-10-02</td>
                                        <td>$18.50</td>
                                        <td>$3,700.00</td>
                                        <td><span class="status-badge status-processing">Shipped</span></td>
                                        <td>
                                            <button class="btn btn-secondary btn-sm" onclick="trackDelivery('PO-001')">Track</button>
                                            <button class="btn btn-success btn-sm manager-feature" onclick="receiveDelivery('PO-001')">Receive</button>
                                        </td>
                                    </tr>
                                    <tr data-order-id="PO-002" data-status="in-transit">
                                        <td><strong>PO-002</strong></td>
                                        <td>Chemical Solvent</td>
                                        <td>Chemicals</td>
                                        <td>100</td>
                                        <td>Ltr</td>
                                        <td>ChemSupply Co</td>
                                        <td>2025-09-25</td>
                                        <td>2025-10-05</td>
                                        <td>$45.00</td>
                                        <td>$4,500.00</td>
                                        <td><span class="status-badge status-ready">In Transit</span></td>
                                        <td>
                                            <button class="btn btn-secondary btn-sm" onclick="trackDelivery('PO-002')">Track</button>
                                            <button class="btn btn-warning btn-sm admin-only" onclick="editUpcomingOrder('PO-002')">Edit</button>
                                            <button class="btn btn-info btn-sm manager-feature" onclick="requestDeliveryUpdate('PO-002')">Request Update</button>
                                        </td>
                                    </tr>
                                    <tr data-order-id="PO-003" data-status="delayed">
                                        <td><strong>PO-003</strong></td>
                                        <td>Fabric Rolls</td>
                                        <td>Textiles</td>
                                        <td>150</td>
                                        <td>Meters</td>
                                        <td>TextilePro Inc</td>
                                        <td>2025-09-15</td>
                                        <td><span style="color: #ef4444;">2025-09-30 (Delayed)</span></td>
                                        <td>$22.75</td>
                                        <td>$3,412.50</td>
                                        <td><span class="status-badge" style="background: #fecaca; color: #991b1b;">Delayed</span></td>
                                        <td>
                                            <button class="btn btn-warning btn-sm manager-feature" onclick="contactSupplier('PO-003')">Contact Supplier</button>
                                            <button class="btn btn-secondary btn-sm" onclick="viewOrderDetails('PO-003')">Details</button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Users Page -->
            <div id="users" class="page">
                <!-- User List View -->
                <div id="userListView">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">User Management</h3>
                            <div style="display: flex; gap: 12px;">
                                <button class="btn btn-primary btn-sm" onclick="showAddUserForm()" id="addUserBtn">üë• Add Manager</button>
                                <button class="btn btn-secondary btn-sm" onclick="refreshUserList()">üîÑ Refresh</button>
                            </div>
                        </div>
                        
                        <!-- Admin Alert -->
                        <div class="alert alert-success">
                            <strong>üîí Admin Only Feature:</strong> Only administrators can manage user accounts. You can add, edit, or remove manager accounts from this section.
                        </div>
                        
                        <!-- Search and Filter -->
                        <div style="display: flex; gap: 16px; margin-bottom: 20px; flex-wrap: wrap; align-items: center;">
                            <div style="display: flex; gap: 12px; flex-wrap: wrap;">
                                <select class="form-select" style="width: auto;" id="userRoleFilter">
                                    <option value="">All Roles</option>
                                    <option value="admin">Admin</option>
                                    <option value="manager">Manager</option>
                                </select>
                                
                                <select class="form-select" style="width: auto;" id="userStatusFilter">
                                    <option value="">All Status</option>
                                    <option value="active">Active</option>
                                    <option value="inactive">Inactive</option>
                                </select>
                                
                                <input type="text" class="form-input" placeholder="Search users..." style="width: 250px;" id="userSearch">
                            </div>
                            
                            <button class="btn btn-secondary btn-sm" onclick="clearUserFilters()">Clear Filters</button>
                        </div>
                        
                        <!-- User Stats -->
                        <div class="stats-grid" style="grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); margin-bottom: 24px;">
                            <div class="stat-card" style="border-left-color: #3b82f6;">
                                <div class="stat-number" id="totalUsersCount">8</div>
                                <div class="stat-label">Total Users</div>
                            </div>
                            <div class="stat-card" style="border-left-color: #10b981;">
                                <div class="stat-number" id="activeUsersCount">7</div>
                                <div class="stat-label">Active Users</div>
                            </div>
                            <div class="stat-card" style="border-left-color: #f59e0b;">
                                <div class="stat-number" id="managerCount">5</div>
                                <div class="stat-label">Managers</div>
                            </div>
                            <div class="stat-card" style="border-left-color: #ef4444;">
                                <div class="stat-number" id="adminCount">3</div>
                                <div class="stat-label">Administrators</div>
                            </div>
                        </div>
                        
                        <!-- Users Table -->
                        <div class="table-container">
                            <table class="table" id="usersTable">
                                <thead>
                                    <tr>
                                        <th>User ID</th>
                                        <th>Name</th>
                                        <th>Username</th>
                                        <th>Email</th>
                                        <th>Role</th>
                                        <th>Status</th>
                                        <th>Last Login</th>
                                        <th>Created Date</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr data-user-id="USR-001" data-role="admin" data-status="active">
                                        <td><strong>USR-001</strong></td>
                                        <td>John Admin</td>
                                        <td>john.admin</td>
                                        <td>john.admin@company.com</td>
                                        <td><span class="status-badge" style="background: #dbeafe; color: #1e40af;">Admin</span></td>
                                        <td><span class="status-badge status-ready">‚úì Active</span></td>
                                        <td>2025-09-29 09:00</td>
                                        <td>2025-01-15</td>
                                        <td>
                                            <button class="btn btn-secondary btn-sm" onclick="viewUserDetail('USR-001')">View</button>
                                            <button class="btn btn-warning btn-sm" onclick="editUser('USR-001')">Edit</button>
                                            <button class="btn btn-danger btn-sm" onclick="deleteUser('USR-001')" disabled>Delete</button>
                                        </td>
                                    </tr>
                                    <tr data-user-id="USR-002" data-role="manager" data-status="active">
                                        <td><strong>USR-002</strong></td>
                                        <td>Sarah Manager</td>
                                        <td>sarah.mgr</td>
                                        <td>sarah.manager@company.com</td>
                                        <td><span class="status-badge" style="background: #d1fae5; color: #065f46;">Manager</span></td>
                                        <td><span class="status-badge status-ready">‚úì Active</span></td>
                                        <td>2025-09-28 16:30</td>
                                        <td>2025-02-20</td>
                                        <td>
                                            <button class="btn btn-secondary btn-sm" onclick="viewUserDetail('USR-002')">View</button>
                                            <button class="btn btn-warning btn-sm" onclick="editUser('USR-002')">Edit</button>
                                            <button class="btn btn-danger btn-sm" onclick="deleteUser('USR-002')">Delete</button>
                                        </td>
                                    </tr>
                                    <tr data-user-id="USR-003" data-role="manager" data-status="active">
                                        <td><strong>USR-003</strong></td>
                                        <td>Mike Production</td>
                                        <td>mike.prod</td>
                                        <td>mike.production@company.com</td>
                                        <td><span class="status-badge" style="background: #d1fae5; color: #065f46;">Manager</span></td>
                                        <td><span class="status-badge status-ready">‚úì Active</span></td>
                                        <td>2025-09-29 08:15</td>
                                        <td>2025-03-10</td>
                                        <td>
                                            <button class="btn btn-secondary btn-sm" onclick="viewUserDetail('USR-003')">View</button>
                                            <button class="btn btn-warning btn-sm" onclick="editUser('USR-003')">Edit</button>
                                            <button class="btn btn-danger btn-sm" onclick="deleteUser('USR-003')">Delete</button>
                                        </td>
                                    </tr>
                                    <tr data-user-id="USR-004" data-role="manager" data-status="inactive">
                                        <td><strong>USR-004</strong></td>
                                        <td>Lisa Quality</td>
                                        <td>lisa.quality</td>
                                        <td>lisa.quality@company.com</td>
                                        <td><span class="status-badge" style="background: #d1fae5; color: #065f46;">Manager</span></td>
                                        <td><span class="status-badge" style="background: #fecaca; color: #991b1b;">‚úó Inactive</span></td>
                                        <td>2025-09-15 10:45</td>
                                        <td>2025-04-05</td>
                                        <td>
                                            <button class="btn btn-secondary btn-sm" onclick="viewUserDetail('USR-004')">View</button>
                                            <button class="btn btn-warning btn-sm" onclick="editUser('USR-004')">Edit</button>
                                            <button class="btn btn-success btn-sm" onclick="activateUser('USR-004')">Activate</button>
                                        </td>
                                    </tr>
                                    <tr data-user-id="USR-005" data-role="admin" data-status="active">
                                        <td><strong>USR-005</strong></td>
                                        <td>David System</td>
                                        <td>david.sys</td>
                                        <td>david.system@company.com</td>
                                        <td><span class="status-badge" style="background: #dbeafe; color: #1e40af;">Admin</span></td>
                                        <td><span class="status-badge status-ready">‚úì Active</span></td>
                                        <td>2025-09-27 14:20</td>
                                        <td>2025-01-20</td>
                                        <td>
                                            <button class="btn btn-secondary btn-sm" onclick="viewUserDetail('USR-005')">View</button>
                                            <button class="btn btn-warning btn-sm" onclick="editUser('USR-005')">Edit</button>
                                            <button class="btn btn-danger btn-sm" onclick="deleteUser('USR-005')" disabled>Delete</button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                
                <!-- User Detail View -->
                <div id="userDetailView" style="display: none;">
                    <div style="display: flex; align-items: center; gap: 16px; margin-bottom: 24px;">
                        <button class="btn btn-secondary" onclick="showUserList()">‚Üê Back to Users</button>
                        <h2 id="userDetailTitle">User Details</h2>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 24px;">
                        <!-- User Information -->
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">User Information</h3>
                                <div id="userDetailActions">
                                    <!-- Actions will be populated based on user -->
                                </div>
                            </div>
                            
                            <div class="form-grid" id="userDetailInfo">
                                <!-- User details will be populated here -->
                            </div>
                        </div>
                        
                        <!-- User Activity -->
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">Recent Activity</h3>
                            </div>
                            
                            <div id="userActivity">
                                <!-- Activity will be populated here -->
                            </div>
                        </div>
                    </div>
                    
                    <!-- User Permissions -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Permissions & Access</h3>
                        </div>
                        
                        <div id="userPermissions">
                            <!-- Permissions will be populated here -->
                        </div>
                    </div>
                </div>
                
                <!-- Add/Edit User Form -->
                <div id="userFormView" style="display: none;">
                    <div style="display: flex; align-items: center; gap: 16px; margin-bottom: 24px;">
                        <button class="btn btn-secondary" onclick="showUserList()">‚Üê Back to Users</button>
                        <h2 id="userFormTitle">Add New Manager</h2>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title" id="userFormCardTitle">Manager Account Details</h3>
                        </div>
                        
                        <form id="userDetailsForm">
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">User ID</label>
                                    <input type="text" class="form-input" id="formUserId" placeholder="Auto-generated" readonly style="background: #f1f5f9;">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Full Name *</label>
                                    <input type="text" class="form-input" id="formUserName" placeholder="Enter full name" required>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">Username *</label>
                                    <input type="text" class="form-input" id="formUsername" placeholder="Enter username" required>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Email Address *</label>
                                    <input type="email" class="form-input" id="formUserEmail" placeholder="Enter email address" required>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">Role *</label>
                                    <select class="form-select" id="formUserRole" required>
                                        <option value="">Select Role</option>
                                        <option value="manager" selected>Manager</option>
                                        <option value="admin">Administrator</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Department</label>
                                    <select class="form-select" id="formUserDepartment">
                                        <option value="">Select Department</option>
                                        <option value="production">Production</option>
                                        <option value="quality">Quality Control</option>
                                        <option value="inventory">Inventory Management</option>
                                        <option value="shipping">Shipping & Logistics</option>
                                        <option value="sales">Sales & Orders</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">Password *</label>
                                    <input type="password" class="form-input" id="formUserPassword" placeholder="Enter password" required>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Confirm Password *</label>
                                    <input type="password" class="form-input" id="formUserPasswordConfirm" placeholder="Confirm password" required>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">Phone Number</label>
                                    <input type="tel" class="form-input" id="formUserPhone" placeholder="Enter phone number">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Status</label>
                                    <select class="form-select" id="formUserStatus">
                                        <option value="active" selected>Active</option>
                                        <option value="inactive">Inactive</option>
                                    </select>
                                </div>
                            </div>
                            
                            <!-- Permissions Section -->
                            <div class="form-group">
                                <label class="form-label">Permissions</label>
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; padding: 16px; background: #f8fafc; border-radius: 8px; border: 1px solid #e2e8f0;">
                                    <label style="display: flex; align-items: center; gap: 8px;">
                                        <input type="checkbox" id="permOrderManage" checked>
                                        <span>Manage Orders</span>
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 8px;">
                                        <input type="checkbox" id="permOrderStatus">
                                        <span>Update Order Status</span>
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 8px;">
                                        <input type="checkbox" id="permInventoryView" checked>
                                        <span>View Inventory</span>
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 8px;">
                                        <input type="checkbox" id="permInventoryUpdate">
                                        <span>Update Inventory</span>
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 8px;">
                                        <input type="checkbox" id="permReports" checked>
                                        <span>Generate Reports</span>
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 8px;">
                                        <input type="checkbox" id="permUsers">
                                        <span>Manage Users (Admin Only)</span>
                                    </label>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Notes</label>
                                <textarea class="form-input" id="formUserNotes" rows="3" placeholder="Additional notes about this user..."></textarea>
                            </div>
                            
                            <div style="display: flex; gap: 12px; justify-content: flex-end; margin-top: 24px;">
                                <button type="button" onclick="showUserList()" class="btn btn-secondary">Cancel</button>
                                <button type="submit" class="btn btn-primary" id="userFormSubmit">Create Manager Account</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Profile Page -->
            <div id="profile" class="page">
                <!-- Profile Overview -->
                <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 24px; margin-bottom: 24px;">
                    <!-- Profile Card -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Profile Information</h3>
                            <button class="btn btn-warning btn-sm" onclick="editProfile()" id="editProfileBtn">‚úèÔ∏è Edit Profile</button>
                        </div>
                        
                        <div style="text-align: center; margin-bottom: 24px;">
                            <div style="width: 120px; height: 120px; background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%); border-radius: 50%; margin: 0 auto 16px; display: flex; align-items: center; justify-content: center; color: white; font-size: 48px; font-weight: 600;" id="profileAvatar">
                                <!-- Avatar will be populated based on user -->
                            </div>
                            <h3 style="margin: 0 0 8px 0; color: #1e293b;" id="profileName">Loading...</h3>
                            <p style="color: #64748b; margin: 0;" id="profileRole">Loading...</p>
                            <div style="display: inline-flex; align-items: center; gap: 4px; margin-top: 8px; padding: 4px 12px; background: #ecfdf5; border-radius: 16px; font-size: 12px; color: #065f46;">
                                <div style="width: 8px; height: 8px; background: #10b981; border-radius: 50%;"></div>
                                <span>Online</span>
                            </div>
                        </div>
                        
                        <div class="form-grid" id="profileBasicInfo">
                            <!-- Basic info will be populated here -->
                        </div>
                    </div>
                    
                    <!-- Account Details -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Account Details</h3>
                            <button class="btn btn-secondary btn-sm" onclick="changePassword()">üîí Change Password</button>
                        </div>
                        
                        <div class="form-grid" id="profileAccountInfo">
                            <!-- Account info will be populated here -->
                        </div>
                        
                        <!-- Quick Stats -->
                        <div style="margin-top: 24px;">
                            <h4 style="font-size: 16px; font-weight: 600; margin-bottom: 16px;">Activity Overview</h4>
                            <div class="stats-grid" style="grid-template-columns: 1fr 1fr; margin: 0;">
                                <div class="stat-card" style="margin: 0; border-left-color: #3b82f6;">
                                    <div class="stat-number" id="profileOrdersCount">0</div>
                                    <div class="stat-label">Orders Managed</div>
                                </div>
                                <div class="stat-card" style="margin: 0; border-left-color: #10b981;">
                                    <div class="stat-number" id="profileLoginCount">0</div>
                                    <div class="stat-label">Login Sessions</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Settings Sections -->
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px;">
                    <!-- Preferences -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Preferences</h3>
                        </div>
                        
                        <form id="preferencesForm">
                            <div class="form-group">
                                <label class="form-label">Language</label>
                                <select class="form-select" id="prefLanguage">
                                    <option value="en" selected>English</option>
                                    <option value="es">Spanish</option>
                                    <option value="fr">French</option>
                                    <option value="de">German</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Theme</label>
                                <select class="form-select" id="prefTheme">
                                    <option value="light" selected>Light</option>
                                    <option value="dark">Dark</option>
                                    <option value="auto">Auto (System)</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Dashboard Layout</label>
                                <select class="form-select" id="prefLayout">
                                    <option value="default" selected>Default</option>
                                    <option value="compact">Compact</option>
                                    <option value="wide">Wide</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Items per Page</label>
                                <select class="form-select" id="prefItemsPerPage">
                                    <option value="10">10 items</option>
                                    <option value="25" selected>25 items</option>
                                    <option value="50">50 items</option>
                                    <option value="100">100 items</option>
                                </select>
                            </div>
                            
                            <button type="submit" class="btn btn-primary">üíæ Save Preferences</button>
                        </form>
                    </div>
                    
                    <!-- Notifications -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Notification Settings</h3>
                        </div>
                        
                        <form id="notificationForm">
                            <div class="form-group">
                                <label class="form-label">Email Notifications</label>
                                <div style="display: flex; flex-direction: column; gap: 8px; padding: 12px; background: #f8fafc; border-radius: 8px; border: 1px solid #e2e8f0;">
                                    <label style="display: flex; align-items: center; gap: 8px;">
                                        <input type="checkbox" id="notifyOrderUpdates" checked>
                                        <span>Order Status Updates</span>
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 8px;">
                                        <input type="checkbox" id="notifyLowStock" checked>
                                        <span>Low Stock Alerts</span>
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 8px;">
                                        <input type="checkbox" id="notifyNewOrders">
                                        <span>New Order Notifications</span>
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 8px;">
                                        <input type="checkbox" id="notifyReports">
                                        <span>Weekly Reports</span>
                                    </label>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Browser Notifications</label>
                                <div style="display: flex; flex-direction: column; gap: 8px; padding: 12px; background: #f8fafc; border-radius: 8px; border: 1px solid #e2e8f0;">
                                    <label style="display: flex; align-items: center; gap: 8px;">
                                        <input type="checkbox" id="browserNotifyUrgent" checked>
                                        <span>Urgent Alerts</span>
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 8px;">
                                        <input type="checkbox" id="browserNotifyMentions">
                                        <span>Mentions & Updates</span>
                                    </label>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Notification Frequency</label>
                                <select class="form-select" id="notificationFrequency">
                                    <option value="immediate" selected>Immediate</option>
                                    <option value="hourly">Hourly Summary</option>
                                    <option value="daily">Daily Summary</option>
                                    <option value="weekly">Weekly Summary</option>
                                </select>
                            </div>
                            
                            <button type="submit" class="btn btn-primary">üîî Update Notifications</button>
                        </form>
                    </div>
                </div>
                
                <!-- Recent Activity -->
                <div class="card" style="margin-top: 24px;">
                    <div class="card-header">
                        <h3 class="card-title">Recent Activity</h3>
                        <div style="display: flex; gap: 8px;">
                            <button class="btn btn-secondary btn-sm" onclick="clearActivityLog()">üóëÔ∏è Clear Log</button>
                            <button class="btn btn-secondary btn-sm" onclick="exportActivityLog()">üì§ Export</button>
                        </div>
                    </div>
                    
                    <div class="table-container">
                        <table class="table" id="activityTable">
                            <thead>
                                <tr>
                                    <th>Date & Time</th>
                                    <th>Action</th>
                                    <th>Details</th>
                                    <th>Status</th>
                                    <th>IP Address</th>
                                </tr>
                            </thead>
                            <tbody id="activityTableBody">
                                <!-- Activity will be populated here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Stock Modal -->
    <div id="editStockModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000;">
        <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 32px; border-radius: 16px; width: 90%; max-width: 500px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
                <h3 style="font-size: 20px; font-weight: 600;">Edit Stock - <span id="editStockItemCode"></span></h3>
                <button onclick="closeEditStockModal()" style="background: none; border: none; font-size: 24px; cursor: pointer; color: #64748b;">√ó</button>
            </div>
            
            <form id="editStockForm">
                <div class="form-group">
                    <label class="form-label">Item Name</label>
                    <input type="text" class="form-input" id="editStockItemName" readonly style="background: #f1f5f9;">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Current Stock: <strong id="editCurrentStock">0</strong></label>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Action Type</label>
                    <select class="form-select" id="editStockAction" required>
                        <option value="">Select Action</option>
                        <option value="add">Add Stock (Incoming)</option>
                        <option value="remove">Remove Stock (Outgoing)</option>
                        <option value="adjust">Adjust Stock (Correction)</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Quantity</label>
                    <input type="number" class="form-input" id="editStockQuantity" placeholder="Enter quantity" min="0" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">New Stock Level</label>
                    <input type="number" class="form-input" id="editNewStock" readonly style="background: #f1f5f9;">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Reason *</label>
                    <textarea class="form-input" id="editStockReason" rows="3" placeholder="Reason for stock adjustment..." required></textarea>
                </div>
                
                <div style="display: flex; gap: 12px; justify-content: flex-end; margin-top: 24px;">
                    <button type="button" onclick="closeEditStockModal()" class="btn btn-secondary">Cancel</button>
                    <button type="submit" class="btn btn-primary">Update Stock</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Stock History Modal -->
    <div id="stockHistoryModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000;">
        <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 32px; border-radius: 16px; width: 90%; max-width: 800px; max-height: 80vh; overflow-y: auto;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
                <h3 style="font-size: 20px; font-weight: 600;">Stock History - <span id="historyItemCode"></span></h3>
                <button onclick="closeStockHistoryModal()" style="background: none; border: none; font-size: 24px; cursor: pointer; color: #64748b;">√ó</button>
            </div>
            
            <div class="table-container">
                <table class="table">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Type</th>
                            <th>Quantity</th>
                            <th>Previous</th>
                            <th>New Stock</th>
                            <th>Reason</th>
                            <th>By</th>
                        </tr>
                    </thead>
                    <tbody id="historyModalBody">
                        <!-- History will be populated here -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <div id="statusModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000;">
        <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 32px; border-radius: 16px; width: 90%; max-width: 400px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
                <h3 style="font-size: 20px; font-weight: 600;">Update Order Status</h3>
                <button onclick="closeStatusModal()" style="background: none; border: none; font-size: 24px; cursor: pointer; color: #64748b;">√ó</button>
            </div>
            
            <form id="statusForm">
                <div class="form-group">
                    <label class="form-label">Order ID: <strong id="statusOrderId">ORD-001</strong></label>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Current Status: <strong id="currentStatus">Under Process</strong></label>
                </div>
                
                <div class="form-group">
                    <label class="form-label">New Status</label>
                    <select class="form-select" id="newStatus" required>
                        <option value="">Select New Status</option>
                        <option value="yet-to-process">Yet to Process</option>
                        <option value="under-process">Under Process/Production</option>
                        <option value="ready-to-dispatch">Ready to Dispatch</option>
                        <option value="shipped">Shipped</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Comments</label>
                    <textarea class="form-input" rows="3" placeholder="Add status update notes..."></textarea>
                </div>
                
                <div style="display: flex; gap: 12px; justify-content: flex-end; margin-top: 24px;">
                    <button type="button" onclick="closeStatusModal()" class="btn btn-secondary">Cancel</button>
                    <button type="submit" class="btn btn-success">Update Status</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Edit Profile Modal -->
    <div id="editProfileModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000;">
        <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 32px; border-radius: 16px; width: 90%; max-width: 600px; max-height: 80vh; overflow-y: auto;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
                <h3 style="font-size: 20px; font-weight: 600;">Edit Profile</h3>
                <button onclick="closeEditProfileModal()" style="background: none; border: none; font-size: 24px; cursor: pointer; color: #64748b;">√ó</button>
            </div>
            
            <form id="editProfileForm">
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">First Name *</label>
                        <input type="text" class="form-input" id="editFirstName" placeholder="Enter first name" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Last Name *</label>
                        <input type="text" class="form-input" id="editLastName" placeholder="Enter last name" required>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Email Address *</label>
                        <input type="email" class="form-input" id="editEmail" placeholder="Enter email address" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Phone Number</label>
                        <input type="tel" class="form-input" id="editPhone" placeholder="Enter phone number">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Department</label>
                        <input type="text" class="form-input" id="editDepartment" placeholder="Enter department" readonly style="background: #f1f5f9;">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Job Title</label>
                        <input type="text" class="form-input" id="editJobTitle" placeholder="Enter job title">
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Bio</label>
                    <textarea class="form-input" id="editBio" rows="3" placeholder="Tell us about yourself..."></textarea>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Location</label>
                        <input type="text" class="form-input" id="editLocation" placeholder="City, Country">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Time Zone</label>
                        <select class="form-select" id="editTimezone">
                            <option value="UTC-5">Eastern Time (UTC-5)</option>
                            <option value="UTC-6">Central Time (UTC-6)</option>
                            <option value="UTC-7">Mountain Time (UTC-7)</option>
                            <option value="UTC-8">Pacific Time (UTC-8)</option>
                            <option value="UTC+0" selected>UTC+0 (London)</option>
                            <option value="UTC+1">Central European Time (UTC+1)</option>
                            <option value="UTC+8">China Standard Time (UTC+8)</option>
                        </select>
                    </div>
                </div>
                
                <div style="display: flex; gap: 12px; justify-content: flex-end; margin-top: 24px;">
                    <button type="button" onclick="closeEditProfileModal()" class="btn btn-secondary">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save Changes</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Change Password Modal -->
    <div id="changePasswordModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000;">
        <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 32px; border-radius: 16px; width: 90%; max-width: 500px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
                <h3 style="font-size: 20px; font-weight: 600;">Change Password</h3>
                <button onclick="closeChangePasswordModal()" style="background: none; border: none; font-size: 24px; cursor: pointer; color: #64748b;">√ó</button>
            </div>
            
            <div class="alert alert-success" style="margin-bottom: 20px;">
                <strong>üîí Security Tip:</strong> Use a strong password with at least 8 characters, including uppercase, lowercase, numbers, and special characters.
            </div>
            
            <form id="changePasswordForm">
                <div class="form-group">
                    <label class="form-label">Current Password *</label>
                    <input type="password" class="form-input" id="currentPassword" placeholder="Enter current password" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">New Password *</label>
                    <input type="password" class="form-input" id="newPassword" placeholder="Enter new password" required minlength="8">
                    <div style="font-size: 12px; color: #64748b; margin-top: 4px;">Minimum 8 characters</div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Confirm New Password *</label>
                    <input type="password" class="form-input" id="confirmNewPassword" placeholder="Confirm new password" required>
                </div>
                
                <!-- Password Strength Indicator -->
                <div class="form-group">
                    <label class="form-label">Password Strength</label>
                    <div style="display: flex; gap: 4px; margin-bottom: 8px;">
                        <div id="strength1" style="height: 4px; flex: 1; background: #e5e7eb; border-radius: 2px;"></div>
                        <div id="strength2" style="height: 4px; flex: 1; background: #e5e7eb; border-radius: 2px;"></div>
                        <div id="strength3" style="height: 4px; flex: 1; background: #e5e7eb; border-radius: 2px;"></div>
                        <div id="strength4" style="height: 4px; flex: 1; background: #e5e7eb; border-radius: 2px;"></div>
                    </div>
                    <div id="strengthText" style="font-size: 12px; color: #64748b;">Enter a password to see strength</div>
                </div>
                
                <div style="display: flex; gap: 12px; justify-content: flex-end; margin-top: 24px;">
                    <button type="button" onclick="closeChangePasswordModal()" class="btn btn-secondary">Cancel</button>
                    <button type="submit" class="btn btn-primary">Update Password</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Raw Material Edit Modal -->
    <div id="rawMaterialEditModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000;">
        <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 32px; border-radius: 16px; width: 90%; max-width: 600px; max-height: 80vh; overflow-y: auto;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
                <h3 style="font-size: 20px; font-weight: 600;" id="rawMaterialEditTitle">Edit Raw Material</h3>
                <button onclick="closeRawMaterialEditModal()" style="background: none; border: none; font-size: 24px; cursor: pointer; color: #64748b;">&times;</button>
            </div>
            
            <form id="rawMaterialEditForm">
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Material ID</label>
                        <input type="text" class="form-input" id="editRawMaterialId" readonly style="background: #f1f5f9;">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Material Name *</label>
                        <input type="text" class="form-input" id="editRawMaterialName" placeholder="Enter material name" required>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Category *</label>
                        <select class="form-select" id="editRawMaterialCategory" required>
                            <option value="">Select Category</option>
                            <option value="metals">Metals</option>
                            <option value="chemicals">Chemicals</option>
                            <option value="plastics">Plastics</option>
                            <option value="textiles">Textiles</option>
                            <option value="electronics">Electronics</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Unit *</label>
                        <select class="form-select" id="editRawMaterialUnit" required>
                            <option value="">Select Unit</option>
                            <option value="Kg">Kilograms (Kg)</option>
                            <option value="Ltr">Liters (Ltr)</option>
                            <option value="Units">Units</option>
                            <option value="Meters">Meters</option>
                            <option value="Pcs">Pieces (Pcs)</option>
                            <option value="Tons">Tons</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Current Stock *</label>
                        <input type="number" class="form-input" id="editRawMaterialStock" placeholder="Enter current stock" min="0" step="0.01" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Unit Price ($) *</label>
                        <input type="number" class="form-input" id="editRawMaterialPrice" placeholder="Enter unit price" min="0" step="0.01" required>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Minimum Level *</label>
                        <input type="number" class="form-input" id="editRawMaterialMinLevel" placeholder="Enter minimum stock level" min="0" step="0.01" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Total Value</label>
                        <input type="text" class="form-input" id="editRawMaterialTotalValue" readonly style="background: #f1f5f9;">
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Supplier Information</label>
                    <input type="text" class="form-input" id="editRawMaterialSupplier" placeholder="Enter supplier name">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Description/Notes</label>
                    <textarea class="form-input" id="editRawMaterialDescription" rows="3" placeholder="Enter material description or notes..."></textarea>
                </div>
                
                <div style="display: flex; gap: 12px; justify-content: flex-end; margin-top: 24px;">
                    <button type="button" onclick="closeRawMaterialEditModal()" class="btn btn-secondary">Cancel</button>
                    <button type="submit" class="btn btn-primary">Update Material</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Raw Material Add Modal -->
    <div id="rawMaterialAddModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000;">
        <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 32px; border-radius: 16px; width: 90%; max-width: 600px; max-height: 80vh; overflow-y: auto;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
                <h3 style="font-size: 20px; font-weight: 600;">Add New Raw Material</h3>
                <button onclick="closeRawMaterialAddModal()" style="background: none; border: none; font-size: 24px; cursor: pointer; color: #64748b;">&times;</button>
            </div>
            
            <form id="rawMaterialAddForm">
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Material ID</label>
                        <input type="text" class="form-input" id="addRawMaterialId" readonly style="background: #f1f5f9;" placeholder="Auto-generated">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Material Name *</label>
                        <input type="text" class="form-input" id="addRawMaterialName" placeholder="Enter material name" required>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Category *</label>
                        <select class="form-select" id="addRawMaterialCategory" required>
                            <option value="">Select Category</option>
                            <option value="metals">Metals</option>
                            <option value="chemicals">Chemicals</option>
                            <option value="plastics">Plastics</option>
                            <option value="textiles">Textiles</option>
                            <option value="electronics">Electronics</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Unit *</label>
                        <select class="form-select" id="addRawMaterialUnit" required>
                            <option value="">Select Unit</option>
                            <option value="Kg">Kilograms (Kg)</option>
                            <option value="Ltr">Liters (Ltr)</option>
                            <option value="Units">Units</option>
                            <option value="Meters">Meters</option>
                            <option value="Pcs">Pieces (Pcs)</option>
                            <option value="Tons">Tons</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Initial Stock *</label>
                        <input type="number" class="form-input" id="addRawMaterialStock" placeholder="Enter initial stock" min="0" step="0.01" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Unit Price ($) *</label>
                        <input type="number" class="form-input" id="addRawMaterialPrice" placeholder="Enter unit price" min="0" step="0.01" required>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Minimum Level *</label>
                        <input type="number" class="form-input" id="addRawMaterialMinLevel" placeholder="Enter minimum stock level" min="0" step="0.01" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Total Value</label>
                        <input type="text" class="form-input" id="addRawMaterialTotalValue" readonly style="background: #f1f5f9;" placeholder="Auto-calculated">
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Supplier Information</label>
                    <input type="text" class="form-input" id="addRawMaterialSupplier" placeholder="Enter supplier name">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Description/Notes</label>
                    <textarea class="form-input" id="addRawMaterialDescription" rows="3" placeholder="Enter material description or notes..."></textarea>
                </div>
                
                <div style="display: flex; gap: 12px; justify-content: flex-end; margin-top: 24px;">
                    <button type="button" onclick="closeRawMaterialAddModal()" class="btn btn-secondary">Cancel</button>
                    <button type="submit" class="btn btn-primary">Add Material</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Stock Adjustment Modal -->
    <div id="stockAdjustmentModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000;">
        <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 32px; border-radius: 16px; width: 90%; max-width: 500px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
                <h3 style="font-size: 20px; font-weight: 600;">Adjust Stock - <span id="stockAdjustMaterialId"></span></h3>
                <button onclick="closeStockAdjustmentModal()" style="background: none; border: none; font-size: 24px; cursor: pointer; color: #64748b;">&times;</button>
            </div>
            
            <form id="stockAdjustmentForm">
                <div class="form-group">
                    <label class="form-label">Material Name</label>
                    <input type="text" class="form-input" id="stockAdjustMaterialName" readonly style="background: #f1f5f9;">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Current Stock: <strong id="stockAdjustCurrentStock">0</strong> <span id="stockAdjustUnit">Units</span></label>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Adjustment Type *</label>
                    <select class="form-select" id="stockAdjustmentType" required>
                        <option value="">Select Action</option>
                        <option value="add">Add Stock (Incoming)</option>
                        <option value="remove">Remove Stock (Used/Sold)</option>
                        <option value="set">Set Stock (Correction)</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Quantity *</label>
                    <input type="number" class="form-input" id="stockAdjustmentQuantity" placeholder="Enter quantity" min="0" step="0.01" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">New Stock Level</label>
                    <input type="text" class="form-input" id="stockAdjustNewLevel" readonly style="background: #f1f5f9;" placeholder="Will be calculated">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Reason/Notes *</label>
                    <textarea class="form-input" id="stockAdjustmentReason" rows="3" placeholder="Enter reason for stock adjustment..." required></textarea>
                </div>
                
                <div style="display: flex; gap: 12px; justify-content: flex-end; margin-top: 24px;">
                    <button type="button" onclick="closeStockAdjustmentModal()" class="btn btn-secondary">Cancel</button>
                    <button type="submit" class="btn btn-primary">Adjust Stock</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Required Material Modal -->
    <div id="addRequiredMaterialModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000;">
        <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 32px; border-radius: 16px; width: 90%; max-width: 600px; max-height: 80vh; overflow-y: auto;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
                <h3 style="font-size: 20px; font-weight: 600;">Add Required Material</h3>
                <button onclick="closeAddRequiredMaterialModal()" style="background: none; border: none; font-size: 24px; cursor: pointer; color: #64748b;">&times;</button>
            </div>
            
            <form id="addRequiredMaterialForm">
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Requirement ID</label>
                        <input type="text" class="form-input" id="addReqMaterialId" readonly style="background: #f1f5f9;" placeholder="Auto-generated">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Material Name *</label>
                        <input type="text" class="form-input" id="addReqMaterialName" placeholder="Enter material name" required>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Category *</label>
                        <select class="form-select" id="addReqMaterialCategory" required>
                            <option value="">Select Category</option>
                            <option value="metals">Metals</option>
                            <option value="chemicals">Chemicals</option>
                            <option value="plastics">Plastics</option>
                            <option value="textiles">Textiles</option>
                            <option value="electronics">Electronics</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Unit *</label>
                        <select class="form-select" id="addReqMaterialUnit" required>
                            <option value="">Select Unit</option>
                            <option value="Kg">Kilograms (Kg)</option>
                            <option value="Ltr">Liters (Ltr)</option>
                            <option value="Units">Units</option>
                            <option value="Meters">Meters</option>
                            <option value="Pcs">Pieces (Pcs)</option>
                            <option value="Tons">Tons</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Required Quantity *</label>
                        <input type="number" class="form-input" id="addReqQuantity" placeholder="Enter required quantity" min="0" step="0.01" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Estimated Unit Price ($)</label>
                        <input type="number" class="form-input" id="addReqPrice" placeholder="Enter estimated price" min="0" step="0.01">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Required By Date *</label>
                        <input type="date" class="form-input" id="addReqDate" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Priority *</label>
                        <select class="form-select" id="addReqPriority" required>
                            <option value="">Select Priority</option>
                            <option value="low">Low</option>
                            <option value="medium" selected>Medium</option>
                            <option value="high">High</option>
                            <option value="critical">Critical</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Estimated Total Cost</label>
                    <input type="text" class="form-input" id="addReqTotalCost" readonly style="background: #f1f5f9;" placeholder="Auto-calculated">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Purpose/Description</label>
                    <textarea class="form-input" id="addReqDescription" rows="3" placeholder="Explain why this material is required..."></textarea>
                </div>
                
                <div style="display: flex; gap: 12px; justify-content: flex-end; margin-top: 24px;">
                    <button type="button" onclick="closeAddRequiredMaterialModal()" class="btn btn-secondary">Cancel</button>
                    <button type="submit" class="btn btn-warning">Add Requirement</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Upcoming Order Modal -->
    <div id="addUpcomingOrderModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000;">
        <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 32px; border-radius: 16px; width: 90%; max-width: 600px; max-height: 80vh; overflow-y: auto;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
                <h3 style="font-size: 20px; font-weight: 600;">Add New Purchase Order</h3>
                <button onclick="closeAddUpcomingOrderModal()" style="background: none; border: none; font-size: 24px; cursor: pointer; color: #64748b;">&times;</button>
            </div>
            
            <form id="addUpcomingOrderForm">
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Purchase Order ID</label>
                        <input type="text" class="form-input" id="addUpcomingOrderId" readonly style="background: #f1f5f9;" placeholder="Auto-generated">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Material Name *</label>
                        <input type="text" class="form-input" id="addUpcomingMaterialName" placeholder="Enter material name" required>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Category *</label>
                        <select class="form-select" id="addUpcomingCategory" required>
                            <option value="">Select Category</option>
                            <option value="metals">Metals</option>
                            <option value="chemicals">Chemicals</option>
                            <option value="plastics">Plastics</option>
                            <option value="textiles">Textiles</option>
                            <option value="electronics">Electronics</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Unit *</label>
                        <select class="form-select" id="addUpcomingUnit" required>
                            <option value="">Select Unit</option>
                            <option value="Kg">Kilograms (Kg)</option>
                            <option value="Ltr">Liters (Ltr)</option>
                            <option value="Units">Units</option>
                            <option value="Meters">Meters</option>
                            <option value="Pcs">Pieces (Pcs)</option>
                            <option value="Tons">Tons</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Ordered Quantity *</label>
                        <input type="number" class="form-input" id="addUpcomingQuantity" placeholder="Enter ordered quantity" min="0" step="0.01" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Unit Price ($) *</label>
                        <input type="number" class="form-input" id="addUpcomingPrice" placeholder="Enter unit price" min="0" step="0.01" required>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Supplier *</label>
                        <input type="text" class="form-input" id="addUpcomingSupplier" placeholder="Enter supplier name" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Total Cost</label>
                        <input type="text" class="form-input" id="addUpcomingTotalCost" readonly style="background: #f1f5f9;" placeholder="Auto-calculated">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Order Date</label>
                        <input type="date" class="form-input" id="addUpcomingOrderDate" readonly style="background: #f1f5f9;">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Expected Delivery Date *</label>
                        <input type="date" class="form-input" id="addUpcomingDeliveryDate" required>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Order Status</label>
                    <select class="form-select" id="addUpcomingStatus">
                        <option value="ordered" selected>Ordered</option>
                        <option value="confirmed">Confirmed</option>
                        <option value="shipped">Shipped</option>
                        <option value="in-transit">In Transit</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Notes</label>
                    <textarea class="form-input" id="addUpcomingNotes" rows="3" placeholder="Additional notes about this order..."></textarea>
                </div>
                
                <div style="display: flex; gap: 12px; justify-content: flex-end; margin-top: 24px;">
                    <button type="button" onclick="closeAddUpcomingOrderModal()" class="btn btn-secondary">Cancel</button>
                    <button type="submit" class="btn btn-primary">Create Purchase Order</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        let currentUser = null;
        
        // Login functionality - MUST BE FIRST
        window.addEventListener('DOMContentLoaded', function() {
            console.log('Page loaded, setting up login...');
            
            const loginForm = document.getElementById('loginForm');
            console.log('Login form found:', loginForm);
            
            // Auto-select role when username changes
            const usernameInput = document.getElementById('username');
            const roleSelect = document.getElementById('userRole');
            
            if (usernameInput && roleSelect) {
                usernameInput.addEventListener('input', function() {
                    const username = this.value.toLowerCase();
                    if (username === 'admin') {
                        roleSelect.value = 'admin';
                    } else if (username === 'manager') {
                        roleSelect.value = 'manager';
                    }
                });
            }
            
            if (loginForm) {
                loginForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    console.log('Login form submitted!');
                    
                    const username = document.getElementById('username').value.trim();
                    const password = document.getElementById('password').value.trim();
                    const roleSelect = document.getElementById('userRole');
                    
                    // Auto-select role based on username
                    if (username === 'admin') {
                        roleSelect.value = 'admin';
                    } else if (username === 'manager') {
                        roleSelect.value = 'manager';
                    }
                    
                    const role = roleSelect.value;
                    
                    console.log('Login attempt:', { username, role });
                    
                    // Make API call to authenticate
                    console.log('Sending login request...');
                    fetch('/api/auth/login', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            username: username,
                            password: password
                        })
                    })
                    .then(async response => {
                        console.log('Response received:', response.status, response.statusText);
                        
                        // Try to parse JSON response
                        let data;
                        try {
                            const text = await response.text();
                            console.log('Response body:', text);
                            data = text ? JSON.parse(text) : {};
                        } catch (e) {
                            console.error('Failed to parse response:', e);
                            data = {};
                        }
                        
                        if (!response.ok) {
                            const errorMsg = data.error || `Login failed (${response.status})`;
                            console.error('Login error:', errorMsg);
                            throw new Error(errorMsg);
                        }
                        
                        return data;
                    })
                    .then(data => {
                        console.log('Login response data:', data);
                        
                        if (data.access_token && data.user) {
                            console.log('Login successful!');
                            
                            // Use the actual role from the API response (backend is source of truth)
                            const actualRole = data.user.role;
                            console.log('User role from API:', actualRole);
                            
                            // Optional: Show info if role dropdown doesn't match (but don't block login)
                            const selectedRole = roleSelect.value;
                            if (selectedRole !== actualRole) {
                                console.log('Role adjusted:', { selectedRole, actualRole });
                                // Auto-update dropdown to match actual role
                                roleSelect.value = actualRole;
                            }
                            
                            currentUser = actualRole;
                            
                            // Store token for future API calls
                            localStorage.setItem('authToken', data.access_token);
                            localStorage.setItem('userInfo', JSON.stringify(data.user));
                            
                            // Hide login, show main app
                            document.getElementById('loginPage').style.display = 'none';
                            document.getElementById('mainApp').style.display = 'block';
                            
                            // Update the user display in the header
                            const userDisplay = document.querySelector('.user-info');
                            if (userDisplay) {
                                userDisplay.innerHTML = `
                                    <span class="user-role">${actualRole.toUpperCase()}</span>
                                    <span class="user-name">${data.user.full_name}</span>
                                `;
                            }
                            
                            // Set role-based permissions
                            setRolePermissions(actualRole);
                            
                            // Load dashboard data
                            loadDashboardData();
                            
                            showNotification(`Login successful as ${actualRole}!`, 'success');
                        } else {
                            console.error('Login failed - no access token or user data:', data);
                            const errorMsg = data.error || 'Invalid credentials!';
                            showNotification(errorMsg, 'error');
                        }
                    })
                    .catch(error => {
                        console.error('Login error:', error);
                        const errorMessage = error.message || 'Login failed. Please try again.';
                        showNotification(errorMessage, 'error');
                    });
                });
            } else {
                console.error('Login form not found!');
            }
        });
        
        function setRolePermissions(role) {
            // Add role class to body for CSS targeting
            document.body.className = `role-${role}`;
            
            const usersTab = document.getElementById('usersTab');
            const adminDashboard = document.getElementById('adminDashboard');
            const managerDashboard = document.getElementById('managerDashboard');
            const addOrderBtn = document.getElementById('addOrderBtn');
            
            if (role === 'manager') {
                // Hide users tab for managers (NO user management access)
                if (usersTab) usersTab.style.display = 'none';
                
                // Show manager dashboard, hide admin dashboard
                if (adminDashboard) adminDashboard.style.display = 'none';
                if (managerDashboard) managerDashboard.style.display = 'block';
                
                // Manager can add orders, so show the button
                if (addOrderBtn) addOrderBtn.style.display = 'inline-flex';
                
                // Hide admin-only features in orders
                hideAdminFeatures();
                
                // Hide admin-only navigation items
                hideAdminNavigation();
                
                console.log('Manager permissions applied - limited access');
            } else if (role === 'admin') {
                // Show all features for admins
                if (usersTab) usersTab.style.display = 'block';
                
                // Show admin dashboard, hide manager dashboard
                if (adminDashboard) adminDashboard.style.display = 'block';
                if (managerDashboard) managerDashboard.style.display = 'none';
                
                // Show add order button for admins
                if (addOrderBtn) addOrderBtn.style.display = 'inline-flex';
                
                // Show admin-only features in orders
                showAdminFeatures();
                
                // Show admin navigation
                showAdminNavigation();
                
                console.log('Admin permissions applied - full access');
            }
        }
        
        function hideAdminFeatures() {
            // Hide admin-only buttons
            document.querySelectorAll('.admin-only').forEach(element => {
                element.style.display = 'none';
            });
            // Show manager-specific features
            document.querySelectorAll('.manager-feature').forEach(element => {
                element.style.display = 'inline-flex';
            });
        }
        
        function hideAdminNavigation() {
            // Hide admin-only navigation items
            const adminNavItems = document.querySelectorAll('.admin-nav');
            adminNavItems.forEach(item => {
                item.style.display = 'none';
            });
            
            // Hide user management related elements
            const userManagementElements = document.querySelectorAll('.user-management');
            userManagementElements.forEach(element => {
                element.style.display = 'none';
            });
        }
        
        function showAdminNavigation() {
            // Show admin-only navigation items
            const adminNavItems = document.querySelectorAll('.admin-nav');
            adminNavItems.forEach(item => {
                item.style.display = 'block';
            });
            
            // Show user management related elements
            const userManagementElements = document.querySelectorAll('.user-management');
            userManagementElements.forEach(element => {
                element.style.display = 'block';
            });
        }
        
        function showAdminFeatures() {
            // Show admin-only buttons
            document.querySelectorAll('.admin-only').forEach(element => {
                element.style.display = 'inline-flex';
            });
            // Hide manager-specific features (admins use admin features instead)
            document.querySelectorAll('.manager-feature').forEach(element => {
                element.style.display = 'none';
            });
        }
        
        // Dashboard Data Loading
        function loadDashboardData() {
            const authToken = localStorage.getItem('authToken');
            if (!authToken) return;
            
            // Load dashboard stats
            fetch('/api/dashboard/stats', {
                method: 'GET',
                headers: {
                    'Authorization': `Bearer ${authToken}`
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    console.error('Error loading dashboard:', data.error);
                    return;
                }
                
                // Update stats
                if (data.orders) {
                    document.getElementById('dashboardTotalOrders').textContent = data.orders.total || 0;
                    document.getElementById('dashboardProcessingOrders').textContent = data.orders.processing || 0;
                    // Map completed to "ready to ship"
                    document.getElementById('dashboardReadyOrders').textContent = data.orders.completed || 0;
                }
                
                if (data.inventory) {
                    document.getElementById('dashboardLowStock').textContent = data.inventory.low_stock || 0;
                }
                
                // Load orders for dashboard tables
                loadDashboardOrders();
            })
            .catch(error => {
                console.error('Error loading dashboard data:', error);
            });
        }
        
        function loadDashboardOrders() {
            const authToken = localStorage.getItem('authToken');
            if (!authToken) return;
            
            fetch('/api/orders', {
                method: 'GET',
                headers: {
                    'Authorization': `Bearer ${authToken}`
                }
            })
            .then(response => response.json())
            .then(orders => {
                if (orders.error) {
                    console.error('Error loading orders:', orders.error);
                    return;
                }
                
                // Update admin dashboard table
                updateDashboardOrdersTable('dashboardOrdersTable', orders.slice(0, 5), 'admin');
                
                // Update manager dashboard table
                updateManagerDashboardOrdersTable('managerDashboardOrdersTable', orders.slice(0, 5));
            })
            .catch(error => {
                console.error('Error loading orders:', error);
            });
        }
        
        function updateDashboardOrdersTable(tableId, orders, role) {
            const tbody = document.getElementById(tableId);
            if (!tbody) return;
            
            tbody.innerHTML = orders.map(order => {
                const statusClass = order.status === 'completed' ? 'status-completed' : 
                                   order.status === 'processing' ? 'status-processing' : 
                                   order.status === 'ready-to-dispatch' ? 'status-ready' : 'status-pending';
                const statusText = order.status.replace('-', ' ').replace(/\b\w/g, l => l.toUpperCase());
                
                return `
                    <tr data-order-id="${order.order_id}" data-numeric-id="${order.id}" data-status="${order.status}">
                        <td><strong>${order.order_id}</strong></td>
                        <td>${order.customer_name}</td>
                        <td>${order.product}</td>
                        <td><span class="status-badge ${statusClass}">${statusText}</span></td>
                        <td>${order.deadline || 'N/A'}</td>
                        <td>
                            ${role === 'admin' ? `
                                <button class="btn btn-secondary btn-sm" onclick="editOrder(${order.id})">Edit</button>
                                <button class="btn btn-danger btn-sm" onclick="deleteOrder(${order.id})">Delete</button>
                            ` : `
                                <button class="btn btn-success btn-sm" onclick="updateOrderStatus('${order.order_id}', '${order.status}')">Update Status</button>
                            `}
                        </td>
                    </tr>
                `;
            }).join('');
        }
        
        function updateManagerDashboardOrdersTable(tableId, orders) {
            const tbody = document.getElementById(tableId);
            if (!tbody) return;
            
            tbody.innerHTML = orders.map(order => {
                const statusClass = order.status === 'completed' ? 'status-completed' : 
                                   order.status === 'processing' ? 'status-processing' : 
                                   order.status === 'ready-to-dispatch' ? 'status-ready' : 'status-pending';
                const statusText = order.status.replace('-', ' ').replace(/\b\w/g, l => l.toUpperCase());
                
                return `
                    <tr data-order-id="${order.order_id}" data-numeric-id="${order.id}">
                        <td><strong>${order.order_id}</strong></td>
                        <td>${order.customer_name}</td>
                        <td>${order.product}</td>
                        <td>${order.quantity}</td>
                        <td><span class="status-badge ${statusClass}">${statusText}</span></td>
                        <td>${order.deadline || 'N/A'}</td>
                        <td>
                            ${order.status === 'completed' ? 
                                '<span style="color: #64748b; font-size: 12px;">Completed</span>' :
                                `<button class="btn btn-success btn-sm" onclick="updateStatus('${order.order_id}')">Update Status</button>`
                            }
                        </td>
                    </tr>
                `;
            }).join('');
        }
        
        // Order Management Functions
        function showOrderList() {
            document.getElementById('orderListView').style.display = 'block';
            document.getElementById('orderDetailView').style.display = 'none';
            document.getElementById('orderFormView').style.display = 'none';
        }
        
        function viewOrderDetail(orderId) {
            document.getElementById('orderListView').style.display = 'none';
            document.getElementById('orderDetailView').style.display = 'block';
            document.getElementById('orderFormView').style.display = 'none';
            
            // Update title
            document.getElementById('orderDetailTitle').textContent = `Order Details - ${orderId}`;
            
            // Load order details
            loadOrderDetail(orderId);
        }
        
        function loadOrderDetail(orderId) {
            // Sample order data - in real app, fetch from API
            const orderData = {
                'ORD-001': {
                    id: 'ORD-001',
                    customer: 'ABC Industries',
                    product: 'Steel Pipes',
                    quantity: '500 units',
                    status: 'Under Process',
                    deadline: '2025-10-15',
                    created: '2025-09-20',
                    priority: 'High',
                    price: '$25.00',
                    total: '$12,500.00',
                    instructions: 'High-grade steel required for construction project'
                },
                'ORD-002': {
                    id: 'ORD-002',
                    customer: 'XYZ Corp',
                    product: 'Metal Sheets',
                    quantity: '200 units',
                    status: 'Ready to Dispatch',
                    deadline: '2025-10-10',
                    created: '2025-09-18',
                    priority: 'Medium',
                    price: '$15.50',
                    total: '$3,100.00',
                    instructions: 'Standard thickness sheets for roofing'
                }
            };
            
            const order = orderData[orderId] || orderData['ORD-001'];
            
            // Populate order details
            document.getElementById('orderDetailInfo').innerHTML = `
                <div class="form-group">
                    <label class="form-label">Order ID</label>
                    <div style="padding: 12px; background: #f8fafc; border-radius: 8px; border: 1px solid #e2e8f0;">${order.id}</div>
                </div>
                <div class="form-group">
                    <label class="form-label">Customer</label>
                    <div style="padding: 12px; background: #f8fafc; border-radius: 8px; border: 1px solid #e2e8f0;">${order.customer}</div>
                </div>
                <div class="form-group">
                    <label class="form-label">Product</label>
                    <div style="padding: 12px; background: #f8fafc; border-radius: 8px; border: 1px solid #e2e8f0;">${order.product}</div>
                </div>
                <div class="form-group">
                    <label class="form-label">Quantity</label>
                    <div style="padding: 12px; background: #f8fafc; border-radius: 8px; border: 1px solid #e2e8f0;">${order.quantity}</div>
                </div>
                <div class="form-group">
                    <label class="form-label">Status</label>
                    <div style="padding: 12px; background: #f8fafc; border-radius: 8px; border: 1px solid #e2e8f0;">
                        <span class="status-badge status-${order.status.toLowerCase().replace(' ', '-')}">${order.status}</span>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Deadline</label>
                    <div style="padding: 12px; background: #f8fafc; border-radius: 8px; border: 1px solid #e2e8f0;">${order.deadline}</div>
                </div>
                <div class="form-group">
                    <label class="form-label">Created Date</label>
                    <div style="padding: 12px; background: #f8fafc; border-radius: 8px; border: 1px solid #e2e8f0;">${order.created}</div>
                </div>
                <div class="form-group">
                    <label class="form-label">Priority</label>
                    <div style="padding: 12px; background: #f8fafc; border-radius: 8px; border: 1px solid #e2e8f0;">${order.priority}</div>
                </div>
                <div class="form-group">
                    <label class="form-label">Unit Price</label>
                    <div style="padding: 12px; background: #f8fafc; border-radius: 8px; border: 1px solid #e2e8f0;">${order.price}</div>
                </div>
                <div class="form-group">
                    <label class="form-label">Total Amount</label>
                    <div style="padding: 12px; background: #f8fafc; border-radius: 8px; border: 1px solid #e2e8f0;"><strong>${order.total}</strong></div>
                </div>
                <div class="form-group" style="grid-column: 1 / -1;">
                    <label class="form-label">Special Instructions</label>
                    <div style="padding: 12px; background: #f8fafc; border-radius: 8px; border: 1px solid #e2e8f0;">${order.instructions}</div>
                </div>
            `;
            
            // Set actions based on role
            const isAdmin = currentUser === 'admin';
            document.getElementById('orderDetailActions').innerHTML = isAdmin ? 
                `<button class="btn btn-warning btn-sm" onclick="editOrder('${orderId}')">Edit Order</button>
                 <button class="btn btn-danger btn-sm" onclick="deleteOrder('${orderId}')">Delete Order</button>` :
                `<button class="btn btn-success btn-sm" onclick="updateOrderStatus('${orderId}', '${order.status}')">Update Status</button>`;
            
            // Load status history
            loadStatusHistory(orderId);
        }
        
        function loadStatusHistory(orderId) {
            // Sample status history
            const statusHistory = [
                { status: 'Order Created', date: '2025-09-20 10:30 AM', user: 'Admin', comment: 'Initial order creation' },
                { status: 'Under Process', date: '2025-09-21 02:15 PM', user: 'Manager', comment: 'Started production process' },
                { status: 'Quality Check', date: '2025-09-23 11:45 AM', user: 'Manager', comment: 'Quality inspection in progress' }
            ];
            
            document.getElementById('statusHistory').innerHTML = statusHistory.map(entry => `
                <div style="padding: 12px; border-left: 3px solid #3b82f6; background: #f0f9ff; border-radius: 8px; margin-bottom: 12px;">
                    <div style="font-weight: 600; font-size: 14px; color: #1e40af;">${entry.status}</div>
                    <div style="color: #64748b; font-size: 12px; margin: 4px 0;">${entry.date} by ${entry.user}</div>
                    <div style="color: #374151; font-size: 13px;">${entry.comment}</div>
                </div>
            `).join('');
        }
        
        function showAddOrderForm() {
            document.getElementById('orderListView').style.display = 'none';
            document.getElementById('orderDetailView').style.display = 'none';
            document.getElementById('orderFormView').style.display = 'block';
            
            // Reset form for adding
            document.getElementById('orderFormTitle').textContent = 'Add New Order';
            document.getElementById('orderFormCardTitle').textContent = 'Order Details';
            document.getElementById('orderFormSubmit').textContent = 'Create Order';
            document.getElementById('formOrderId').value = 'ORD-' + String(Date.now()).slice(-3);
            
            // Clear form
            document.getElementById('orderDetailsForm').reset();
        }
        
        function editOrder(orderIdOrOrderIdStr) {
            document.getElementById('orderListView').style.display = 'none';
            document.getElementById('orderDetailView').style.display = 'none';
            document.getElementById('orderFormView').style.display = 'block';
            
            const authToken = localStorage.getItem('authToken');
            if (!authToken) {
                showNotification('Please login to edit orders', 'error');
                return;
            }
            
            // If orderId is numeric, use it directly; otherwise find the numeric ID
            let numericId = orderIdOrOrderIdStr;
            if (isNaN(orderIdOrOrderIdStr)) {
                // It's a string order_id, need to find the numeric ID
                const row = document.querySelector(`tr[data-order-id="${orderIdOrOrderIdStr}"]`);
                if (row && row.dataset.numericId) {
                    numericId = row.dataset.numericId;
                } else {
                    // Try to fetch all orders and find by order_id
                    fetch('/api/orders', {
                        method: 'GET',
                        headers: {
                            'Authorization': `Bearer ${authToken}`
                        }
                    })
                    .then(response => response.json())
                    .then(orders => {
                        const order = orders.find(o => o.order_id === orderIdOrOrderIdStr);
                        if (order) {
                            loadOrderForEdit(order.id);
                        } else {
                            showNotification('Order not found', 'error');
                        }
                    })
                    .catch(error => {
                        console.error('Error finding order:', error);
                        showNotification('Failed to load order. Please try again.', 'error');
                    });
                    return;
                }
            }
            
            loadOrderForEdit(numericId);
        }
        
        function loadOrderForEdit(orderId) {
            const authToken = localStorage.getItem('authToken');
            
            fetch(`/api/orders/${orderId}`, {
                method: 'GET',
                headers: {
                    'Authorization': `Bearer ${authToken}`
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    showNotification(`Error: ${data.error}`, 'error');
                    return;
                }
                
                const order = data;
                
                // Set form for editing
                document.getElementById('orderFormTitle').textContent = `Edit Order - ${order.order_id}`;
                document.getElementById('orderFormCardTitle').textContent = 'Edit Order Details';
                document.getElementById('orderFormSubmit').textContent = 'Update Order';
                document.getElementById('formOrderId').value = order.id; // Store numeric ID
                
                // Populate form with order data
                document.getElementById('formCustomer').value = order.customer_name || '';
                document.getElementById('formProduct').value = order.product || '';
                document.getElementById('formQuantity').value = order.quantity || '';
                document.getElementById('formDeadline').value = order.deadline || '';
                document.getElementById('formPriority').value = order.priority || 'medium';
                document.getElementById('formPrice').value = order.unit_price || '';
                document.getElementById('formTotal').value = order.total_amount || '';
                document.getElementById('formInstructions').value = order.special_instructions || '';
            })
            .catch(error => {
                console.error('Error loading order:', error);
                showNotification('Failed to load order. Please try again.', 'error');
            });
        }
        
        function deleteOrder(orderIdOrOrderIdStr) {
            if (!confirm(`Are you sure you want to delete this order? This action cannot be undone.`)) {
                return;
            }
            
            const authToken = localStorage.getItem('authToken');
            if (!authToken) {
                showNotification('Please login to delete orders', 'error');
                return;
            }
            
            // If orderId is numeric, use it directly; otherwise find the numeric ID
            let numericId = orderIdOrOrderIdStr;
            if (isNaN(orderIdOrOrderIdStr)) {
                const row = document.querySelector(`tr[data-order-id="${orderIdOrOrderIdStr}"]`);
                if (row && row.dataset.numericId) {
                    numericId = row.dataset.numericId;
                } else {
                    showNotification('Order ID not found', 'error');
                    return;
                }
            }
            
            fetch(`/api/orders/${numericId}`, {
                method: 'DELETE',
                headers: {
                    'Authorization': `Bearer ${authToken}`
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    showNotification(`Error: ${data.error}`, 'error');
                    return;
                }
                showNotification(`Order deleted successfully!`, 'success');
                // Reload dashboard
                loadDashboardData();
                // Return to order list if on orders page
                if (document.getElementById('orders').classList.contains('active')) {
                    showOrderList();
                }
            })
            .catch(error => {
                console.error('Error deleting order:', error);
                showNotification('Failed to delete order. Please try again.', 'error');
            });
        }
        
        function updateOrderStatus(orderId, currentStatus) {
            document.getElementById('statusOrderId').textContent = orderId;
            document.getElementById('currentStatus').textContent = currentStatus;
            document.getElementById('statusModal').style.display = 'block';
        }
        
        // Search and Filter Functions
        function clearFilters() {
            document.getElementById('statusFilter').value = '';
            document.getElementById('orderSearch').value = '';
            document.getElementById('dateFilter').value = '';
            document.getElementById('customerFilter').value = '';
            filterOrders();
        }

        // Orders CRUD - API integration
        function getAuthToken() {
            return localStorage.getItem('authToken') || localStorage.getItem('access_token') || '';
        }

        function loadOrdersList() {
            const token = getAuthToken();
            if (!token) {
                // Still render empty state if not logged in
                const tbody = document.querySelector('#ordersTable tbody');
                if (tbody) tbody.innerHTML = '';
                return;
            }

            fetch('/api/orders', {
                headers: { 'Authorization': `Bearer ${token}` }
            })
            .then(r => r.json())
            .then(data => {
                const tbody = document.querySelector('#ordersTable tbody');
                if (!tbody) return;

                if (data.error) {
                    tbody.innerHTML = `<tr><td colspan="8" style="text-align:center;color:#ef4444;padding:16px;">${data.error}</td></tr>`;
                    return;
                }

                console.log('Loaded orders count:', Array.isArray(data) ? data.length : 'n/a');
                tbody.innerHTML = (data || []).map(o => {
                    const deadline = o.deadline || 'N/A';
                    const created = o.created_at ? o.created_at.split('T')[0] : 'N/A';
                    const statusBadge = `<span class="status-badge">${o.status}</span>`;
                    return `
                        <tr data-status="${o.status || ''}" data-customer="${(o.customer_name || '').replace(/"/g,'&quot;')}" data-order-db-id="${o.id}" data-order-id="${o.order_id}">
                            <td><strong>${o.order_id}</strong></td>
                            <td>${o.customer_name || ''}</td>
                            <td>${o.product || ''}</td>
                            <td>${o.quantity ?? ''}</td>
                            <td>$${(o.total_amount || 0).toFixed ? (o.total_amount || 0).toFixed(2) : o.total_amount || 0}</td>
                            <td>${statusBadge}</td>
                            <td>${created}</td>
                            <td>
                                <button class="btn btn-secondary btn-sm" onclick="viewOrderDetail(${o.id})">View</button>
                                <button class="btn btn-danger btn-sm admin-only" onclick="deleteOrder(${o.id}, '${o.order_id}')">Delete</button>
                            </td>
                        </tr>
                    `;
                }).join('');

                // Re-apply filters only if user entered any filter values
                try {
                    const hasAnyFilter =
                        (document.getElementById('statusFilter')?.value || '').trim() !== '' ||
                        (document.getElementById('orderSearch')?.value || '').trim() !== '' ||
                        (document.getElementById('dateFilter')?.value || '').trim() !== '' ||
                        (document.getElementById('customerFilter')?.value || '').trim() !== '';
                    if (hasAnyFilter && typeof filterOrders === 'function') filterOrders();
                } catch (_) {}
            })
            .catch(err => {
                const tbody = document.querySelector('#ordersTable tbody');
                if (tbody) tbody.innerHTML = `<tr><td colspan="8" style="text-align:center;color:#ef4444;padding:16px;">Failed to load orders</td></tr>`;
                console.error('Failed to load orders:', err);
            });
        }

        function viewOrderDetail(dbId) {
            const token = getAuthToken();
            if (!token) { showNotification('Please login to view order', 'error'); return; }
            showNotification('Loading order...', 'info');

            fetch(`/api/orders/${dbId}`, { headers: { 'Authorization': `Bearer ${token}` } })
                .then(r => r.json())
                .then(o => {
                    if (o && o.error) { showNotification(o.error, 'error'); return; }

                    const modal = document.createElement('div');
                    modal.className = 'modal';
                    modal.style.cssText = 'position:fixed;inset:0;background:rgba(0,0,0,.5);z-index:1000;display:flex;align-items:center;justify-content:center;';
                    modal.innerHTML = `
                        <div style="background:#fff;padding:24px;border-radius:12px;max-width:640px;width:92%;max-height:80vh;overflow:auto;">
                            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;">
                                <h3 style="font-size:18px;font-weight:600;">Order Details - ${o.order_id}</h3>
                                <button onclick="this.closest('.modal').remove()" style="background:none;border:none;font-size:22px;color:#64748b;cursor:pointer;">√ó</button>
                            </div>
                            <div class="form-group"><label class="form-label">Customer</label><div class="form-value">${o.customer_name || ''}</div></div>
                            <div class="form-group"><label class="form-label">Product</label><div class="form-value">${o.product || ''}</div></div>
                            <div class="form-group"><label class="form-label">Quantity</label><div class="form-value">${o.quantity ?? ''}</div></div>
                            <div class="form-group"><label class="form-label">Unit Price</label><div class="form-value">$${(o.unit_price || 0).toFixed ? (o.unit_price || 0).toFixed(2) : o.unit_price || 0}</div></div>
                            <div class="form-group"><label class="form-label">Total</label><div class="form-value">$${(o.total_amount || 0).toFixed ? (o.total_amount || 0).toFixed(2) : o.total_amount || 0}</div></div>
                            <div class="form-group"><label class="form-label">Status</label><div class="form-value"><span class="status-badge">${o.status}</span></div></div>
                            <div class="form-group"><label class="form-label">Priority</label><div class="form-value">${o.priority || 'medium'}</div></div>
                            <div class="form-group"><label class="form-label">Deadline</label><div class="form-value">${o.deadline || 'N/A'}</div></div>
                            <div class="form-group"><label class="form-label">Created</label><div class="form-value">${o.created_at ? o.created_at.split('T')[0] : 'N/A'}</div></div>
                            ${Array.isArray(o.status_history) && o.status_history.length ? `
                                <div class="form-group">
                                    <label class="form-label">Status History</label>
                                    <div class="form-value">
                                        <div class="table-container"><table class="table"><thead><tr><th>Date</th><th>From</th><th>To</th><th>Comment</th></tr></thead><tbody>
                                            ${o.status_history.map(h => `
                                                <tr>
                                                    <td>${h.changed_at ? h.changed_at.split('T')[0] : ''}</td>
                                                    <td>${h.old_status || ''}</td>
                                                    <td>${h.new_status || ''}</td>
                                                    <td>${h.comment || ''}</td>
                                                </tr>
                                            `).join('')}
                                        </tbody></table></div>
                                    </div>
                                </div>
                            ` : ''}
                            <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:12px;">
                                <button class="btn btn-secondary" onclick="this.closest('.modal').remove()">Close</button>
                            </div>
                        </div>
                    `;
                    document.body.appendChild(modal);
                })
                .catch(e => { console.error(e); showNotification('Failed to load order', 'error'); });
        }

        function deleteOrder(dbId, orderRef) {
            const token = getAuthToken();
            if (!token) { showNotification('Please login as admin to delete', 'error'); return; }
            if (!confirm(`Delete order ${orderRef}? This cannot be undone.`)) return;

            fetch(`/api/orders/${dbId}`, {
                method: 'DELETE',
                headers: { 'Authorization': `Bearer ${token}` }
            })
            .then(r => r.json())
            .then(res => {
                if (res.error) { showNotification(res.error, 'error'); return; }
                showNotification('Order deleted successfully', 'success');
                loadOrdersList();
            })
            .catch(e => { console.error(e); showNotification('Failed to delete order', 'error'); });
        }
        
        function filterOrders() {
            const statusFilter = document.getElementById('statusFilter').value.toLowerCase();
            const searchTerm = document.getElementById('orderSearch').value.toLowerCase();
            const customerFilter = document.getElementById('customerFilter').value.toLowerCase();
            
            const rows = document.querySelectorAll('#ordersTable tbody tr');
            
            rows.forEach(row => {
                const orderStatus = row.dataset.status;
                const customerData = row.dataset.customer;
                const rowText = row.textContent.toLowerCase();
                
                const matchesStatus = !statusFilter || orderStatus === statusFilter;
                const matchesSearch = !searchTerm || rowText.includes(searchTerm);
                const matchesCustomer = !customerFilter || customerData === customerFilter;
                
                if (matchesStatus && matchesSearch && matchesCustomer) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        }
        
        // Status update functionality for managers
        function updateStatus(orderId) {
            // Find the current status from the manager dashboard table
            let currentStatus = 'Under Process'; // Default status
            
            // Look for the order row in the manager dashboard
            const managerDashboard = document.getElementById('managerDashboard');
            if (managerDashboard) {
                const rows = managerDashboard.querySelectorAll('tbody tr');
                for (let row of rows) {
                    const orderIdCell = row.querySelector('td:first-child strong');
                    if (orderIdCell && orderIdCell.textContent.trim() === orderId) {
                        const statusBadge = row.querySelector('.status-badge');
                        if (statusBadge) {
                            // Extract status from the badge text
                            const statusText = statusBadge.textContent.trim();
                            if (statusText.includes('Under Process')) {
                                currentStatus = 'Under Process';
                            } else if (statusText.includes('Ready to Dispatch')) {
                                currentStatus = 'Ready to Dispatch';
                            } else if (statusText.includes('Yet to Process')) {
                                currentStatus = 'Yet to Process';
                            } else if (statusText.includes('Shipped')) {
                                currentStatus = 'Shipped';
                            }
                        }
                        break;
                    }
                }
            }
            
            document.getElementById('statusOrderId').textContent = orderId;
            document.getElementById('currentStatus').textContent = currentStatus;
            document.getElementById('statusModal').style.display = 'block';
        }
        
        function closeStatusModal() {
            document.getElementById('statusModal').style.display = 'none';
        }
        
        // Handle status form submission
        document.addEventListener('DOMContentLoaded', function() {
            const statusForm = document.getElementById('statusForm');
            if (statusForm) {
                statusForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    const authToken = localStorage.getItem('authToken');
                    if (!authToken) {
                        showNotification('Please login to update order status', 'error');
                        return;
                    }
                    
                    const orderIdStr = document.getElementById('statusOrderId').textContent;
                    const newStatus = document.getElementById('newStatus').value;
                    const comments = document.querySelector('#statusModal textarea').value;
                    
                    if (!newStatus) {
                        showNotification('Please select a new status', 'error');
                        return;
                    }
                    
                    // Find the numeric ID
                    const orderRow = document.querySelector(`tr[data-order-id="${orderIdStr}"]`);
                    let numericId = null;
                    if (orderRow && orderRow.dataset.numericId) {
                        numericId = orderRow.dataset.numericId;
                    } else {
                        // Try to find it
                        fetch('/api/orders', {
                            method: 'GET',
                            headers: {
                                'Authorization': `Bearer ${authToken}`
                            }
                        })
                        .then(response => response.json())
                        .then(orders => {
                            const order = orders.find(o => o.order_id === orderIdStr);
                            if (order) {
                                updateOrderStatusAPI(order.id, newStatus, comments);
                            } else {
                                showNotification('Order not found', 'error');
                            }
                        })
                        .catch(error => {
                            console.error('Error finding order:', error);
                            showNotification('Failed to update status. Please try again.', 'error');
                        });
                        return;
                    }
                    
                    updateOrderStatusAPI(numericId, newStatus, comments);
                });
            }
            
            function updateOrderStatusAPI(orderId, newStatus, comments) {
                const authToken = localStorage.getItem('authToken');
                
                fetch(`/api/orders/${orderId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify({
                        status: newStatus,
                        comment: comments || ''
                    })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.error) {
                        showNotification(`Error: ${data.error}`, 'error');
                        return;
                    }
                    
                    showNotification(`Order ${data.order.order_id} status updated to ${newStatus.replace('-', ' ')}`, 'success');
                    closeStatusModal();
                    
                    // Reset form
                    document.getElementById('statusForm').reset();
                    
                    // Reload dashboard
                    loadDashboardData();
                })
                .catch(error => {
                    console.error('Error updating order status:', error);
                    showNotification('Failed to update status. Please try again.', 'error');
                });
            }
            
            // Add event listeners for inventory filters
            const categoryFilter = document.getElementById('categoryFilter');
            const inventoryStatusFilter = document.getElementById('stockStatusFilter');
            const inventorySearch = document.getElementById('inventorySearch');
            
            if (categoryFilter) {
                categoryFilter.addEventListener('change', filterInventory);
            }
            if (inventoryStatusFilter) {
                inventoryStatusFilter.addEventListener('change', filterInventory);
            }
            if (inventorySearch) {
                inventorySearch.addEventListener('input', filterInventory);
            }
            
            // Add event listeners for orders filters
            const orderStatusFilter = document.getElementById('statusFilter');
            const orderSearch = document.getElementById('orderSearch');
            const dateFilter = document.getElementById('dateFilter');
            const customerFilter = document.getElementById('customerFilter');
            
            if (orderStatusFilter) {
                orderStatusFilter.addEventListener('change', filterOrders);
            }
            if (orderSearch) {
                orderSearch.addEventListener('input', filterOrders);
            }
            if (dateFilter) {
                dateFilter.addEventListener('change', filterOrders);
            }
            if (customerFilter) {
                customerFilter.addEventListener('change', filterOrders);
            }
            
            // Add event listeners for user filters
            const userRoleFilter = document.getElementById('userRoleFilter');
            const userStatusFilter = document.getElementById('userStatusFilter');
            const userSearch = document.getElementById('userSearch');
            
            if (userRoleFilter) {
                userRoleFilter.addEventListener('change', filterUsers);
            }
            if (userStatusFilter) {
                userStatusFilter.addEventListener('change', filterUsers);
            }
            if (userSearch) {
                userSearch.addEventListener('input', filterUsers);
            }
            
            // Add event listeners for raw material filters
            const currentCategoryFilter = document.getElementById('currentCategoryFilter');
            const currentSearchInput = document.getElementById('currentSearchInput');
            
            if (currentCategoryFilter) {
                currentCategoryFilter.addEventListener('change', filterCurrentRawMaterials);
            }
            if (currentSearchInput) {
                currentSearchInput.addEventListener('input', filterCurrentRawMaterials);
            }
            
            // Initialize stats on page load
            updateInventoryStats();
        });
        
        // Navigation functionality
        document.querySelectorAll('.nav-tab[data-page]').forEach(tab => {
            tab.addEventListener('click', function() {
                const page = this.dataset.page;
                showPage(page);
                
                // Update active tab
                document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
                this.classList.add('active');
            });
        });
        
        function showPage(pageId) {
            // Hide all pages
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            
            // Show selected page
            document.getElementById(pageId).classList.add('active');
            
            // Handle role-based dashboard display
            if (pageId === 'dashboard') {
                const adminDashboard = document.getElementById('adminDashboard');
                const managerDashboard = document.getElementById('managerDashboard');
                
                if (currentUser === 'manager') {
                    if (adminDashboard) adminDashboard.style.display = 'none';
                    if (managerDashboard) managerDashboard.style.display = 'block';
                } else {
                    if (adminDashboard) adminDashboard.style.display = 'block';
                    if (managerDashboard) managerDashboard.style.display = 'none';
                }
                
                // Refresh dashboard data when dashboard page is shown
                loadDashboardData();
            }
            
            // Load orders when orders page is shown
            if (pageId === 'orders') {
                if (typeof loadOrdersList === 'function') {
                    loadOrdersList();
                }
            }
            
            // Update navigation
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
                if (tab.dataset.page === pageId) {
                    tab.classList.add('active');
                }
            });
        }
        
        // Logout functionality
        function logout() {
            currentUser = null;
            
            // Clear stored authentication
            localStorage.removeItem('authToken');
            localStorage.removeItem('userInfo');
            
            document.getElementById('mainApp').style.display = 'none';
            document.getElementById('loginPage').style.display = 'block';
            
            // Reset to dashboard
            showPage('dashboard');
            
            showNotification('Logged out successfully!', 'success');
        }
        
        // Notification system
        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 16px 20px;
                background: ${type === 'success' ? '#10b981' : '#ef4444'};
                color: white;
                border-radius: 8px;
                font-weight: 500;
                z-index: 2000;
                box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                transform: translateX(100%);
                transition: transform 0.3s ease;
            `;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            // Animate in
            setTimeout(() => {
                notification.style.transform = 'translateX(0)';
            }, 100);
            
            // Remove after 3 seconds
            setTimeout(() => {
                notification.style.transform = 'translateX(100%)';
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 3000);
        }
        
        // Inventory Form Functionality - Add inventory items via API
        document.getElementById('inventoryDetailsForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = {
                item_name: document.getElementById('formItemName').value,
                category: document.getElementById('formCategory').value,
                current_stock: parseFloat(document.getElementById('formCurrentStock').value) || 0,
                min_level: parseFloat(document.getElementById('formMinLevel').value) || 0,
                max_level: parseFloat(document.getElementById('formMaxLevel').value) || 0,
                unit: document.getElementById('formUnit').value,
                description: document.getElementById('formDescription').value,
                supplier: document.getElementById('formSupplier').value,
                unit_cost: parseFloat(document.getElementById('formUnitCost').value) || null,
                location: document.getElementById('formLocation').value
            };
            
            // Validate required fields
            if (!formData.item_name || !formData.category || !formData.unit) {
                showNotification('Please fill in all required fields!', 'error');
                return;
            }
            
            if (formData.current_stock < 0 || formData.min_level < 0 || formData.max_level < 0) {
                showNotification('Stock levels cannot be negative!', 'error');
                return;
            }
            
            // Get auth token
            const authToken = localStorage.getItem('authToken');
            if (!authToken) {
                showNotification('Please login to add items', 'error');
                return;
            }
            
            // Show loading notification
            showNotification('Creating inventory item...', 'info');
            
            // Call API to create inventory item
            fetch('/api/inventory', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${authToken}`
                },
                body: JSON.stringify(formData)
            })
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    showNotification(`Error: ${data.error}`, 'error');
                    return;
                }
                
                showNotification(`Item ${data.item.item_code} created successfully!`, 'success');
                
                // Reload inventory list if function exists
                if (typeof loadInventoryList === 'function') {
                    loadInventoryList();
                }
                
                // Return to list view
                showInventoryList();
            })
            .catch(error => {
                console.error('Error creating item:', error);
                showNotification('Failed to create item. Please try again.', 'error');
            });
        });
        
        // Order Form Functionality - Fixed to add orders to database/table
        document.getElementById('orderDetailsForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const authToken = localStorage.getItem('authToken');
            if (!authToken) {
                showNotification('Please login to create orders', 'error');
                return;
            }
            
            const formData = {
                customer_name: document.getElementById('formCustomer').value,
                product: document.getElementById('formProduct').value,
                quantity: parseInt(document.getElementById('formQuantity').value) || 0,
                deadline: document.getElementById('formDeadline').value,
                priority: document.getElementById('formPriority').value || 'medium',
                unit_price: parseFloat(document.getElementById('formPrice').value) || 0,
                special_instructions: document.getElementById('formInstructions').value || ''
            };
            
            if (!formData.customer_name || !formData.product || !formData.quantity || !formData.deadline) {
                showNotification('Please fill in all required fields!', 'error');
                return;
            }
            
            // Check if editing or creating
            const isEditing = document.getElementById('orderFormSubmit').textContent === 'Update Order';
            const orderId = document.getElementById('formOrderId').value;
            
            if (isEditing) {
                // Update existing order
                fetch(`/api/orders/${orderId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify(formData)
                })
                .then(response => response.json())
                .then(data => {
                    if (data.error) {
                        showNotification(`Error: ${data.error}`, 'error');
                        return;
                    }
                    showNotification(`Order ${data.order.order_id} updated successfully!`, 'success');
                    showOrderList();
                    // Reload dashboard
                    loadDashboardData();
                })
                .catch(error => {
                    console.error('Error updating order:', error);
                    showNotification('Failed to update order. Please try again.', 'error');
                });
            } else {
                // Create new order
                fetch('/api/orders', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify(formData)
                })
                .then(response => response.json())
                .then(data => {
                    if (data.error) {
                        showNotification(`Error: ${data.error}`, 'error');
                        return;
                    }
                    showNotification(`Order ${data.order.order_id} created successfully!`, 'success');
                    showOrderList();
                    // Reload dashboard
                    loadDashboardData();
                    // Reload orders list
                    if (typeof loadOrdersList === 'function') loadOrdersList();
                })
                .catch(error => {
                    console.error('Error creating order:', error);
                    showNotification('Failed to create order. Please try again.', 'error');
                });
            }
        });
        
        function addOrderToTable(orderData) {
            const tableBody = document.querySelector('#ordersTable tbody');
            const newRow = document.createElement('tr');
            const currentDate = new Date().toISOString().split('T')[0];
            
            // Convert product value to display name
            const productNames = {
                'steel-pipes': 'Steel Pipes',
                'metal-sheets': 'Metal Sheets',
                'aluminum-rods': 'Aluminum Rods',
                'copper-wire': 'Copper Wire',
                'steel-beams': 'Steel Beams',
                'welding-materials': 'Welding Materials'
            };
            
            const productName = productNames[orderData.product] || orderData.product;
            
            newRow.setAttribute('data-order-id', orderData.orderId);
            newRow.setAttribute('data-status', 'yet-to-process');
            newRow.setAttribute('data-customer', orderData.customer.toLowerCase().replace(/\s+/g, '-'));
            
            newRow.innerHTML = `
                <td><strong>${orderData.orderId}</strong></td>
                <td>${orderData.customer}</td>
                <td>${productName}</td>
                <td>${orderData.quantity} units</td>
                <td><span class="status-badge status-pending">Yet to Process</span></td>
                <td>${orderData.deadline}</td>
                <td>${currentDate}</td>
                <td>
                    <button class="btn btn-secondary btn-sm" onclick="viewOrderDetail('${orderData.orderId}')">View</button>
                    <button class="btn btn-warning btn-sm admin-only" onclick="editOrder('${orderData.orderId}')">Edit</button>
                    <button class="btn btn-success btn-sm manager-feature" onclick="updateOrderStatus('${orderData.orderId}', 'Yet to Process')">Update Status</button>
                    <button class="btn btn-danger btn-sm admin-only" onclick="deleteOrder('${orderData.orderId}')">Delete</button>
                </td>
            `;
            
            tableBody.appendChild(newRow);
            
            // Update role permissions for the new row
            if (currentUser === 'manager') {
                newRow.querySelectorAll('.admin-only').forEach(btn => {
                    btn.style.display = 'none';
                });
            }
        }
        
        function updateOrderInTable(orderData) {
            const row = document.querySelector(`tr[data-order-id="${orderData.orderId}"]`);
            if (row) {
                const cells = row.querySelectorAll('td');
                cells[1].textContent = orderData.customer;
                cells[2].textContent = orderData.product;
                cells[3].textContent = orderData.quantity + ' units';
                cells[5].textContent = orderData.deadline;
            }
        }
        
        // Auto-calculate total amount
        document.getElementById('formQuantity').addEventListener('input', calculateTotal);
        document.getElementById('formPrice').addEventListener('input', calculateTotal);
        
        function calculateTotal() {
            const quantity = parseFloat(document.getElementById('formQuantity').value) || 0;
            const price = parseFloat(document.getElementById('formPrice').value) || 0;
            const total = (quantity * price).toFixed(2);
            document.getElementById('formTotal').value = total;
        }
        
        // Reports Functions
        function generateOrderReport() {
            const reportType = document.getElementById('orderReportType').value;
            const fromDate = document.getElementById('orderReportFromDate').value;
            const toDate = document.getElementById('orderReportToDate').value;
            const customerFilter = document.getElementById('orderReportCustomer').value;
            
            // Show loading state
            showNotification('Generating order report...', 'info');
            
            // Get auth token
            const authToken = localStorage.getItem('authToken');
            if (!authToken) {
                showNotification('Please login to generate reports', 'error');
                return;
            }
            
            // Build API query parameters
            const params = new URLSearchParams();
            if (fromDate) params.append('start_date', fromDate);
            if (toDate) params.append('end_date', toDate);
            
            // Map report type to status filter
            const statusMap = {
                'pending-orders': 'yet-to-process',
                'completed-orders': 'completed',
                'all-orders': null
            };
            const status = statusMap[reportType];
            if (status) params.append('status', status);
            
            // Call API to get order report
            fetch(`/api/reports/orders?${params.toString()}`, {
                method: 'GET',
                headers: {
                    'Authorization': `Bearer ${authToken}`
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    showNotification(`Error: ${data.error}`, 'error');
                    return;
                }
                
                // Store report data for PDF generation
                window.currentOrderReport = data;
                
                // Display the report
                displayOrderReportFromAPI(data, { reportType, fromDate, toDate, customerFilter });
                
                // Enable download buttons
                document.getElementById('downloadOrderPDF').disabled = false;
                document.getElementById('downloadOrderExcel').disabled = false;
                
                showNotification(`Order report generated successfully! Found ${data.orders.length} orders.`, 'success');
            })
            .catch(error => {
                console.error('Error generating report:', error);
                showNotification('Failed to generate report. Please try again.', 'error');
            });
        }
        
        function displayOrderReportFromAPI(apiData, filters) {
            document.getElementById('reportResults').style.display = 'block';
            
            const reportType = filters.reportType || 'All Orders';
            const reportTypeLabel = reportType.replace('-', ' ').replace(/\b\w/g, l => l.toUpperCase());
            document.getElementById('reportTitle').textContent = `Order Report - ${reportTypeLabel}`;
            
            const orders = apiData.orders || [];
            const summary = apiData.summary || {};
            
            // Update stats
            document.getElementById('reportStats').innerHTML = `
                <div class="stat-card" style="border-left-color: #3b82f6;">
                    <div class="stat-number">${summary.total_orders || 0}</div>
                    <div class="stat-label">Total Orders</div>
                </div>
                <div class="stat-card" style="border-left-color: #10b981;">
                    <div class="stat-number">$${(summary.total_amount || 0).toLocaleString()}</div>
                    <div class="stat-label">Total Value</div>
                </div>
                <div class="stat-card" style="border-left-color: #f59e0b;">
                    <div class="stat-number">${summary.total_quantity || 0}</div>
                    <div class="stat-label">Total Quantity</div>
                </div>
            `;
            
            // Update table
            document.getElementById('reportTableHead').innerHTML = `
                <tr>
                    <th>Order ID</th>
                    <th>Customer</th>
                    <th>Product</th>
                    <th>Quantity</th>
                    <th>Amount</th>
                    <th>Status</th>
                    <th>Deadline</th>
                    <th>Date</th>
                </tr>
            `;
            
            if (orders.length === 0) {
                document.getElementById('reportTableBody').innerHTML = `
                    <tr>
                        <td colspan="8" style="text-align: center; padding: 40px; color: #64748b;">
                            No orders found for the selected criteria
                        </td>
                    </tr>
                `;
            } else {
                document.getElementById('reportTableBody').innerHTML = orders.map(order => `
                    <tr>
                        <td><strong>${order.order_id}</strong></td>
                        <td>${order.customer_name}</td>
                        <td>${order.product}</td>
                        <td>${order.quantity}</td>
                        <td><strong>$${(order.total_amount || 0).toFixed(2)}</strong></td>
                        <td><span class="status-badge">${order.status}</span></td>
                        <td>${order.deadline || 'N/A'}</td>
                        <td>${order.created_at ? order.created_at.split('T')[0] : 'N/A'}</td>
                    </tr>
                `).join('');
            }
        }
        
        function generateInventoryReport() {
            const reportType = document.getElementById('inventoryReportType').value;
            const category = document.getElementById('inventoryReportCategory').value;
            const fromDate = document.getElementById('inventoryReportFromDate').value;
            const toDate = document.getElementById('inventoryReportToDate').value;
            
            showNotification('Generating inventory report...', 'success');
            
            setTimeout(() => {
                displayInventoryReport(reportType, { category, fromDate, toDate });
                document.getElementById('downloadInventoryPDF').disabled = false;
                document.getElementById('downloadInventoryExcel').disabled = false;
                showNotification('Inventory report generated successfully!', 'success');
            }, 1500);
        }
        
        function displayInventoryReport(reportType, filters) {
            document.getElementById('reportResults').style.display = 'block';
            document.getElementById('reportTitle').textContent = `Inventory Report - ${reportType.replace('-', ' ').toUpperCase()}`;
            
            const inventoryData = [
                { code: 'ITM-001', name: 'Steel Rods', category: 'Raw Materials', stock: 45, min: 50, status: 'Low Stock' },
                { code: 'ITM-002', name: 'Aluminum Sheets', category: 'Raw Materials', stock: 150, min: 100, status: 'In Stock' },
                { code: 'ITM-003', name: 'Welding Wire', category: 'Tools & Equipment', stock: 0, min: 20, status: 'Out of Stock' }
            ];
            
            document.getElementById('reportStats').innerHTML = `
                <div class="stat-card" style="border-left-color: #3b82f6;">
                    <div class="stat-number">${inventoryData.length}</div>
                    <div class="stat-label">Total Items</div>
                </div>
                <div class="stat-card" style="border-left-color: #10b981;">
                    <div class="stat-number">1</div>
                    <div class="stat-label">In Stock</div>
                </div>
                <div class="stat-card" style="border-left-color: #f59e0b;">
                    <div class="stat-number">1</div>
                    <div class="stat-label">Low Stock</div>
                </div>
                <div class="stat-card" style="border-left-color: #ef4444;">
                    <div class="stat-number">1</div>
                    <div class="stat-label">Out of Stock</div>
                </div>
            `;
            
            document.getElementById('reportTableHead').innerHTML = `
                <tr>
                    <th>Item Code</th>
                    <th>Item Name</th>
                    <th>Category</th>
                    <th>Current Stock</th>
                    <th>Min Level</th>
                    <th>Status</th>
                </tr>
            `;
            
            document.getElementById('reportTableBody').innerHTML = inventoryData.map(item => `
                <tr>
                    <td><strong>${item.code}</strong></td>
                    <td>${item.name}</td>
                    <td>${item.category}</td>
                    <td><strong>${item.stock}</strong></td>
                    <td>${item.min}</td>
                    <td><span class="status-badge">${item.status}</span></td>
                </tr>
            `).join('');
        }
        
        function downloadOrderReport(format) {
            if (!window.currentOrderReport) {
                showNotification('Please generate a report first!', 'error');
                return;
            }
            
            showNotification(`Generating ${format.toUpperCase()} report...`, 'info');
            
            if (format === 'pdf') {
                generatePDFReport(window.currentOrderReport);
            } else if (format === 'excel') {
                generateExcelReport(window.currentOrderReport);
            }
        }
        
        function generatePDFReport(reportData) {
            // Create a printable HTML page and trigger print (which can save as PDF)
            const printContent = generateReportHTML(reportData);
            const printWindow = window.open('', '_blank');
            printWindow.document.write(printContent);
            printWindow.document.close();
            
            // Trigger print dialog (which can save as PDF)
            setTimeout(() => {
                printWindow.print();
                showNotification('PDF generation ready. Use browser print dialog to save as PDF.', 'success');
            }, 500);
        }
        
        function generateExcelReport(reportData) {
            // Create CSV format (simpler than Excel, but works)
            const orders = reportData.orders || [];
            const summary = reportData.summary || {};
            
            let csv = 'Order Report\n\n';
            csv += 'Order ID,Customer,Product,Quantity,Amount,Status,Deadline,Date\n';
            
            orders.forEach(order => {
                csv += `"${order.order_id}","${order.customer_name}","${order.product}",${order.quantity},"$${(order.total_amount || 0).toFixed(2)}","${order.status}","${order.deadline || ''}","${order.created_at ? order.created_at.split('T')[0] : ''}"\n`;
            });
            
            csv += `\nSummary\n`;
            csv += `Total Orders,${summary.total_orders || 0}\n`;
            csv += `Total Quantity,${summary.total_quantity || 0}\n`;
            csv += `Total Amount,$${(summary.total_amount || 0).toFixed(2)}\n`;
            
            // Create download link
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            
            link.setAttribute('href', url);
            link.setAttribute('download', `order_report_${new Date().toISOString().split('T')[0]}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showNotification('Excel report downloaded successfully!', 'success');
        }
        
        function generateReportHTML(reportData) {
            const orders = reportData.orders || [];
            const summary = reportData.summary || {};
            
            let html = `
                <!DOCTYPE html>
                <html>
                <head>
                    <title>Order Report</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 20px; }
                        h1 { color: #1e40af; }
                        table { width: 100%; border-collapse: collapse; margin: 20px 0; }
                        th, td { padding: 12px; text-align: left; border-bottom: 1px solid #ddd; }
                        th { background-color: #f8fafc; font-weight: bold; }
                        .summary { margin: 20px 0; padding: 15px; background: #f8fafc; border-radius: 8px; }
                    </style>
                </head>
                <body>
                    <h1>Factory Management System - Order Report</h1>
                    <div class="summary">
                        <strong>Summary:</strong><br>
                        Total Orders: ${summary.total_orders || 0}<br>
                        Total Quantity: ${summary.total_quantity || 0}<br>
                        Total Amount: $${(summary.total_amount || 0).toFixed(2)}<br>
                        Generated: ${new Date().toLocaleString()}
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>Order ID</th>
                                <th>Customer</th>
                                <th>Product</th>
                                <th>Quantity</th>
                                <th>Amount</th>
                                <th>Status</th>
                                <th>Deadline</th>
                                <th>Date</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            orders.forEach(order => {
                html += `
                    <tr>
                        <td>${order.order_id}</td>
                        <td>${order.customer_name}</td>
                        <td>${order.product}</td>
                        <td>${order.quantity}</td>
                        <td>$${(order.total_amount || 0).toFixed(2)}</td>
                        <td>${order.status}</td>
                        <td>${order.deadline || 'N/A'}</td>
                        <td>${order.created_at ? order.created_at.split('T')[0] : 'N/A'}</td>
                    </tr>
                `;
            });
            
            html += `
                        </tbody>
                    </table>
                </body>
                </html>
            `;
            
            return html;
        }
        
        function downloadInventoryReport(format) {
            showNotification(`Downloading inventory report as ${format.toUpperCase()}...`, 'success');
            setTimeout(() => {
                showNotification(`Inventory report downloaded successfully as ${format.toUpperCase()}!`, 'success');
            }, 1000);
        }
        
        function hideReportResults() {
            document.getElementById('reportResults').style.display = 'none';
        }
        
        function printReport() {
            const reportContent = document.getElementById('reportResults').innerHTML;
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <html>
                    <head>
                        <title>Factory Management Report</title>
                        <style>
                            body { font-family: Arial, sans-serif; margin: 20px; }
                            table { width: 100%; border-collapse: collapse; margin: 20px 0; }
                            th, td { padding: 12px; text-align: left; border-bottom: 1px solid #ddd; }
                            th { background-color: #f8fafc; font-weight: bold; }
                            .stat-card { display: inline-block; margin: 10px; padding: 20px; border: 1px solid #ddd; }
                        </style>
                    </head>
                    <body>
                        <h1>Factory Management System Report</h1>
                        ${reportContent}
                    </body>
                </html>
            `);
            printWindow.document.close();
            printWindow.print();
        }
        
        // User Management Functions
        function showUserList() {
            document.getElementById('userListView').style.display = 'block';
            document.getElementById('userDetailView').style.display = 'none';
            document.getElementById('userFormView').style.display = 'none';
        }
        
        function showAddUserForm() {
            if (currentUser !== 'admin') {
                showNotification('Only administrators can add new users!', 'error');
                return;
            }
            
            document.getElementById('userListView').style.display = 'none';
            document.getElementById('userDetailView').style.display = 'none';
            document.getElementById('userFormView').style.display = 'block';
            
            // Reset form for adding
            document.getElementById('userFormTitle').textContent = 'Add New Manager';
            document.getElementById('userFormCardTitle').textContent = 'Manager Account Details';
            document.getElementById('userFormSubmit').textContent = 'Create Manager Account';
            document.getElementById('formUserId').value = 'USR-' + String(Date.now()).slice(-3);
            
            // Clear form
            document.getElementById('userDetailsForm').reset();
            document.getElementById('formUserRole').value = 'manager';
            document.getElementById('formUserStatus').value = 'active';
        }
        
        function viewUserDetail(userId) {
            document.getElementById('userListView').style.display = 'none';
            document.getElementById('userDetailView').style.display = 'block';
            document.getElementById('userFormView').style.display = 'none';
            
            document.getElementById('userDetailTitle').textContent = `User Details - ${userId}`;
            loadUserDetail(userId);
        }
        
        function loadUserDetail(userId) {
            const userData = {
                'USR-001': { id: 'USR-001', name: 'John Admin', username: 'john.admin', email: 'john.admin@company.com', role: 'Admin', status: 'Active', phone: '+1-555-0101', department: 'Administration' },
                'USR-002': { id: 'USR-002', name: 'Sarah Manager', username: 'sarah.mgr', email: 'sarah.manager@company.com', role: 'Manager', status: 'Active', phone: '+1-555-0102', department: 'Production' }
            };
            
            const user = userData[userId] || userData['USR-001'];
            
            document.getElementById('userDetailInfo').innerHTML = `
                <div class="form-group">
                    <label class="form-label">User ID</label>
                    <div style="padding: 12px; background: #f8fafc; border-radius: 8px;">${user.id}</div>
                </div>
                <div class="form-group">
                    <label class="form-label">Full Name</label>
                    <div style="padding: 12px; background: #f8fafc; border-radius: 8px;">${user.name}</div>
                </div>
                <div class="form-group">
                    <label class="form-label">Username</label>
                    <div style="padding: 12px; background: #f8fafc; border-radius: 8px;">${user.username}</div>
                </div>
                <div class="form-group">
                    <label class="form-label">Email</label>
                    <div style="padding: 12px; background: #f8fafc; border-radius: 8px;">${user.email}</div>
                </div>
                <div class="form-group">
                    <label class="form-label">Role</label>
                    <div style="padding: 12px; background: #f8fafc; border-radius: 8px;">
                        <span class="status-badge">${user.role}</span>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Status</label>
                    <div style="padding: 12px; background: #f8fafc; border-radius: 8px;">
                        <span class="status-badge status-ready">${user.status}</span>
                    </div>
                </div>
            `;
            
            document.getElementById('userDetailActions').innerHTML = `
                <button class="btn btn-warning btn-sm" onclick="editUser('${userId}')">Edit User</button>
                <button class="btn btn-danger btn-sm" onclick="deleteUser('${userId}')" ${user.role === 'Admin' ? 'disabled' : ''}>Delete User</button>
            `;
            
            document.getElementById('userActivity').innerHTML = `
                <div style="padding: 12px; background: #f0f9ff; border-left: 3px solid #3b82f6; margin-bottom: 12px;">
                    <div style="font-weight: 600;">Logged in</div>
                    <div style="color: #64748b; font-size: 12px;">Today at 09:00 AM</div>
                </div>
                <div style="padding: 12px; background: #f0f9ff; border-left: 3px solid #10b981; margin-bottom: 12px;">
                    <div style="font-weight: 600;">Updated order ORD-001</div>
                    <div style="color: #64748b; font-size: 12px;">Yesterday at 4:30 PM</div>
                </div>
            `;
            
            document.getElementById('userPermissions').innerHTML = `
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                    <div style="padding: 12px; background: #ecfdf5; border-radius: 8px;">‚úì View Orders</div>
                    <div style="padding: 12px; background: #ecfdf5; border-radius: 8px;">‚úì Update Status</div>
                    <div style="padding: 12px; background: #ecfdf5; border-radius: 8px;">‚úì View Inventory</div>
                    <div style="padding: 12px; background: #fef3c7; border-radius: 8px;">‚ö† Manage Users (Admin Only)</div>
                </div>
            `;
        }
        
        function editUser(userId) {
            if (currentUser !== 'admin') {
                showNotification('Only administrators can edit users!', 'error');
                return;
            }
            
            document.getElementById('userListView').style.display = 'none';
            document.getElementById('userDetailView').style.display = 'none';
            document.getElementById('userFormView').style.display = 'block';
            
            document.getElementById('userFormTitle').textContent = `Edit User - ${userId}`;
            document.getElementById('userFormCardTitle').textContent = 'Edit User Details';
            document.getElementById('userFormSubmit').textContent = 'Update User Account';
            document.getElementById('formUserId').value = userId;
        }
        
        function deleteUser(userId) {
            if (currentUser !== 'admin') {
                showNotification('Only administrators can delete users!', 'error');
                return;
            }
            
            if (confirm(`Are you sure you want to delete user ${userId}? This action cannot be undone.`)) {
                const row = document.querySelector(`tr[data-user-id="${userId}"]`);
                if (row) {
                    row.remove();
                    showNotification(`User ${userId} deleted successfully!`, 'success');
                }
            }
        }
        
        function activateUser(userId) {
            if (currentUser !== 'admin') {
                showNotification('Only administrators can activate users!', 'error');
                return;
            }
            
            const row = document.querySelector(`tr[data-user-id="${userId}"]`);
            if (row) {
                const statusCell = row.querySelector('td:nth-child(6)');
                statusCell.innerHTML = '<span class="status-badge status-ready">‚úì Active</span>';
                
                const actionsCell = row.querySelector('td:last-child');
                actionsCell.innerHTML = actionsCell.innerHTML.replace(
                    'Activate', 
                    'Delete</button>'
                ).replace(
                    'btn-success', 
                    'btn-danger'
                ).replace(
                    'activateUser', 
                    'deleteUser'
                );
                
                showNotification(`User ${userId} activated successfully!`, 'success');
            }
        }
        
        function refreshUserList() {
            showNotification('User list refreshed!', 'success');
        }
        
        function clearUserFilters() {
            document.getElementById('userRoleFilter').value = '';
            document.getElementById('userStatusFilter').value = '';
            document.getElementById('userSearch').value = '';
            // Apply filter logic here
        }
        
        // User Form Submission
        document.getElementById('userDetailsForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            if (currentUser !== 'admin') {
                showNotification('Only administrators can manage users!', 'error');
                return;
            }
            
            const formData = {
                userId: document.getElementById('formUserId').value,
                name: document.getElementById('formUserName').value,
                username: document.getElementById('formUsername').value,
                email: document.getElementById('formUserEmail').value,
                role: document.getElementById('formUserRole').value,
                department: document.getElementById('formUserDepartment').value,
                password: document.getElementById('formUserPassword').value,
                confirmPassword: document.getElementById('formUserPasswordConfirm').value,
                phone: document.getElementById('formUserPhone').value,
                status: document.getElementById('formUserStatus').value
            };
            
            if (!formData.name || !formData.username || !formData.email || !formData.password) {
                showNotification('Please fill in all required fields!', 'error');
                return;
            }
            
            if (formData.password !== formData.confirmPassword) {
                showNotification('Passwords do not match!', 'error');
                return;
            }
            
            const isEditing = document.getElementById('userFormSubmit').textContent.includes('Update');
            
            if (isEditing) {
                showNotification(`User ${formData.userId} updated successfully!`, 'success');
            } else {
                addUserToTable(formData);
                showNotification(`User ${formData.userId} created successfully!`, 'success');
            }
            
            showUserList();
        });
        
        function addUserToTable(userData) {
            const tableBody = document.querySelector('#usersTable tbody');
            const newRow = document.createElement('tr');
            const currentDate = new Date().toISOString().split('T')[0];
            
            newRow.setAttribute('data-user-id', userData.userId);
            newRow.setAttribute('data-role', userData.role);
            newRow.setAttribute('data-status', userData.status);
            
            const roleDisplay = userData.role === 'admin' ? 
                '<span class="status-badge" style="background: #dbeafe; color: #1e40af;">Admin</span>' :
                '<span class="status-badge" style="background: #d1fae5; color: #065f46;">Manager</span>';
                
            const statusDisplay = userData.status === 'active' ?
                '<span class="status-badge status-ready">‚úì Active</span>' :
                '<span class="status-badge" style="background: #fecaca; color: #991b1b;">‚úó Inactive</span>';
            
            newRow.innerHTML = `
                <td><strong>${userData.userId}</strong></td>
                <td>${userData.name}</td>
                <td>${userData.username}</td>
                <td>${userData.email}</td>
                <td>${roleDisplay}</td>
                <td>${statusDisplay}</td>
                <td>Never</td>
                <td>${currentDate}</td>
                <td>
                    <button class="btn btn-secondary btn-sm" onclick="viewUserDetail('${userData.userId}')">View</button>
                    <button class="btn btn-warning btn-sm" onclick="editUser('${userData.userId}')">Edit</button>
                    <button class="btn btn-danger btn-sm" onclick="deleteUser('${userData.userId}')" ${userData.role === 'admin' ? 'disabled' : ''}>Delete</button>
                </td>
            `;
            
            tableBody.appendChild(newRow);
        }
        
        // Profile Management Functions
        function loadProfileData() {
            // Sample profile data based on current user
            const profileData = {
                admin: {
                    name: 'John Administrator',
                    firstName: 'John',
                    lastName: 'Administrator',
                    role: 'Administrator',
                    email: 'john.admin@company.com',
                    phone: '+1-555-0101',
                    department: 'Administration',
                    jobTitle: 'System Administrator',
                    location: 'New York, USA',
                    timezone: 'UTC-5',
                    bio: 'Experienced system administrator with 10+ years in factory management systems.',
                    joinDate: '2020-01-15',
                    lastLogin: 'Today at 09:00 AM',
                    ordersManaged: 150,
                    loginSessions: 456
                },
                manager: {
                    name: 'Sarah Manager',
                    firstName: 'Sarah',
                    lastName: 'Manager',
                    role: 'Production Manager',
                    email: 'sarah.manager@company.com',
                    phone: '+1-555-0102',
                    department: 'Production',
                    jobTitle: 'Production Manager',
                    location: 'Chicago, USA',
                    timezone: 'UTC-6',
                    bio: 'Production manager specializing in manufacturing optimization and quality control.',
                    joinDate: '2021-03-20',
                    lastLogin: 'Today at 08:30 AM',
                    ordersManaged: 89,
                    loginSessions: 234
                }
            };
            
            const profile = profileData[currentUser] || profileData.admin;
            
            // Update profile display
            document.getElementById('profileAvatar').textContent = profile.firstName.charAt(0) + profile.lastName.charAt(0);
            document.getElementById('profileName').textContent = profile.name;
            document.getElementById('profileRole').textContent = profile.role;
            
            // Update basic info
            document.getElementById('profileBasicInfo').innerHTML = `
                <div class="form-group">
                    <label class="form-label">Email</label>
                    <div style="padding: 12px; background: #f8fafc; border-radius: 8px; border: 1px solid #e2e8f0;">${profile.email}</div>
                </div>
                <div class="form-group">
                    <label class="form-label">Phone</label>
                    <div style="padding: 12px; background: #f8fafc; border-radius: 8px; border: 1px solid #e2e8f0;">${profile.phone}</div>
                </div>
                <div class="form-group">
                    <label class="form-label">Department</label>
                    <div style="padding: 12px; background: #f8fafc; border-radius: 8px; border: 1px solid #e2e8f0;">${profile.department}</div>
                </div>
                <div class="form-group">
                    <label class="form-label">Location</label>
                    <div style="padding: 12px; background: #f8fafc; border-radius: 8px; border: 1px solid #e2e8f0;">${profile.location}</div>
                </div>
            `;
            
            // Update account info
            document.getElementById('profileAccountInfo').innerHTML = `
                <div class="form-group">
                    <label class="form-label">User ID</label>
                    <div style="padding: 12px; background: #f8fafc; border-radius: 8px; border: 1px solid #e2e8f0;">USR-${currentUser === 'admin' ? '001' : '002'}</div>
                </div>
                <div class="form-group">
                    <label class="form-label">Role</label>
                    <div style="padding: 12px; background: #f8fafc; border-radius: 8px; border: 1px solid #e2e8f0;">
                        <span class="status-badge ${currentUser === 'admin' ? 'status-processing' : 'status-ready'}">${profile.role}</span>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Member Since</label>
                    <div style="padding: 12px; background: #f8fafc; border-radius: 8px; border: 1px solid #e2e8f0;">${profile.joinDate}</div>
                </div>
                <div class="form-group">
                    <label class="form-label">Last Login</label>
                    <div style="padding: 12px; background: #f8fafc; border-radius: 8px; border: 1px solid #e2e8f0;">${profile.lastLogin}</div>
                </div>
                <div class="form-group">
                    <label class="form-label">Account Status</label>
                    <div style="padding: 12px; background: #f8fafc; border-radius: 8px; border: 1px solid #e2e8f0;">
                        <span class="status-badge status-ready">‚úì Active</span>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Time Zone</label>
                    <div style="padding: 12px; background: #f8fafc; border-radius: 8px; border: 1px solid #e2e8f0;">${profile.timezone}</div>
                </div>
            `;
            
            // Update activity stats
            document.getElementById('profileOrdersCount').textContent = profile.ordersManaged;
            document.getElementById('profileLoginCount').textContent = profile.loginSessions;
            
            // Load recent activity
            loadProfileActivity();
            
            return profile;
        }
        
        function loadProfileActivity() {
            const activityData = [
                { date: '2025-09-29 09:00', action: 'Login', details: 'Successful login to system', status: 'Success', ip: '192.168.1.100' },
                { date: '2025-09-28 16:45', action: 'Order Update', details: 'Updated order ORD-001 status to Ready to Dispatch', status: 'Success', ip: '192.168.1.100' },
                { date: '2025-09-28 14:30', action: 'Report Generated', details: 'Generated monthly inventory report', status: 'Success', ip: '192.168.1.100' },
                { date: '2025-09-27 11:15', action: 'User Management', details: 'Added new manager account USR-006', status: 'Success', ip: '192.168.1.100' },
                { date: '2025-09-27 09:00', action: 'Login', details: 'Successful login to system', status: 'Success', ip: '192.168.1.100' }
            ];
            
            document.getElementById('activityTableBody').innerHTML = activityData.map(activity => `
                <tr>
                    <td>${activity.date}</td>
                    <td><strong>${activity.action}</strong></td>
                    <td>${activity.details}</td>
                    <td><span class="status-badge status-ready">${activity.status}</span></td>
                    <td><code style="font-size: 12px; color: #64748b;">${activity.ip}</code></td>
                </tr>
            `).join('');
        }
        
        function editProfile() {
            const profile = loadProfileData();
            
            // Populate edit form
            document.getElementById('editFirstName').value = profile.firstName;
            document.getElementById('editLastName').value = profile.lastName;
            document.getElementById('editEmail').value = profile.email;
            document.getElementById('editPhone').value = profile.phone;
            document.getElementById('editDepartment').value = profile.department;
            document.getElementById('editJobTitle').value = profile.jobTitle;
            document.getElementById('editBio').value = profile.bio;
            document.getElementById('editLocation').value = profile.location;
            document.getElementById('editTimezone').value = profile.timezone;
            
            document.getElementById('editProfileModal').style.display = 'block';
        }
        
        function closeEditProfileModal() {
            document.getElementById('editProfileModal').style.display = 'none';
        }
        
        function changePassword() {
            document.getElementById('changePasswordModal').style.display = 'block';
        }
        
        function closeChangePasswordModal() {
            document.getElementById('changePasswordModal').style.display = 'none';
            // Clear form
            document.getElementById('changePasswordForm').reset();
            resetPasswordStrength();
        }
        
        function clearActivityLog() {
            if (confirm('Are you sure you want to clear your activity log? This action cannot be undone.')) {
                document.getElementById('activityTableBody').innerHTML = `
                    <tr>
                        <td colspan="5" style="text-align: center; padding: 40px; color: #64748b;">
                            <div>No recent activity to display</div>
                        </td>
                    </tr>
                `;
                showNotification('Activity log cleared successfully!', 'success');
            }
        }
        
        function exportActivityLog() {
            showNotification('Exporting activity log...', 'success');
            setTimeout(() => {
                showNotification('Activity log exported successfully!', 'success');
            }, 1000);
        }
        
        // Form Submissions
        document.getElementById('editProfileForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = {
                firstName: document.getElementById('editFirstName').value,
                lastName: document.getElementById('editLastName').value,
                email: document.getElementById('editEmail').value,
                phone: document.getElementById('editPhone').value,
                jobTitle: document.getElementById('editJobTitle').value,
                bio: document.getElementById('editBio').value,
                location: document.getElementById('editLocation').value,
                timezone: document.getElementById('editTimezone').value
            };
            
            if (!formData.firstName || !formData.lastName || !formData.email) {
                showNotification('Please fill in all required fields!', 'error');
                return;
            }
            
            // Update profile display
            loadProfileData();
            closeEditProfileModal();
            showNotification('Profile updated successfully!', 'success');
        });
        
        document.getElementById('changePasswordForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const currentPassword = document.getElementById('currentPassword').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmNewPassword').value;
            
            if (!currentPassword || !newPassword || !confirmPassword) {
                showNotification('Please fill in all required fields!', 'error');
                return;
            }
            
            if (newPassword !== confirmPassword) {
                showNotification('New passwords do not match!', 'error');
                return;
            }
            
            if (newPassword.length < 8) {
                showNotification('Password must be at least 8 characters long!', 'error');
                return;
            }
            
            // Simulate password change
            closeChangePasswordModal();
            showNotification('Password changed successfully!', 'success');
        });
        
        document.getElementById('preferencesForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const preferences = {
                language: document.getElementById('prefLanguage').value,
                theme: document.getElementById('prefTheme').value,
                layout: document.getElementById('prefLayout').value,
                itemsPerPage: document.getElementById('prefItemsPerPage').value
            };
            
            // Save preferences (in real app, send to server)
            localStorage.setItem('userPreferences', JSON.stringify(preferences));
            showNotification('Preferences saved successfully!', 'success');
        });
        
        document.getElementById('notificationForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const notifications = {
                orderUpdates: document.getElementById('notifyOrderUpdates').checked,
                lowStock: document.getElementById('notifyLowStock').checked,
                newOrders: document.getElementById('notifyNewOrders').checked,
                reports: document.getElementById('notifyReports').checked,
                browserUrgent: document.getElementById('browserNotifyUrgent').checked,
                browserMentions: document.getElementById('browserNotifyMentions').checked,
                frequency: document.getElementById('notificationFrequency').value
            };
            
            // Save notification settings (in real app, send to server)
            localStorage.setItem('notificationSettings', JSON.stringify(notifications));
            showNotification('Notification settings updated successfully!', 'success');
        });
        
        // Password Strength Checker
        document.getElementById('newPassword').addEventListener('input', function() {
            checkPasswordStrength(this.value);
        });
        
        function checkPasswordStrength(password) {
            const strength = {
                score: 0,
                feedback: ''
            };
            
            if (password.length >= 8) strength.score++;
            if (/[a-z]/.test(password)) strength.score++;
            if (/[A-Z]/.test(password)) strength.score++;
            if (/[0-9]/.test(password)) strength.score++;
            if (/[^a-zA-Z0-9]/.test(password)) strength.score++;
            
            // Reset all strength indicators
            for (let i = 1; i <= 4; i++) {
                document.getElementById(`strength${i}`).style.background = '#e5e7eb';
            }
            
            // Set strength indicators based on score
            const colors = ['#ef4444', '#f59e0b', '#10b981', '#059669'];
            const texts = ['Very Weak', 'Weak', 'Good', 'Strong'];
            
            if (strength.score > 0) {
                for (let i = 1; i <= Math.min(strength.score, 4); i++) {
                    document.getElementById(`strength${i}`).style.background = colors[Math.min(strength.score - 1, 3)];
                }
                document.getElementById('strengthText').textContent = texts[Math.min(strength.score - 1, 3)];
                document.getElementById('strengthText').style.color = colors[Math.min(strength.score - 1, 3)];
            } else {
                document.getElementById('strengthText').textContent = 'Enter a password to see strength';
                document.getElementById('strengthText').style.color = '#64748b';
            }
        }
        
        function resetPasswordStrength() {
            for (let i = 1; i <= 4; i++) {
                document.getElementById(`strength${i}`).style.background = '#e5e7eb';
            }
            document.getElementById('strengthText').textContent = 'Enter a password to see strength';
            document.getElementById('strengthText').style.color = '#64748b';
        }
        
        // Raw Material Management Functions
        function switchRawMaterialTab(tabName) {
            // Hide all sections
            document.querySelectorAll('.raw-material-section').forEach(section => {
                section.style.display = 'none';
                section.classList.remove('active');
            });
            
            // Show selected section
            const selectedSection = document.getElementById(tabName + 'RawMaterials');
            if (selectedSection) {
                selectedSection.style.display = 'block';
                selectedSection.classList.add('active');
            }
            
            // Update tab styling
            document.querySelectorAll('.raw-material-tab').forEach(tab => {
                tab.classList.remove('active');
                tab.classList.remove('btn-primary');
                tab.classList.add('btn-secondary');
            });
            
            const activeTab = document.querySelector(`[data-raw-tab="${tabName}"]`);
            if (activeTab) {
                activeTab.classList.add('active');
                activeTab.classList.remove('btn-secondary');
                activeTab.classList.add('btn-primary');
            }
        }
        
        function viewRawMaterialDetail(materialId) {
            const material = rawMaterialsData[materialId];
            if (!material) {
                showNotification('Material not found!', 'error');
                return;
            }
            
            // Create a detailed view modal
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
                background: rgba(0,0,0,0.5); z-index: 1000; display: flex; 
                align-items: center; justify-content: center;
            `;
            
            const totalValue = (material.stock * material.price).toFixed(2);
            const status = material.stock <= 0 ? 'Out of Stock' : 
                          material.stock < material.minLevel ? 'Low Stock' : 'In Stock';
            const statusColor = material.stock <= 0 ? '#ef4444' : 
                               material.stock < material.minLevel ? '#f59e0b' : '#10b981';
            
            modal.innerHTML = `
                <div style="background: white; padding: 24px; border-radius: 12px; width: 500px; max-height: 80vh; overflow-y: auto;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h3 style="margin: 0;">Material Details - ${material.name}</h3>
                        <button onclick="this.closest('.modal').remove()" 
                                style="background: none; border: none; font-size: 24px; cursor: pointer; color: #64748b;">&times;</button>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 20px;">
                        <div>
                            <strong>Material ID:</strong><br>
                            <span style="color: #64748b;">${material.id}</span>
                        </div>
                        <div>
                            <strong>Category:</strong><br>
                            <span style="color: #64748b;">${material.category}</span>
                        </div>
                        <div>
                            <strong>Current Stock:</strong><br>
                            <span style="color: #64748b;">${material.stock} ${material.unit}</span>
                        </div>
                        <div>
                            <strong>Min Level:</strong><br>
                            <span style="color: #64748b;">${material.minLevel} ${material.unit}</span>
                        </div>
                        <div>
                            <strong>Unit Price:</strong><br>
                            <span style="color: #64748b;">$${material.price.toFixed(2)}</span>
                        </div>
                        <div>
                            <strong>Total Value:</strong><br>
                            <span style="color: #64748b;">$${totalValue}</span>
                        </div>
                        <div>
                            <strong>Status:</strong><br>
                            <span style="color: ${statusColor}; font-weight: 500;">${status}</span>
                        </div>
                        <div>
                            <strong>Supplier:</strong><br>
                            <span style="color: #64748b;">${material.supplier || 'Not specified'}</span>
                        </div>
                    </div>
                    
                    ${material.description ? `
                        <div style="margin-bottom: 20px;">
                            <strong>Description:</strong><br>
                            <span style="color: #64748b;">${material.description}</span>
                        </div>
                    ` : ''}
                    
                    <div style="display: flex; gap: 12px; justify-content: flex-end;">
                        <button onclick="this.closest('.modal').remove()" 
                                style="padding: 8px 16px; border: 1px solid #d1d5db; background: white; border-radius: 6px; cursor: pointer;">
                            Close
                        </button>
                        <button onclick="editRawMaterial('${materialId}'); this.closest('.modal').remove();" 
                                style="padding: 8px 16px; background: #3b82f6; color: white; border: none; border-radius: 6px; cursor: pointer;">
                            Edit Material
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }
        
        function editRawMaterialStock(materialId) {
            const material = rawMaterialsData[materialId];
            if (!material) {
                showNotification('Material not found!', 'error');
                return;
            }
            
            // Create a simple stock adjustment modal
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
                background: rgba(0,0,0,0.5); z-index: 1000; display: flex; 
                align-items: center; justify-content: center;
            `;
            
            modal.innerHTML = `
                <div style="background: white; padding: 24px; border-radius: 12px; width: 400px;">
                    <h3 style="margin-bottom: 16px;">Adjust Stock - ${material.name}</h3>
                    <form id="stockAdjustmentForm">
                        <div style="margin-bottom: 16px;">
                            <label style="display: block; margin-bottom: 4px; font-weight: 500;">Current Stock: ${material.stock} ${material.unit}</label>
                            <input type="number" id="newStock" value="${material.stock}" step="0.01" 
                                   style="width: 100%; padding: 8px; border: 1px solid #d1d5db; border-radius: 6px;">
                        </div>
                        <div style="margin-bottom: 16px;">
                            <label style="display: block; margin-bottom: 4px; font-weight: 500;">Reason</label>
                            <select id="adjustmentReason" style="width: 100%; padding: 8px; border: 1px solid #d1d5db; border-radius: 6px;">
                                <option value="delivery">New Delivery</option>
                                <option value="usage">Production Usage</option>
                                <option value="adjustment">Stock Adjustment</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                        <div style="display: flex; gap: 12px; justify-content: flex-end;">
                            <button type="button" onclick="this.closest('.modal').remove()" 
                                    style="padding: 8px 16px; border: 1px solid #d1d5db; background: white; border-radius: 6px; cursor: pointer;">
                                Cancel
                            </button>
                            <button type="submit" 
                                    style="padding: 8px 16px; background: #3b82f6; color: white; border: none; border-radius: 6px; cursor: pointer;">
                                Update Stock
                            </button>
                        </div>
                    </form>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Handle form submission
            document.getElementById('stockAdjustmentForm').addEventListener('submit', function(e) {
                e.preventDefault();
                const newStock = parseFloat(document.getElementById('newStock').value);
                const reason = document.getElementById('adjustmentReason').value;
                
                if (isNaN(newStock) || newStock < 0) {
                    showNotification('Please enter a valid stock amount!', 'error');
                    return;
                }
                
                rawMaterialsData[materialId].stock = newStock;
                updateRawMaterialsDisplay();
                modal.remove();
                showNotification(`Stock updated for ${material.name} to ${newStock} ${material.unit}`, 'success');
            });
        }
        
        function orderRawMaterial(materialId) {
            if (confirm(`Create purchase order for material ${materialId}?`)) {
                showNotification(`Purchase order created for material ${materialId}`, 'success');
                // In a real application, this would create a purchase order
            }
        }
        
        function viewRequiredMaterialDetail(materialId) {
            // Sample required material data
            const requiredMaterials = {
                'RM-005': {
                    id: 'RM-005',
                    name: 'Aluminum Bars',
                    category: 'Metals',
                    requiredQuantity: 100,
                    currentStock: 0,
                    shortage: 100,
                    unit: 'Kg',
                    estimatedCost: 2500.00,
                    requiredBy: '2025-10-05',
                    priority: 'High',
                    status: 'Pending Order',
                    requestedBy: 'Production Department',
                    purpose: 'Manufacturing aluminum components for Project Alpha',
                    supplier: 'MetalWorks Inc (Preferred)',
                    lastPriceQuote: '$25.00 per Kg',
                    notes: 'High-grade aluminum required for aerospace components'
                },
                'RM-006': {
                    id: 'RM-006',
                    name: 'Epoxy Resin',
                    category: 'Chemicals',
                    requiredQuantity: 50,
                    currentStock: 15,
                    shortage: 35,
                    unit: 'Ltr',
                    estimatedCost: 1750.00,
                    requiredBy: '2025-10-12',
                    priority: 'Medium',
                    status: 'Ordered',
                    requestedBy: 'Assembly Department',
                    purpose: 'Bonding materials for electronic assemblies',
                    supplier: 'ChemSupply Co',
                    lastPriceQuote: '$50.00 per Ltr',
                    notes: 'Temperature-resistant epoxy for high-performance applications',
                    orderDate: '2025-09-28',
                    expectedDelivery: '2025-10-08'
                },
                'RM-007': {
                    id: 'RM-007',
                    name: 'Polystyrene Sheets',
                    category: 'Plastics',
                    requiredQuantity: 80,
                    currentStock: 60,
                    shortage: 20,
                    unit: 'Units',
                    estimatedCost: 400.00,
                    requiredBy: '2025-10-20',
                    priority: 'Low',
                    status: 'Pending Order',
                    requestedBy: 'Packaging Department',
                    purpose: 'Protective packaging for fragile components',
                    supplier: 'PlasticPro Inc',
                    lastPriceQuote: '$20.00 per Unit',
                    notes: 'Food-grade polystyrene sheets, 5mm thickness'
                }
            };
            
            const material = requiredMaterials[materialId];
            if (!material) {
                showNotification('Material requirement details not found!', 'error');
                return;
            }
            
            // Create and show modal with detailed information
            const modal = document.createElement('div');
            modal.id = 'requiredMaterialDetailModal';
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%;
                background: rgba(0,0,0,0.5); z-index: 1000; display: flex;
                align-items: center; justify-content: center;
            `;
            
            let priorityColor = '#065f46'; // Low - Green
            if (material.priority === 'Medium') priorityColor = '#92400e'; // Orange
            if (material.priority === 'High') priorityColor = '#991b1b'; // Red
            
            let statusColor = '#f59e0b'; // Pending - Orange
            if (material.status === 'Ordered') statusColor = '#3b82f6'; // Blue
            if (material.status === 'Delivered') statusColor = '#10b981'; // Green
            
            modal.innerHTML = `
                <div style="background: white; padding: 32px; border-radius: 16px; width: 90%; max-width: 700px; max-height: 80vh; overflow-y: auto;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
                        <h3 style="font-size: 24px; font-weight: 600; color: #1e293b;">Required Material Details</h3>
                        <button onclick="closeRequiredMaterialDetailModal()" style="background: none; border: none; font-size: 24px; cursor: pointer; color: #64748b;">&times;</button>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px; margin-bottom: 24px;">
                        <div>
                            <div style="background: #f8fafc; padding: 20px; border-radius: 12px; margin-bottom: 16px;">
                                <h4 style="color: #1e293b; margin-bottom: 16px; font-weight: 600;">Material Information</h4>
                                <div style="margin-bottom: 12px;"><strong>ID:</strong> ${material.id}</div>
                                <div style="margin-bottom: 12px;"><strong>Name:</strong> ${material.name}</div>
                                <div style="margin-bottom: 12px;"><strong>Category:</strong> ${material.category}</div>
                                <div style="margin-bottom: 12px;"><strong>Unit:</strong> ${material.unit}</div>
                                <div style="margin-bottom: 12px;"><strong>Requested By:</strong> ${material.requestedBy}</div>
                            </div>
                            
                            <div style="background: #fef3c7; padding: 20px; border-radius: 12px; border-left: 4px solid #f59e0b;">
                                <h4 style="color: #92400e; margin-bottom: 16px; font-weight: 600;">Quantity Details</h4>
                                <div style="margin-bottom: 12px;"><strong>Required:</strong> ${material.requiredQuantity} ${material.unit}</div>
                                <div style="margin-bottom: 12px;"><strong>Current Stock:</strong> ${material.currentStock} ${material.unit}</div>
                                <div style="margin-bottom: 12px;"><strong>Shortage:</strong> <span style="color: #ef4444; font-weight: bold;">${material.shortage} ${material.unit}</span></div>
                                <div><strong>Estimated Cost:</strong> $${material.estimatedCost.toFixed(2)}</div>
                            </div>
                        </div>
                        
                        <div>
                            <div style="background: #f0f9ff; padding: 20px; border-radius: 12px; margin-bottom: 16px; border-left: 4px solid #3b82f6;">
                                <h4 style="color: #1e40af; margin-bottom: 16px; font-weight: 600;">Timeline & Priority</h4>
                                <div style="margin-bottom: 12px;"><strong>Required By:</strong> ${material.requiredBy}</div>
                                <div style="margin-bottom: 12px;"><strong>Priority:</strong> <span style="color: ${priorityColor}; font-weight: bold;">${material.priority}</span></div>
                                <div style="margin-bottom: 12px;"><strong>Status:</strong> <span style="color: ${statusColor}; font-weight: bold;">${material.status}</span></div>
                                ${material.orderDate ? `<div style="margin-bottom: 12px;"><strong>Order Date:</strong> ${material.orderDate}</div>` : ''}
                                ${material.expectedDelivery ? `<div><strong>Expected Delivery:</strong> ${material.expectedDelivery}</div>` : ''}
                            </div>
                            
                            <div style="background: #ecfdf5; padding: 20px; border-radius: 12px; border-left: 4px solid #10b981;">
                                <h4 style="color: #065f46; margin-bottom: 16px; font-weight: 600;">Supplier Information</h4>
                                <div style="margin-bottom: 12px;"><strong>Supplier:</strong> ${material.supplier}</div>
                                <div><strong>Last Quote:</strong> ${material.lastPriceQuote}</div>
                            </div>
                        </div>
                    </div>
                    
                    <div style="background: #f8fafc; padding: 20px; border-radius: 12px; margin-bottom: 24px;">
                        <h4 style="color: #1e293b; margin-bottom: 12px; font-weight: 600;">Purpose & Description</h4>
                        <div style="margin-bottom: 12px;"><strong>Purpose:</strong> ${material.purpose}</div>
                        <div><strong>Notes:</strong> ${material.notes}</div>
                    </div>
                    
                    <div style="display: flex; gap: 12px; justify-content: flex-end;">
                        <button onclick="closeRequiredMaterialDetailModal()" class="btn btn-secondary">Close</button>
                        <button onclick="requestPurchaseOrder('${material.id}'); closeRequiredMaterialDetailModal();" class="btn btn-warning manager-feature">Request Purchase Order</button>
                        <button onclick="orderRawMaterial('${material.id}'); closeRequiredMaterialDetailModal();" class="btn btn-success admin-only">Order Now</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Apply role-based visibility
            if (currentUser === 'manager') {
                modal.querySelectorAll('.admin-only').forEach(el => el.style.display = 'none');
                modal.querySelectorAll('.manager-feature').forEach(el => el.style.display = 'inline-flex');
            } else {
                modal.querySelectorAll('.manager-feature').forEach(el => el.style.display = 'none');
                modal.querySelectorAll('.admin-only').forEach(el => el.style.display = 'inline-flex');
            }
        }
        
        function closeRequiredMaterialDetailModal() {
            const modal = document.getElementById('requiredMaterialDetailModal');
            if (modal) {
                document.body.removeChild(modal);
            }
        }
        
        function editRequirement(materialId) {
            showNotification(`Editing requirement for material ${materialId}`, 'info');
            // In a real application, this would open requirement editing form
        }
        
        function trackDelivery(orderId) {
            // Sample delivery tracking data
            const deliveryData = {
                'PO-001': {
                    orderId: 'PO-001',
                    materialName: 'Steel Rods',
                    supplier: 'MetalCorp Ltd',
                    quantity: 200,
                    unit: 'Kg',
                    orderDate: '2025-09-20',
                    expectedDate: '2025-10-02',
                    currentStatus: 'Shipped',
                    trackingNumber: 'MC2025092001',
                    carrier: 'FastShip Logistics',
                    estimatedArrival: '2025-10-02 14:00',
                    contactPerson: 'John Smith - MetalCorp Ltd',
                    contactPhone: '+1 (555) 123-4567',
                    contactEmail: 'john.smith@metalcorp.com',
                    specialInstructions: 'Handle with care - Heavy materials. Loading dock access required.',
                    trackingHistory: [
                        { date: '2025-09-20 09:00', status: 'Order Confirmed', location: 'MetalCorp Warehouse', note: 'Order processing initiated' },
                        { date: '2025-09-22 14:30', status: 'Prepared for Shipping', location: 'MetalCorp Warehouse', note: 'Materials prepared and quality checked' },
                        { date: '2025-09-23 08:15', status: 'Picked up by Carrier', location: 'MetalCorp Warehouse', note: 'FastShip Logistics collected the shipment' },
                        { date: '2025-09-25 16:45', status: 'In Transit', location: 'Regional Hub - Chicago', note: 'Package sorted and forwarded' },
                        { date: '2025-09-28 12:20', status: 'Out for Delivery', location: 'Local Facility', note: 'Package loaded for final delivery' }
                    ]
                },
                'PO-002': {
                    orderId: 'PO-002',
                    materialName: 'Chemical Solvent',
                    supplier: 'ChemSupply Co',
                    quantity: 100,
                    unit: 'Ltr',
                    orderDate: '2025-09-25',
                    expectedDate: '2025-10-05',
                    currentStatus: 'In Transit',
                    trackingNumber: 'CS2025092501',
                    carrier: 'ChemSafe Transport',
                    estimatedArrival: '2025-10-05 10:30',
                    contactPerson: 'Sarah Johnson - ChemSupply Co',
                    contactPhone: '+1 (555) 987-6543',
                    contactEmail: 'sarah.j@chemsupply.com',
                    specialInstructions: 'Hazmat certified delivery required. Safety protocols must be followed.',
                    trackingHistory: [
                        { date: '2025-09-25 11:00', status: 'Order Confirmed', location: 'ChemSupply Facility', note: 'Hazmat documentation prepared' },
                        { date: '2025-09-26 15:20', status: 'Safety Check Complete', location: 'ChemSupply Facility', note: 'All safety requirements verified' },
                        { date: '2025-09-27 09:45', status: 'Shipped', location: 'ChemSupply Facility', note: 'Specialized transport vehicle dispatched' },
                        { date: '2025-09-29 13:10', status: 'In Transit', location: 'Distribution Center', note: 'Package in specialized handling facility' }
                    ]
                },
                'PO-003': {
                    orderId: 'PO-003',
                    materialName: 'Fabric Rolls',
                    supplier: 'TextilePro Inc',
                    quantity: 150,
                    unit: 'Meters',
                    orderDate: '2025-09-15',
                    expectedDate: '2025-09-30',
                    currentStatus: 'Delayed',
                    trackingNumber: 'TP2025091501',
                    carrier: 'StandardShip Co',
                    estimatedArrival: '2025-10-03 (Revised)',
                    contactPerson: 'Mike Wilson - TextilePro Inc',
                    contactPhone: '+1 (555) 456-7890',
                    contactEmail: 'mike.w@textilepro.com',
                    specialInstructions: 'Keep dry during transport. Weather protection required.',
                    delayReason: 'Weather delays at origin facility',
                    trackingHistory: [
                        { date: '2025-09-15 10:30', status: 'Order Confirmed', location: 'TextilePro Warehouse', note: 'Order received and processing started' },
                        { date: '2025-09-18 14:15', status: 'Production Complete', location: 'TextilePro Warehouse', note: 'Custom fabric rolls completed' },
                        { date: '2025-09-20 08:00', status: 'Ready for Shipping', location: 'TextilePro Warehouse', note: 'Packaged and ready for pickup' },
                        { date: '2025-09-25 16:30', status: 'Shipping Delayed', location: 'TextilePro Warehouse', note: 'Severe weather affecting transport operations' },
                        { date: '2025-09-28 09:45', status: 'Rescheduled', location: 'TextilePro Warehouse', note: 'New pickup scheduled for Oct 1st' }
                    ]
                }
            };
            
            const delivery = deliveryData[orderId];
            if (!delivery) {
                showNotification('Delivery tracking information not found!', 'error');
                return;
            }
            
            // Create and show modal with tracking information
            const modal = document.createElement('div');
            modal.id = 'trackingModal';
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%;
                background: rgba(0,0,0,0.5); z-index: 1000; display: flex;
                align-items: center; justify-content: center;
            `;
            
            let statusColor = '#3b82f6'; // Default blue
            if (delivery.currentStatus === 'Delivered') statusColor = '#10b981'; // Green
            if (delivery.currentStatus === 'Delayed') statusColor = '#ef4444'; // Red
            if (delivery.currentStatus === 'Shipped') statusColor = '#f59e0b'; // Orange
            
            modal.innerHTML = `
                <div style="background: white; padding: 32px; border-radius: 16px; width: 90%; max-width: 800px; max-height: 80vh; overflow-y: auto;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
                        <h3 style="font-size: 24px; font-weight: 600; color: #1e293b;">Delivery Tracking - ${delivery.orderId}</h3>
                        <button onclick="closeTrackingModal()" style="background: none; border: none; font-size: 24px; cursor: pointer; color: #64748b;">&times;</button>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px; margin-bottom: 24px;">
                        <div>
                            <div style="background: #f0f9ff; padding: 20px; border-radius: 12px; margin-bottom: 16px; border-left: 4px solid #3b82f6;">
                                <h4 style="color: #1e40af; margin-bottom: 16px; font-weight: 600;">Order Information</h4>
                                <div style="margin-bottom: 8px;"><strong>Order ID:</strong> ${delivery.orderId}</div>
                                <div style="margin-bottom: 8px;"><strong>Material:</strong> ${delivery.materialName}</div>
                                <div style="margin-bottom: 8px;"><strong>Quantity:</strong> ${delivery.quantity} ${delivery.unit}</div>
                                <div style="margin-bottom: 8px;"><strong>Supplier:</strong> ${delivery.supplier}</div>
                                <div><strong>Order Date:</strong> ${delivery.orderDate}</div>
                            </div>
                            
                            <div style="background: #ecfdf5; padding: 20px; border-radius: 12px; border-left: 4px solid #10b981;">
                                <h4 style="color: #065f46; margin-bottom: 16px; font-weight: 600;">Contact Information</h4>
                                <div style="margin-bottom: 8px;"><strong>Contact:</strong> ${delivery.contactPerson}</div>
                                <div style="margin-bottom: 8px;"><strong>Phone:</strong> <a href="tel:${delivery.contactPhone}" style="color: #059669;">${delivery.contactPhone}</a></div>
                                <div><strong>Email:</strong> <a href="mailto:${delivery.contactEmail}" style="color: #059669;">${delivery.contactEmail}</a></div>
                            </div>
                        </div>
                        
                        <div>
                            <div style="background: #fef3c7; padding: 20px; border-radius: 12px; margin-bottom: 16px; border-left: 4px solid #f59e0b;">
                                <h4 style="color: #92400e; margin-bottom: 16px; font-weight: 600;">Delivery Status</h4>
                                <div style="margin-bottom: 8px;"><strong>Current Status:</strong> <span style="color: ${statusColor}; font-weight: bold;">${delivery.currentStatus}</span></div>
                                <div style="margin-bottom: 8px;"><strong>Tracking #:</strong> ${delivery.trackingNumber}</div>
                                <div style="margin-bottom: 8px;"><strong>Carrier:</strong> ${delivery.carrier}</div>
                                <div style="margin-bottom: 8px;"><strong>Expected:</strong> ${delivery.expectedDate}</div>
                                <div><strong>ETA:</strong> ${delivery.estimatedArrival}</div>
                                ${delivery.delayReason ? `<div style="margin-top: 12px; color: #ef4444;"><strong>Delay Reason:</strong> ${delivery.delayReason}</div>` : ''}
                            </div>
                        </div>
                    </div>
                    
                    <div style="background: #f8fafc; padding: 20px; border-radius: 12px; margin-bottom: 24px;">
                        <h4 style="color: #1e293b; margin-bottom: 12px; font-weight: 600;">Special Instructions</h4>
                        <div>${delivery.specialInstructions}</div>
                    </div>
                    
                    <div style="background: #f0f9ff; padding: 20px; border-radius: 12px; margin-bottom: 24px; border-left: 4px solid #3b82f6;">
                        <h4 style="color: #1e40af; margin-bottom: 16px; font-weight: 600;">Tracking History</h4>
                        <div style="position: relative;">
                            ${delivery.trackingHistory.map((event, index) => `
                                <div style="display: flex; margin-bottom: ${index === delivery.trackingHistory.length - 1 ? '0' : '16px'}; position: relative;">
                                    <div style="width: 12px; height: 12px; background: #3b82f6; border-radius: 50%; margin-right: 16px; margin-top: 4px; flex-shrink: 0; z-index: 1;"></div>
                                    ${index < delivery.trackingHistory.length - 1 ? '<div style="position: absolute; left: 5px; top: 16px; width: 2px; height: 40px; background: #cbd5e1;"></div>' : ''}
                                    <div style="flex: 1;">
                                        <div style="font-weight: 600; color: #1e293b; margin-bottom: 4px;">${event.status}</div>
                                        <div style="color: #64748b; font-size: 14px; margin-bottom: 4px;">${event.date} ‚Ä¢ ${event.location}</div>
                                        <div style="color: #374151; font-size: 14px;">${event.note}</div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 12px; justify-content: flex-end;">
                        <button onclick="closeTrackingModal()" class="btn btn-secondary">Close</button>
                        <button onclick="requestDeliveryUpdate('${delivery.orderId}'); closeTrackingModal();" class="btn btn-info manager-feature">Request Update</button>
                        <button onclick="receiveDelivery('${delivery.orderId}'); closeTrackingModal();" class="btn btn-success manager-feature">Mark as Received</button>
                        <button onclick="contactSupplier('${delivery.orderId}'); closeTrackingModal();" class="btn btn-warning">Contact Supplier</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Apply role-based visibility
            if (currentUser === 'manager') {
                modal.querySelectorAll('.manager-feature').forEach(el => el.style.display = 'inline-flex');
            } else {
                modal.querySelectorAll('.manager-feature').forEach(el => el.style.display = 'inline-flex');
            }
        }
        
        function closeTrackingModal() {
            const modal = document.getElementById('trackingModal');
            if (modal) {
                document.body.removeChild(modal);
            }
        }
        
        function receiveDelivery(orderId) {
            if (confirm(`Mark delivery as received for order ${orderId}?`)) {
                showNotification(`Delivery received for order ${orderId}`, 'success');
                // Update the row status or remove from upcoming
                const row = document.querySelector(`tr[data-order-id="${orderId}"]`);
                if (row) {
                    row.style.opacity = '0.5';
                    setTimeout(() => row.remove(), 1000);
                }
            }
        }
        
        function editUpcomingOrder(orderId) {
            showNotification(`Editing order ${orderId}`, 'info');
            // In a real application, this would open order editing form
        }
        
        function contactSupplier(orderId) {
            // Create a supplier contact modal
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
                background: rgba(0,0,0,0.5); z-index: 1000; display: flex; 
                align-items: center; justify-content: center;
            `;
            
            modal.innerHTML = `
                <div style="background: white; padding: 32px; border-radius: 16px; width: 90%; max-width: 500px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
                        <h3 style="font-size: 20px; font-weight: 600;">Contact Supplier</h3>
                        <button onclick="this.closest('.modal').remove()" style="background: none; border: none; font-size: 24px; cursor: pointer; color: #64748b;">√ó</button>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <strong>Order ID:</strong> ${orderId}
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; margin-bottom: 8px; font-weight: 600;">Contact Method:</label>
                        <select id="contactMethod" style="width: 100%; padding: 12px; border: 1px solid #d1d5db; border-radius: 8px;">
                            <option value="email">Email</option>
                            <option value="phone">Phone Call</option>
                            <option value="message">Message</option>
                        </select>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; margin-bottom: 8px; font-weight: 600;">Subject:</label>
                        <input type="text" id="contactSubject" placeholder="Enter subject..." style="width: 100%; padding: 12px; border: 1px solid #d1d5db; border-radius: 8px;">
                    </div>
                    
                    <div style="margin-bottom: 24px;">
                        <label style="display: block; margin-bottom: 8px; font-weight: 600;">Message:</label>
                        <textarea id="contactMessage" rows="4" placeholder="Enter your message..." style="width: 100%; padding: 12px; border: 1px solid #d1d5db; border-radius: 8px; resize: vertical;"></textarea>
                    </div>
                    
                    <div style="display: flex; gap: 12px; justify-content: flex-end;">
                        <button onclick="this.closest('.modal').remove()" class="btn btn-secondary">Cancel</button>
                        <button onclick="sendSupplierContact('${orderId}'); this.closest('.modal').remove();" class="btn btn-primary">Send Contact</button>
                    </div>
                </div>
            `;
            
            modal.className = 'modal';
            document.body.appendChild(modal);
        }
        
        function sendSupplierContact(orderId) {
            const method = document.getElementById('contactMethod').value;
            const subject = document.getElementById('contactSubject').value;
            const message = document.getElementById('contactMessage').value;
            
            if (!subject || !message) {
                showNotification('Please fill in all required fields', 'error');
                return;
            }
            
            showNotification(`Contact sent to supplier for order ${orderId} via ${method}`, 'success');
            // In a real application, this would send the actual contact request
        }
        
        function viewOrderDetails(orderId) {
            showNotification(`Viewing order details for ${orderId}`, 'info');
            // In a real application, this would show detailed order information
        }
        
        // Raw Material Data Store (In real app, this would be from database)
        let rawMaterialsData = {
            'RM-001': {
                id: 'RM-001',
                name: 'Steel Sheets',
                category: 'metals',
                stock: 150,
                unit: 'Kg',
                price: 12.50,
                minLevel: 50,
                supplier: 'SteelCorp Industries',
                description: 'High-grade steel sheets for construction'
            },
            'RM-002': {
                id: 'RM-002',
                name: 'Industrial Adhesive',
                category: 'chemicals',
                stock: 25,
                unit: 'Ltr',
                price: 35.00,
                minLevel: 30,
                supplier: 'ChemPlus Ltd',
                description: 'Strong industrial adhesive for bonding'
            },
            'RM-003': {
                id: 'RM-003',
                name: 'PVC Pipes',
                category: 'plastics',
                stock: 0,
                unit: 'Units',
                price: 8.75,
                minLevel: 20,
                supplier: 'PlasticPro Inc',
                description: 'Standard PVC pipes for plumbing'
            },
            'RM-004': {
                id: 'RM-004',
                name: 'Cotton Fabric',
                category: 'textiles',
                stock: 200,
                unit: 'Meters',
                price: 15.25,
                minLevel: 75,
                supplier: 'FabricMaster Co',
                description: 'Premium cotton fabric for manufacturing'
            }
        };
        
        function generateMaterialId() {
            const existingIds = Object.keys(rawMaterialsData);
            let maxNum = 0;
            existingIds.forEach(id => {
                const num = parseInt(id.split('-')[1]);
                if (num > maxNum) maxNum = num;
            });
            return `RM-${String(maxNum + 1).padStart(3, '0')}`;
        }
        
        function showAddRawMaterialForm() {
            const newId = generateMaterialId();
            document.getElementById('addRawMaterialId').value = newId;
            document.getElementById('rawMaterialAddForm').reset();
            document.getElementById('addRawMaterialId').value = newId;
            document.getElementById('rawMaterialAddModal').style.display = 'block';
        }
        
        // Section-specific add functions
        function showAddCurrentMaterialForm() {
            showAddRawMaterialForm(); // Use the existing current stock form
        }
        
        function showAddRequiredMaterialForm() {
            const newId = generateRequirementId();
            document.getElementById('addReqMaterialId').value = newId;
            document.getElementById('addRequiredMaterialForm').reset();
            document.getElementById('addReqMaterialId').value = newId;
            document.getElementById('addRequiredMaterialModal').style.display = 'block';
        }
        
        function showAddUpcomingOrderForm() {
            const newId = generateOrderId();
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('addUpcomingOrderId').value = newId;
            document.getElementById('addUpcomingOrderDate').value = today;
            document.getElementById('addUpcomingOrderForm').reset();
            document.getElementById('addUpcomingOrderId').value = newId;
            document.getElementById('addUpcomingOrderDate').value = today;
            document.getElementById('addUpcomingOrderModal').style.display = 'block';
        }
        
        function closeAddRequiredMaterialModal() {
            document.getElementById('addRequiredMaterialModal').style.display = 'none';
        }
        
        function closeAddUpcomingOrderModal() {
            document.getElementById('addUpcomingOrderModal').style.display = 'none';
        }
        
        function generateRequirementId() {
            // In a real app, this would generate a unique requirement ID
            return 'REQ-' + String(Date.now()).slice(-6);
        }
        
        function generateOrderId() {
            // In a real app, this would generate a unique purchase order ID
            return 'PO-' + String(Date.now()).slice(-6);
        }
        
        function closeRawMaterialAddModal() {
            document.getElementById('rawMaterialAddModal').style.display = 'none';
        }
        
        function refreshRawMaterials() {
            updateRawMaterialsDisplay();
            showNotification('Raw materials data refreshed!', 'success');
        }
        
        // Manager-specific functions for raw materials
        function requestStockUpdate(materialId) {
            if (confirm(`Send stock update request for material ${materialId} to admin?`)) {
                showNotification(`Stock update request sent for ${materialId}. Admin will be notified.`, 'success');
                // In real app, this would create a notification/request for admin
            }
        }
        
        // Enhanced inventory management functions for managers
        function requestInventoryStockUpdate(itemId) {
            if (confirm(`Send stock update request for inventory item ${itemId} to admin?`)) {
                showNotification(`Stock update request sent for ${itemId}. Admin will be notified for restocking.`, 'success');
                // In real app, this would create a notification/request for admin
            }
        }
        
        function reportInventoryEmptyStock(itemId) {
            if (confirm(`Report ${itemId} as out of stock to admin?`)) {
                showNotification(`Empty stock reported for ${itemId}. Admin will be notified for urgent restocking.`, 'success');
                // In real app, this would create an urgent notification for admin
            }
        }
        
        // Inventory filter functions
        function filterInventory() {
            const categoryFilter = document.getElementById('categoryFilter').value;
            const statusFilter = document.getElementById('stockStatusFilter').value;
            const searchTerm = document.getElementById('inventorySearch').value.toLowerCase();
            
            const rows = document.querySelectorAll('#inventoryTable tbody tr');
            let visibleCount = 0;
            
            rows.forEach(row => {
                const category = row.getAttribute('data-category') || '';
                const statusBadge = row.querySelector('.status-badge');
                const status = statusBadge ? statusBadge.textContent.toLowerCase() : '';
                const itemCode = row.querySelector('td:first-child strong').textContent.toLowerCase();
                const itemName = row.querySelector('td:nth-child(2)').textContent.toLowerCase();
                const searchableText = `${itemCode} ${itemName}`.toLowerCase();
                
                let matchesCategory = !categoryFilter || category === categoryFilter;
                let matchesStatus = !statusFilter || 
                    (statusFilter === 'in-stock' && status.includes('in stock')) ||
                    (statusFilter === 'low-stock' && status.includes('low stock')) ||
                    (statusFilter === 'out-of-stock' && status.includes('out of stock'));
                let matchesSearch = !searchTerm || searchableText.includes(searchTerm);
                
                if (matchesCategory && matchesStatus && matchesSearch) {
                    row.style.display = '';
                    visibleCount++;
                } else {
                    row.style.display = 'none';
                }
            });
            
            // Update stats
            updateInventoryStats();
        }
        
        function clearInventoryFilters() {
            document.getElementById('categoryFilter').value = '';
            document.getElementById('stockStatusFilter').value = '';
            document.getElementById('inventorySearch').value = '';
            filterInventory();
        }
        
        function filterByLowStock() {
            document.getElementById('stockStatusFilter').value = 'low-stock';
            filterInventory();
        }
        
        function updateInventoryStats() {
            const rows = document.querySelectorAll('#inventoryTable tbody tr');
            let totalItems = 0;
            let inStock = 0;
            let lowStock = 0;
            let outOfStock = 0;
            
            rows.forEach(row => {
                if (row.style.display !== 'none') {
                    totalItems++;
                    const statusBadge = row.querySelector('.status-badge');
                    if (statusBadge) {
                        const status = statusBadge.textContent.toLowerCase();
                        if (status.includes('in stock')) {
                            inStock++;
                        } else if (status.includes('low stock')) {
                            lowStock++;
                        } else if (status.includes('out of stock')) {
                            outOfStock++;
                        }
                    }
                }
            });
            
            document.getElementById('totalItemsCount').textContent = totalItems;
            document.getElementById('inStockCount').textContent = inStock;
            document.getElementById('lowStockCountStat').textContent = lowStock;
            document.getElementById('outOfStockCount').textContent = outOfStock;
        }
        
        // Orders filter functions
        function filterOrders() {
            const statusFilter = document.getElementById('statusFilter').value;
            const searchTerm = document.getElementById('orderSearch').value.toLowerCase();
            const dateFilter = document.getElementById('dateFilter').value;
            const customerFilter = document.getElementById('customerFilter').value;
            
            const rows = document.querySelectorAll('#ordersTable tbody tr');
            
            rows.forEach(row => {
                const status = row.getAttribute('data-status') || '';
                const customer = row.getAttribute('data-customer') || '';
                const orderId = row.querySelector('td:first-child strong').textContent.toLowerCase();
                const customerName = row.querySelector('td:nth-child(2)').textContent.toLowerCase();
                const product = row.querySelector('td:nth-child(3)').textContent.toLowerCase();
                const searchableText = `${orderId} ${customerName} ${product}`.toLowerCase();
                const createdDate = row.querySelector('td:nth-child(7)').textContent;
                
                let matchesStatus = !statusFilter || status === statusFilter;
                let matchesSearch = !searchTerm || searchableText.includes(searchTerm);
                let matchesDate = !dateFilter || createdDate === dateFilter;
                let matchesCustomer = !customerFilter || customer === customerFilter;
                
                if (matchesStatus && matchesSearch && matchesDate && matchesCustomer) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        }
        
        function clearFilters() {
            document.getElementById('statusFilter').value = '';
            document.getElementById('orderSearch').value = '';
            document.getElementById('dateFilter').value = '';
            document.getElementById('customerFilter').value = '';
            filterOrders();
        }
        
        // User filter functions
        function filterUsers() {
            const roleFilter = document.getElementById('userRoleFilter').value;
            const statusFilter = document.getElementById('userStatusFilter').value;
            const searchTerm = document.getElementById('userSearch').value.toLowerCase();
            
            const rows = document.querySelectorAll('#usersTable tbody tr');
            
            rows.forEach(row => {
                const role = row.getAttribute('data-role') || '';
                const status = row.getAttribute('data-status') || '';
                const userId = row.querySelector('td:first-child strong').textContent.toLowerCase();
                const name = row.querySelector('td:nth-child(2)').textContent.toLowerCase();
                const username = row.querySelector('td:nth-child(3)').textContent.toLowerCase();
                const email = row.querySelector('td:nth-child(4)').textContent.toLowerCase();
                const searchableText = `${userId} ${name} ${username} ${email}`.toLowerCase();
                
                let matchesRole = !roleFilter || role === roleFilter;
                let matchesStatus = !statusFilter || status === statusFilter;
                let matchesSearch = !searchTerm || searchableText.includes(searchTerm);
                
                if (matchesRole && matchesStatus && matchesSearch) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        }
        
        function clearUserFilters() {
            document.getElementById('userRoleFilter').value = '';
            document.getElementById('userStatusFilter').value = '';
            document.getElementById('userSearch').value = '';
            filterUsers();
        }
        
        // Raw materials filter functions
        function filterCurrentRawMaterials() {
            const categoryFilter = document.getElementById('currentCategoryFilter').value;
            const searchTerm = document.getElementById('currentSearchInput').value.toLowerCase();
            
            const rows = document.querySelectorAll('#currentRawMaterialsTable tbody tr');
            
            rows.forEach(row => {
                const category = row.getAttribute('data-category') || '';
                const materialId = row.querySelector('td:first-child strong').textContent.toLowerCase();
                const name = row.querySelector('td:nth-child(2)').textContent.toLowerCase();
                const supplier = row.querySelector('td:nth-child(3)').textContent.toLowerCase();
                const searchableText = `${materialId} ${name} ${supplier}`.toLowerCase();
                
                let matchesCategory = !categoryFilter || category === categoryFilter;
                let matchesSearch = !searchTerm || searchableText.includes(searchTerm);
                
                if (matchesCategory && matchesSearch) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        }
        
        function clearCurrentRawMaterialFilters() {
            document.getElementById('currentCategoryFilter').value = '';
            document.getElementById('currentSearchInput').value = '';
            filterCurrentRawMaterials();
        }
        
        // Edit inventory stock function
        function editInventoryStock(itemId) {
            // Create edit stock modal
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
                background: rgba(0,0,0,0.5); z-index: 1000; display: flex; 
                align-items: center; justify-content: center;
            `;
            
            // Get current stock data
            const row = document.querySelector(`tr[data-item-id="${itemId}"]`);
            const currentStock = row ? row.getAttribute('data-stock') || '0' : '0';
            const itemName = row ? row.querySelector('td:nth-child(2)').textContent : 'Unknown Item';
            // Get database ID if stored, otherwise use itemId (might be item code)
            const dbItemId = row ? row.getAttribute('data-db-id') || itemId : itemId;
            
            modal.innerHTML = `
                <div style="background: white; padding: 32px; border-radius: 16px; width: 90%; max-width: 500px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
                        <h3 style="font-size: 20px; font-weight: 600;">Edit Stock - ${itemId}</h3>
                        <button onclick="this.closest('.modal').remove()" style="background: none; border: none; font-size: 24px; cursor: pointer; color: #64748b;">√ó</button>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <strong>Item:</strong> ${itemName}
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; margin-bottom: 8px; font-weight: 600;">Current Stock:</label>
                        <input type="number" id="currentStockValue" value="${currentStock}" style="width: 100%; padding: 12px; border: 1px solid #d1d5db; border-radius: 8px;" readonly>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; margin-bottom: 8px; font-weight: 600;">Adjustment Type:</label>
                        <select id="adjustmentType" style="width: 100%; padding: 12px; border: 1px solid #d1d5db; border-radius: 8px;">
                            <option value="add">Add Stock</option>
                            <option value="remove">Remove Stock</option>
                            <option value="set">Set Stock</option>
                        </select>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; margin-bottom: 8px; font-weight: 600;">Quantity:</label>
                        <input type="number" id="adjustmentQuantity" placeholder="Enter quantity..." style="width: 100%; padding: 12px; border: 1px solid #d1d5db; border-radius: 8px;" min="0">
                    </div>
                    
                    <div style="margin-bottom: 24px;">
                        <label style="display: block; margin-bottom: 8px; font-weight: 600;">Reason:</label>
                        <textarea id="adjustmentReason" rows="3" placeholder="Enter reason for stock adjustment..." style="width: 100%; padding: 12px; border: 1px solid #d1d5db; border-radius: 8px; resize: vertical;"></textarea>
                    </div>
                    
                    <div style="display: flex; gap: 12px; justify-content: flex-end;">
                        <button onclick="this.closest('.modal').remove()" class="btn btn-secondary">Cancel</button>
                        <button onclick="saveStockAdjustment('${itemId}'); this.closest('.modal').remove();" class="btn btn-primary">Save Adjustment</button>
                    </div>
                </div>
            `;
            
            modal.className = 'modal';
            document.body.appendChild(modal);
        }
        
        function saveStockAdjustment(itemId) {
            const adjustmentType = document.getElementById('adjustmentType').value;
            const quantity = parseFloat(document.getElementById('adjustmentQuantity').value) || 0;
            const reason = document.getElementById('adjustmentReason').value;
            
            if (quantity <= 0) {
                showNotification('Please enter a valid quantity', 'error');
                return;
            }
            
            if (!reason.trim()) {
                showNotification('Please enter a reason for the adjustment', 'error');
                return;
            }
            
            // Map 'set' to 'adjust' for API compatibility
            const movementType = adjustmentType === 'set' ? 'adjust' : adjustmentType;
            
            // Get auth token
            const authToken = getAuthToken();
            if (!authToken) {
                showNotification('Please login to update stock', 'error');
                return;
            }
            
            // Show loading notification
            showNotification('Updating stock...', 'info');
            
            // Helper to perform the adjust call with a database id
            function doAdjust(dbId) {
                return fetch(`/api/inventory/${dbId}/adjust`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify({
                        movement_type: movementType,
                        quantity: quantity,
                        reason: reason
                    })
                });
            }

            // Resolve DB item id from row (fallback to provided id)
            const row = document.querySelector(`tr[data-item-id="${itemId}"]`);
            const initialDbId = row ? (row.getAttribute('data-db-id') || row.getAttribute('data-id') || itemId) : itemId;

            // Try with initial id; on 404, look up by item_code (normalize) via /api/inventory and retry
            doAdjust(initialDbId)
                .then(async resp => {
                    const data = await resp.json().catch(() => ({}));
                    if (!resp.ok) {
                        if (resp.status === 401) {
                            throw new Error('Please login to update stock');
                        }
                        if (resp.status === 403) {
                            throw new Error('Admin access required to adjust stock');
                        }
                        if (resp.status === 404 || (data.error || '').toLowerCase().includes('not found')) {
                            // Fallback: find by normalized item_code or by row item name
                            const normalizeCode = (code) => {
                                if (!code) return code;
                                const m = /^ITM-(\d+)$/.exec(code.trim());
                                if (m) {
                                    return `ITM-${m[1].padStart(4, '0')}`;
                                }
                                return code.trim();
                            };
                            const targetCode = normalizeCode(itemId);
                            const rowEl = document.querySelector(`tr[data-item-id="${itemId}"]`);
                            const targetName = rowEl ? rowEl.querySelector('td:nth-child(2)')?.textContent?.trim() : '';
                            return fetch('/api/inventory', { headers: { 'Authorization': `Bearer ${authToken}` } })
                                .then(r => r.json())
                                .then(list => {
                                    const items = Array.isArray(list) ? list : [];
                                    let match = items.find(it => normalizeCode(it.item_code) === targetCode);
                                    if (!match && targetName) {
                                        match = items.find(it => (it.item_name || '').trim() === targetName);
                                    }
                                    if (!match) {
                                        // Auto-create inventory item from row data, then adjust
                                        const catText = rowEl ? (rowEl.querySelector('td:nth-child(3)')?.textContent || '').trim() : '';
                                        const unitText = rowEl ? (rowEl.querySelector('td:nth-child(7)')?.textContent || '').trim() : '';
                                        const minLevel = rowEl ? parseFloat(rowEl.getAttribute('data-min') || '0') : 0;
                                        const maxLevelCell = rowEl ? rowEl.querySelector('td:nth-child(6)') : null;
                                        const maxLevel = maxLevelCell ? parseFloat(maxLevelCell.textContent || '0') : 0;
                                        const createPayload = {
                                            item_name: targetName || targetCode,
                                            category: catText || 'General',
                                            current_stock: parseFloat(currentStock) || 0,
                                            min_level: isNaN(minLevel) ? 0 : minLevel,
                                            max_level: isNaN(maxLevel) ? (isNaN(minLevel) ? 0 : minLevel * 10) : maxLevel,
                                            unit: unitText || 'Units',
                                            description: 'Auto-created from UI to enable stock editing'
                                        };
                                        return fetch('/api/inventory', {
                                            method: 'POST',
                                            headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${authToken}` },
                                            body: JSON.stringify(createPayload)
                                        }).then(cr => cr.json().then(cj => {
                                            if (!cr.ok || cj.error) throw new Error(cj.error || 'Failed to create item');
                                            return doAdjust(cj.item.id).then(r2 => r2.json().then(j2 => ({ ok: r2.ok, data: j2 })));
                                        }));
                                    }
                                    return doAdjust(match.id).then(r2 => r2.json().then(j2 => ({ ok: r2.ok, data: j2 })));
                                });
                        }
                        throw new Error(data.error || `Failed to adjust stock (HTTP ${resp.status})`);
                    }
                    return { ok: true, data };
                })
                .then(result => {
                    if (!result || !result.ok) throw new Error((result && result.data && result.data.error) || 'Failed');
                    const data = result.data;
                    if (data.error) {
                        const msg = (data.error || '').toLowerCase();
                        if (msg.includes('admin')) return showNotification('Admin access required to adjust stock', 'error');
                        if (msg.includes('token')) return showNotification('Please login to update stock', 'error');
                        return showNotification(`Error: ${data.error}`, 'error');
                    }

                    // Update the DOM with the response
                    const row = document.querySelector(`tr[data-item-id="${itemId}"]`);
                    if (row && data.item) {
                        row.setAttribute('data-stock', data.item.current_stock);
                        const stockCell = row.querySelector('td:nth-child(4) strong');
                        if (stockCell) {
                            stockCell.textContent = data.item.current_stock;
                            // Update status colors
                            const minLevel = parseInt(row.getAttribute('data-min')) || 0;
                            if (data.item.current_stock === 0) {
                                stockCell.style.color = '#ef4444';
                            } else if (data.item.current_stock < minLevel) {
                                stockCell.style.color = '#f59e0b';
                            } else {
                                stockCell.style.color = '#10b981';
                            }
                        }

                        // Update status badge
                        const statusBadge = row.querySelector('.status-badge');
                        if (statusBadge) {
                            if (data.item.status === 'out-of-stock') {
                                statusBadge.textContent = '‚úó Out of Stock';
                                statusBadge.className = 'status-badge';
                                statusBadge.style.background = '#fecaca';
                                statusBadge.style.color = '#991b1b';
                            } else if (data.item.status === 'low-stock') {
                                statusBadge.textContent = '‚ö†Ô∏è Low Stock';
                                statusBadge.className = 'status-badge status-pending';
                            } else {
                                statusBadge.textContent = '‚úì In Stock';
                                statusBadge.className = 'status-badge status-ready';
                            }
                        }
                    }

                    showNotification(`Stock updated successfully. New quantity: ${data.item.current_stock}`, 'success');

                    if (typeof updateInventoryStats === 'function') updateInventoryStats();
                    if (typeof loadInventoryList === 'function') loadInventoryList();
                })
                .catch(error => {
                    console.error('Error updating stock:', error);
                    showNotification(`Failed to update stock: ${error.message || error}`, 'error');
                });
        }
        
        // Inventory detail and history functions
        function viewInventoryDetail(itemId) {
            // Hide inventory list, show detail view
            document.getElementById('inventoryListView').style.display = 'none';
            document.getElementById('inventoryDetailView').style.display = 'block';
            
            // Load item details
            loadInventoryDetail(itemId);
        }
        
        function showInventoryList() {
            // Hide detail view, show list view
            document.getElementById('inventoryDetailView').style.display = 'none';
            document.getElementById('inventoryFormView').style.display = 'none';
            document.getElementById('inventoryListView').style.display = 'block';
        }
        
        function showAddInventoryForm() {
            // Show the form view
            document.getElementById('inventoryListView').style.display = 'none';
            document.getElementById('inventoryFormView').style.display = 'block';
            document.getElementById('inventoryDetailView').style.display = 'none';
            
            // Reset form
            document.getElementById('inventoryDetailsForm').reset();
            
            // Generate item code (will be replaced by backend, but show placeholder)
            const itemCode = generateInventoryItemCode();
            document.getElementById('formItemCode').value = itemCode;
            document.getElementById('formItemCode').placeholder = 'Auto-generated by server';
            
            // Update form title
            document.getElementById('inventoryFormTitle').textContent = 'Add New Item';
            document.getElementById('inventoryFormCardTitle').textContent = 'Item Details';
            
            // Set submit button text
            const submitBtn = document.getElementById('inventoryFormSubmit');
            if (submitBtn) {
                submitBtn.textContent = 'Add Item';
                submitBtn.onclick = null; // Clear any edit handlers
            }
        }
        
        function generateInventoryItemCode() {
            // Try to get the highest existing ID from the table
            const table = document.querySelector('#inventoryTable tbody');
            if (!table) return 'ITM-0001';
            
            const rows = table.querySelectorAll('tr[data-item-id]');
            let maxNum = 0;
            
            rows.forEach(row => {
                const itemId = row.getAttribute('data-item-id');
                if (itemId && itemId.startsWith('ITM-')) {
                    const num = parseInt(itemId.split('-')[1]);
                    if (!isNaN(num) && num > maxNum) maxNum = num;
                }
            });
            
            // Generate new ID
            const newNum = maxNum + 1;
            return `ITM-${String(newNum).padStart(4, '0')}`;
        }
        
        function loadInventoryDetail(itemId) {
            // Sample inventory data
            const inventoryData = {
                'ITM-001': {
                    code: 'ITM-001',
                    name: 'Steel Rods',
                    category: 'Raw Materials',
                    stock: 45,
                    minLevel: 50,
                    maxLevel: 500,
                    unit: 'Units',
                    status: 'Low Stock',
                    lastUpdated: '2025-09-20',
                    description: 'High-quality steel rods for construction and manufacturing',
                    supplier: 'SteelCorp Industries',
                    location: 'Warehouse A-12',
                    cost: '$25.50 per unit'
                },
                'ITM-002': {
                    code: 'ITM-002',
                    name: 'Aluminum Sheets',
                    category: 'Raw Materials',
                    stock: 150,
                    minLevel: 100,
                    maxLevel: 300,
                    unit: 'Units',
                    status: 'In Stock',
                    lastUpdated: '2025-09-22',
                    description: 'Lightweight aluminum sheets for various applications',
                    supplier: 'AluMax Corp',
                    location: 'Warehouse B-05',
                    cost: '$18.75 per unit'
                },
                'ITM-003': {
                    code: 'ITM-003',
                    name: 'Welding Wire',
                    category: 'Tools & Equipment',
                    stock: 0,
                    minLevel: 20,
                    maxLevel: 100,
                    unit: 'Kg',
                    status: 'Out of Stock',
                    lastUpdated: '2025-09-18',
                    description: 'High-grade welding wire for metal fabrication',
                    supplier: 'WeldTech Supplies',
                    location: 'Warehouse C-08',
                    cost: '$12.30 per kg'
                },
                'ITM-004': {
                    code: 'ITM-004',
                    name: 'Steel Pipes (Finished)',
                    category: 'Finished Goods',
                    stock: 200,
                    minLevel: 150,
                    maxLevel: 400,
                    unit: 'Units',
                    status: 'In Stock',
                    lastUpdated: '2025-09-23',
                    description: 'Finished steel pipes ready for distribution',
                    supplier: 'PipeWorks Ltd',
                    location: 'Warehouse D-15',
                    cost: '$45.00 per unit'
                },
                'ITM-005': {
                    code: 'ITM-005',
                    name: 'Cutting Blades',
                    category: 'Consumables',
                    stock: 35,
                    minLevel: 30,
                    maxLevel: 100,
                    unit: 'Pcs',
                    status: 'In Stock',
                    lastUpdated: '2025-09-21',
                    description: 'Sharp cutting blades for various tools',
                    supplier: 'BladeMaster Inc',
                    location: 'Warehouse A-03',
                    cost: '$8.50 per piece'
                },
                'ITM-006': {
                    code: 'ITM-006',
                    name: 'Copper Wire',
                    category: 'Raw Materials',
                    stock: 25,
                    minLevel: 40,
                    maxLevel: 200,
                    unit: 'Kg',
                    status: 'Low Stock',
                    lastUpdated: '2025-09-19',
                    description: 'High-conductivity copper wire for electrical applications',
                    supplier: 'CopperTech Solutions',
                    location: 'Warehouse B-12',
                    cost: '$22.80 per kg'
                }
            };
            
            const item = inventoryData[itemId] || inventoryData['ITM-001'];
            
            // Update title
            document.getElementById('inventoryDetailTitle').textContent = `Item Details - ${item.code}`;
            
            // Populate item information
            document.getElementById('inventoryDetailInfo').innerHTML = `
                <div class="form-group">
                    <label class="form-label">Item Code</label>
                    <div class="form-value">${item.code}</div>
                </div>
                <div class="form-group">
                    <label class="form-label">Item Name</label>
                    <div class="form-value">${item.name}</div>
                </div>
                <div class="form-group">
                    <label class="form-label">Category</label>
                    <div class="form-value">${item.category}</div>
                </div>
                <div class="form-group">
                    <label class="form-label">Current Stock</label>
                    <div class="form-value" style="font-weight: bold; color: ${item.stock === 0 ? '#ef4444' : item.stock < item.minLevel ? '#f59e0b' : '#10b981'};">
                        ${item.stock} ${item.unit}
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Minimum Level</label>
                    <div class="form-value">${item.minLevel} ${item.unit}</div>
                </div>
                <div class="form-group">
                    <label class="form-label">Maximum Level</label>
                    <div class="form-value">${item.maxLevel} ${item.unit}</div>
                </div>
                <div class="form-group">
                    <label class="form-label">Status</label>
                    <div class="form-value">
                        <span class="status-badge ${item.status === 'In Stock' ? 'status-ready' : item.status === 'Low Stock' ? 'status-pending' : 'status-error'}">
                            ${item.status === 'In Stock' ? '‚úì In Stock' : item.status === 'Low Stock' ? '‚ö†Ô∏è Low Stock' : '‚úó Out of Stock'}
                        </span>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Last Updated</label>
                    <div class="form-value">${item.lastUpdated}</div>
                </div>
                <div class="form-group">
                    <label class="form-label">Description</label>
                    <div class="form-value">${item.description}</div>
                </div>
                <div class="form-group">
                    <label class="form-label">Supplier</label>
                    <div class="form-value">${item.supplier}</div>
                </div>
                <div class="form-group">
                    <label class="form-label">Location</label>
                    <div class="form-value">${item.location}</div>
                </div>
                <div class="form-group">
                    <label class="form-label">Unit Cost</label>
                    <div class="form-value">${item.cost}</div>
                </div>
            `;
        }
        
        function viewStockHistory(itemId) {
            // Create a stock history modal
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
                background: rgba(0,0,0,0.5); z-index: 1000; display: flex; 
                align-items: center; justify-content: center;
            `;
            
            // Sample stock history data
            const historyData = {
                'ITM-001': [
                    { date: '2025-09-20', action: 'Stock Adjustment', quantity: -5, reason: 'Quality control removal', user: 'Admin' },
                    { date: '2025-09-18', action: 'Stock Received', quantity: 50, reason: 'Purchase order fulfillment', user: 'Admin' },
                    { date: '2025-09-15', action: 'Stock Used', quantity: -10, reason: 'Production order', user: 'Manager' },
                    { date: '2025-09-10', action: 'Stock Adjustment', quantity: 2, reason: 'Found in audit', user: 'Admin' }
                ],
                'ITM-002': [
                    { date: '2025-09-22', action: 'Stock Received', quantity: 100, reason: 'Regular restocking', user: 'Admin' },
                    { date: '2025-09-20', action: 'Stock Used', quantity: -25, reason: 'Production order', user: 'Manager' },
                    { date: '2025-09-18', action: 'Stock Used', quantity: -15, reason: 'Production order', user: 'Manager' },
                    { date: '2025-09-15', action: 'Stock Received', quantity: 50, reason: 'Emergency restock', user: 'Admin' }
                ],
                'ITM-003': [
                    { date: '2025-09-18', action: 'Stock Used', quantity: -20, reason: 'Production order', user: 'Manager' },
                    { date: '2025-09-15', action: 'Stock Received', quantity: 20, reason: 'Purchase order', user: 'Admin' },
                    { date: '2025-09-10', action: 'Stock Used', quantity: -15, reason: 'Production order', user: 'Manager' },
                    { date: '2025-09-05', action: 'Stock Received', quantity: 35, reason: 'Regular restocking', user: 'Admin' }
                ]
            };
            
            const history = historyData[itemId] || historyData['ITM-001'];
            
            modal.innerHTML = `
                <div style="background: white; padding: 32px; border-radius: 16px; width: 90%; max-width: 800px; max-height: 80vh; overflow-y: auto;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
                        <h3 style="font-size: 20px; font-weight: 600;">Stock History - ${itemId}</h3>
                        <button onclick="this.closest('.modal').remove()" style="background: none; border: none; font-size: 24px; cursor: pointer; color: #64748b;">√ó</button>
                    </div>
                    
                    <div class="table-container">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Action</th>
                                    <th>Quantity</th>
                                    <th>Reason</th>
                                    <th>User</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${history.map(entry => `
                                    <tr>
                                        <td>${entry.date}</td>
                                        <td><span class="status-badge ${entry.action.includes('Received') ? 'status-ready' : entry.action.includes('Used') ? 'status-pending' : 'status-warning'}">${entry.action}</span></td>
                                        <td style="color: ${entry.quantity > 0 ? '#10b981' : '#ef4444'}; font-weight: bold;">
                                            ${entry.quantity > 0 ? '+' : ''}${entry.quantity}
                                        </td>
                                        <td>${entry.reason}</td>
                                        <td>${entry.user}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                    
                    <div style="display: flex; gap: 12px; justify-content: flex-end; margin-top: 24px;">
                        <button onclick="this.closest('.modal').remove()" class="btn btn-secondary">Close</button>
                    </div>
                </div>
            `;
            
            modal.className = 'modal';
            document.body.appendChild(modal);
        }
        
        function reportEmptyStock(materialId) {
            if (confirm(`Report ${materialId} as out of stock to admin?`)) {
                showNotification(`Empty stock reported for ${materialId}. Admin will be notified for urgent restocking.`, 'success');
                // In real app, this would create an urgent notification for admin
            }
        }
        
        function requestPurchaseOrder(materialId) {
            if (confirm(`Send purchase order request for ${materialId} to admin?`)) {
                showNotification(`Purchase order request sent for ${materialId}. Admin will review and process.`, 'success');
                // In real app, this would create a purchase request for admin approval
            }
        }
        
        function checkOrderStatus(materialId) {
            showNotification(`Checking order status for ${materialId}...`, 'info');
            setTimeout(() => {
                showNotification(`Order status: In progress. Expected delivery within 5-7 business days.`, 'success');
            }, 1500);
            // In real app, this would fetch actual order status from supplier/system
        }
        
        function requestDeliveryUpdate(orderId) {
            if (confirm(`Request delivery status update for order ${orderId}?`)) {
                showNotification(`Delivery update requested for ${orderId}. Supplier will be contacted.`, 'success');
                // In real app, this would contact supplier or update system
            }
        }
        
        function editRawMaterialStock(materialId) {
            const material = rawMaterialsData[materialId];
            if (!material) {
                showNotification('Material not found!', 'error');
                return;
            }
            
            // Open stock adjustment modal
            document.getElementById('stockAdjustMaterialId').textContent = materialId;
            document.getElementById('stockAdjustMaterialName').value = material.name;
            document.getElementById('stockAdjustCurrentStock').textContent = material.stock;
            document.getElementById('stockAdjustUnit').textContent = material.unit;
            document.getElementById('stockAdjustmentModal').style.display = 'block';
        }
        
        function closeStockAdjustmentModal() {
            document.getElementById('stockAdjustmentModal').style.display = 'none';
            document.getElementById('stockAdjustmentForm').reset();
        }
        
        function viewRawMaterialDetail(materialId) {
            const material = rawMaterialsData[materialId];
            if (!material) {
                showNotification('Material not found!', 'error');
                return;
            }
            
            // Open edit modal in view mode
            document.getElementById('rawMaterialEditTitle').textContent = `View Material - ${materialId}`;
            document.getElementById('editRawMaterialId').value = material.id;
            document.getElementById('editRawMaterialName').value = material.name;
            document.getElementById('editRawMaterialCategory').value = material.category;
            document.getElementById('editRawMaterialUnit').value = material.unit;
            document.getElementById('editRawMaterialStock').value = material.stock;
            document.getElementById('editRawMaterialPrice').value = material.price;
            document.getElementById('editRawMaterialMinLevel').value = material.minLevel;
            document.getElementById('editRawMaterialTotalValue').value = `$${(material.stock * material.price).toFixed(2)}`;
            document.getElementById('editRawMaterialSupplier').value = material.supplier || '';
            document.getElementById('editRawMaterialDescription').value = material.description || '';
            
            // Make form read-only for viewing
            const form = document.getElementById('rawMaterialEditForm');
            const inputs = form.querySelectorAll('input, select, textarea');
            inputs.forEach(input => {
                if (input.id !== 'editRawMaterialId' && input.id !== 'editRawMaterialTotalValue') {
                    input.setAttribute('readonly', true);
                    input.style.background = '#f1f5f9';
                }
            });
            
            // Hide submit button, show close button only
            form.querySelector('button[type="submit"]').style.display = 'none';
            form.querySelector('button[type="submit"]').previousElementSibling.textContent = 'Close';
            
            document.getElementById('rawMaterialEditModal').style.display = 'block';
        }
        
        function editRawMaterial(materialId) {
            const material = rawMaterialsData[materialId];
            if (!material) {
                showNotification('Material not found!', 'error');
                return;
            }
            
            document.getElementById('rawMaterialEditTitle').textContent = `Edit Material - ${materialId}`;
            document.getElementById('editRawMaterialId').value = material.id;
            document.getElementById('editRawMaterialName').value = material.name;
            document.getElementById('editRawMaterialCategory').value = material.category;
            document.getElementById('editRawMaterialUnit').value = material.unit;
            document.getElementById('editRawMaterialStock').value = material.stock;
            document.getElementById('editRawMaterialPrice').value = material.price;
            document.getElementById('editRawMaterialMinLevel').value = material.minLevel;
            document.getElementById('editRawMaterialTotalValue').value = `$${(material.stock * material.price).toFixed(2)}`;
            document.getElementById('editRawMaterialSupplier').value = material.supplier || '';
            document.getElementById('editRawMaterialDescription').value = material.description || '';
            
            // Make form editable
            const form = document.getElementById('rawMaterialEditForm');
            const inputs = form.querySelectorAll('input, select, textarea');
            inputs.forEach(input => {
                if (input.id !== 'editRawMaterialId' && input.id !== 'editRawMaterialTotalValue') {
                    input.removeAttribute('readonly');
                    input.style.background = '';
                }
            });
            
            // Show submit button
            form.querySelector('button[type="submit"]').style.display = 'inline-flex';
            form.querySelector('button[type="submit"]').previousElementSibling.textContent = 'Cancel';
            
            document.getElementById('rawMaterialEditModal').style.display = 'block';
        }
        
        function closeRawMaterialEditModal() {
            document.getElementById('rawMaterialEditModal').style.display = 'none';
        }
        
        function deleteRawMaterial(materialId) {
            if (confirm(`Are you sure you want to delete material ${materialId}? This action cannot be undone.`)) {
                if (rawMaterialsData[materialId]) {
                    delete rawMaterialsData[materialId];
                    updateRawMaterialsDisplay();
                    showNotification(`Material ${materialId} deleted successfully!`, 'success');
                } else {
                    showNotification(`Material ${materialId} not found!`, 'error');
                }
            }
        }
        
        function updateRawMaterialsDisplay() {
            const tableBody = document.querySelector('#currentRawMaterialsTable tbody');
            if (!tableBody) return;
            
            tableBody.innerHTML = '';
            
            Object.values(rawMaterialsData).forEach(material => {
                const totalValue = (material.stock * material.price).toFixed(2);
                let statusBadge = '';
                let stockColor = '';
                
                if (material.stock === 0) {
                    statusBadge = '<span class="status-badge" style="background: #fecaca; color: #991b1b;">‚úó Out of Stock</span>';
                    stockColor = '#ef4444';
                } else if (material.stock <= material.minLevel) {
                    statusBadge = '<span class="status-badge status-pending">‚ö†Ô∏è Low Stock</span>';
                    stockColor = '#f59e0b';
                } else {
                    statusBadge = '<span class="status-badge status-ready">‚úì In Stock</span>';
                    stockColor = '#10b981';
                }
                
                const row = document.createElement('tr');
                row.setAttribute('data-material-id', material.id);
                row.setAttribute('data-category', material.category);
                row.innerHTML = `
                    <td><strong>${material.id}</strong></td>
                    <td>${material.name}</td>
                    <td>${material.category.charAt(0).toUpperCase() + material.category.slice(1)}</td>
                    <td><strong style="color: ${stockColor};">${material.stock}</strong></td>
                    <td>${material.unit}</td>
                    <td>$${material.price.toFixed(2)}</td>
                    <td>$${totalValue}</td>
                    <td>${material.minLevel}</td>
                    <td>${statusBadge}</td>
                    <td>${new Date().toISOString().split('T')[0]}</td>
                    <td>
                        <button class="btn btn-secondary btn-sm" onclick="viewRawMaterialDetail('${material.id}')">View</button>
                        <button class="btn btn-warning btn-sm admin-only" onclick="editRawMaterial('${material.id}')">Edit</button>
                        <button class="btn btn-success btn-sm admin-only" onclick="editRawMaterialStock('${material.id}')">Stock</button>
                        <button class="btn btn-danger btn-sm admin-only" onclick="deleteRawMaterial('${material.id}')">Delete</button>
                        <button class="btn btn-info btn-sm manager-feature" onclick="requestStockUpdate('${material.id}')">Request Update</button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
            
            // Update statistics
            updateRawMaterialStats();
        }
        
        function updateRawMaterialStats() {
            const materials = Object.values(rawMaterialsData);
            const totalMaterials = materials.length;
            const totalValue = materials.reduce((sum, material) => sum + (material.stock * material.price), 0);
            const lowStockItems = materials.filter(material => material.stock > 0 && material.stock <= material.minLevel).length;
            const outOfStockItems = materials.filter(material => material.stock === 0).length;
            
            document.getElementById('totalCurrentMaterials').textContent = totalMaterials;
            document.getElementById('totalCurrentValue').textContent = `$${totalValue.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ',')}`;
            document.getElementById('lowStockCurrentMaterials').textContent = lowStockItems;
            document.getElementById('outOfStockCurrentMaterials').textContent = outOfStockItems;
        }
        
        function addRequiredMaterialToTable(data) {
            const tableBody = document.querySelector('#requiredRawMaterialsTable tbody');
            if (!tableBody) return;
            
            let priorityBadge = '';
            let priorityStyle = '';
            
            switch(data.priority) {
                case 'high':
                case 'critical':
                    priorityBadge = '<span class="status-badge" style="background: #fecaca; color: #991b1b;">High</span>';
                    break;
                case 'medium':
                    priorityBadge = '<span class="status-badge" style="background: #fef3c7; color: #92400e;">Medium</span>';
                    break;
                case 'low':
                    priorityBadge = '<span class="status-badge" style="background: #ecfdf5; color: #065f46;">Low</span>';
                    break;
            }
            
            const row = document.createElement('tr');
            row.setAttribute('data-material-id', data.id);
            row.setAttribute('data-category', data.category);
            row.setAttribute('data-priority', data.priority);
            row.innerHTML = `
                <td><strong>${data.id}</strong></td>
                <td>${data.name}</td>
                <td>${data.category.charAt(0).toUpperCase() + data.category.slice(1)}</td>
                <td>${data.requiredQuantity}</td>
                <td>0</td>
                <td><strong style="color: #ef4444;">${data.requiredQuantity}</strong></td>
                <td>${data.unit}</td>
                <td>$${data.estimatedCost.toFixed(2)}</td>
                <td>${data.requiredBy}</td>
                <td>${priorityBadge}</td>
                <td><span class="status-badge status-pending">Pending Order</span></td>
                <td>
                    <button class="btn btn-success btn-sm admin-only" onclick="orderRawMaterial('${data.id}')">Order Now</button>
                    <button class="btn btn-secondary btn-sm" onclick="viewRequiredMaterialDetail('${data.id}')">Details</button>
                </td>
            `;
            tableBody.appendChild(row);
        }
        
        function addUpcomingOrderToTable(data) {
            const tableBody = document.querySelector('#upcomingRawMaterialsTable tbody');
            if (!tableBody) return;
            
            let statusBadge = '';
            
            switch(data.status) {
                case 'ordered':
                    statusBadge = '<span class="status-badge status-pending">Ordered</span>';
                    break;
                case 'confirmed':
                    statusBadge = '<span class="status-badge status-processing">Confirmed</span>';
                    break;
                case 'shipped':
                    statusBadge = '<span class="status-badge status-processing">Shipped</span>';
                    break;
                case 'in-transit':
                    statusBadge = '<span class="status-badge status-ready">In Transit</span>';
                    break;
            }
            
            const row = document.createElement('tr');
            row.setAttribute('data-order-id', data.id);
            row.setAttribute('data-status', data.status);
            row.innerHTML = `
                <td><strong>${data.id}</strong></td>
                <td>${data.materialName}</td>
                <td>${data.category.charAt(0).toUpperCase() + data.category.slice(1)}</td>
                <td>${data.quantity}</td>
                <td>${data.unit}</td>
                <td>${data.supplier}</td>
                <td>${data.orderDate}</td>
                <td>${data.deliveryDate}</td>
                <td>$${data.unitPrice.toFixed(2)}</td>
                <td>$${data.totalCost.toFixed(2)}</td>
                <td>${statusBadge}</td>
                <td>
                    <button class="btn btn-secondary btn-sm" onclick="trackDelivery('${data.id}')">Track</button>
                    <button class="btn btn-warning btn-sm admin-only" onclick="editUpcomingOrder('${data.id}')">Edit</button>
                </td>
            `;
            tableBody.appendChild(row);
        }
        
        // Load profile data when profile page is accessed
        document.addEventListener('DOMContentLoaded', function() {
            // Add event listener for profile tab
            const profileTab = document.querySelector('[data-page="profile"]');
            if (profileTab) {
                profileTab.addEventListener('click', function() {
                    setTimeout(loadProfileData, 100); // Small delay to ensure page is shown
                });
            }
            
            // Add event listeners for raw material tabs
            document.querySelectorAll('.raw-material-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabName = this.getAttribute('data-raw-tab');
                    switchRawMaterialTab(tabName);
                });
            });
            
            // Add form submission handlers for raw material modals
            document.getElementById('rawMaterialAddForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const formData = {
                    id: document.getElementById('addRawMaterialId').value,
                    name: document.getElementById('addRawMaterialName').value,
                    category: document.getElementById('addRawMaterialCategory').value,
                    stock: parseFloat(document.getElementById('addRawMaterialStock').value),
                    unit: document.getElementById('addRawMaterialUnit').value,
                    price: parseFloat(document.getElementById('addRawMaterialPrice').value),
                    minLevel: parseFloat(document.getElementById('addRawMaterialMinLevel').value),
                    supplier: document.getElementById('addRawMaterialSupplier').value,
                    description: document.getElementById('addRawMaterialDescription').value
                };
                
                if (!formData.name || !formData.category || !formData.unit || isNaN(formData.stock) || isNaN(formData.price) || isNaN(formData.minLevel)) {
                    showNotification('Please fill in all required fields!', 'error');
                    return;
                }
                
                rawMaterialsData[formData.id] = formData;
                updateRawMaterialsDisplay();
                closeRawMaterialAddModal();
                showNotification(`Material ${formData.id} added successfully!`, 'success');
            });
            
            document.getElementById('rawMaterialEditForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const materialId = document.getElementById('editRawMaterialId').value;
                const formData = {
                    id: materialId,
                    name: document.getElementById('editRawMaterialName').value,
                    category: document.getElementById('editRawMaterialCategory').value,
                    stock: parseFloat(document.getElementById('editRawMaterialStock').value),
                    unit: document.getElementById('editRawMaterialUnit').value,
                    price: parseFloat(document.getElementById('editRawMaterialPrice').value),
                    minLevel: parseFloat(document.getElementById('editRawMaterialMinLevel').value),
                    supplier: document.getElementById('editRawMaterialSupplier').value,
                    description: document.getElementById('editRawMaterialDescription').value
                };
                
                if (!formData.name || !formData.category || !formData.unit || isNaN(formData.stock) || isNaN(formData.price) || isNaN(formData.minLevel)) {
                    showNotification('Please fill in all required fields!', 'error');
                    return;
                }
                
                rawMaterialsData[materialId] = formData;
                updateRawMaterialsDisplay();
                closeRawMaterialEditModal();
                showNotification(`Material ${materialId} updated successfully!`, 'success');
            });
            
            document.getElementById('stockAdjustmentForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const materialId = document.getElementById('stockAdjustMaterialId').textContent;
                const material = rawMaterialsData[materialId];
                const adjustmentType = document.getElementById('stockAdjustmentType').value;
                const quantity = parseFloat(document.getElementById('stockAdjustmentQuantity').value);
                const reason = document.getElementById('stockAdjustmentReason').value;
                
                if (!adjustmentType || isNaN(quantity) || !reason) {
                    showNotification('Please fill in all required fields!', 'error');
                    return;
                }
                
                let newStock = material.stock;
                
                switch (adjustmentType) {
                    case 'add':
                        newStock += quantity;
                        break;
                    case 'remove':
                        newStock = Math.max(0, newStock - quantity);
                        break;
                    case 'set':
                        newStock = quantity;
                        break;
                }
                
                material.stock = newStock;
                updateRawMaterialsDisplay();
                closeStockAdjustmentModal();
                
                const actionText = adjustmentType === 'add' ? 'added to' : adjustmentType === 'remove' ? 'removed from' : 'set for';
                showNotification(`Stock ${actionText} ${materialId}. New stock: ${newStock} ${material.unit}`, 'success');
            });
            
            // Auto-calculate total value in forms
            function calculateTotalValue(stockId, priceId, totalId) {
                const stockInput = document.getElementById(stockId);
                const priceInput = document.getElementById(priceId);
                const totalInput = document.getElementById(totalId);
                
                function updateTotal() {
                    const stock = parseFloat(stockInput.value) || 0;
                    const price = parseFloat(priceInput.value) || 0;
                    const total = (stock * price).toFixed(2);
                    totalInput.value = `$${total}`;
                }
                
                stockInput.addEventListener('input', updateTotal);
                priceInput.addEventListener('input', updateTotal);
            }
            
            calculateTotalValue('addRawMaterialStock', 'addRawMaterialPrice', 'addRawMaterialTotalValue');
            calculateTotalValue('editRawMaterialStock', 'editRawMaterialPrice', 'editRawMaterialTotalValue');
            calculateTotalValue('addReqQuantity', 'addReqPrice', 'addReqTotalCost');
            calculateTotalValue('addUpcomingQuantity', 'addUpcomingPrice', 'addUpcomingTotalCost');
            
            // Auto-calculate new stock level in adjustment modal
            function updateNewStockLevel() {
                const currentStock = parseFloat(document.getElementById('stockAdjustCurrentStock').textContent) || 0;
                const adjustmentType = document.getElementById('stockAdjustmentType').value;
                const quantity = parseFloat(document.getElementById('stockAdjustmentQuantity').value) || 0;
                const unit = document.getElementById('stockAdjustUnit').textContent;
                
                let newStock = currentStock;
                
                switch (adjustmentType) {
                    case 'add':
                        newStock = currentStock + quantity;
                        break;
                    case 'remove':
                        newStock = Math.max(0, currentStock - quantity);
                        break;
                    case 'set':
                        newStock = quantity;
                        break;
                }
                
                document.getElementById('stockAdjustNewLevel').value = `${newStock} ${unit}`;
            }
            
            document.getElementById('stockAdjustmentType').addEventListener('change', updateNewStockLevel);
            document.getElementById('stockAdjustmentQuantity').addEventListener('input', updateNewStockLevel);
            
            // Add Required Material Form Handler
            document.getElementById('addRequiredMaterialForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const formData = {
                    id: document.getElementById('addReqMaterialId').value,
                    name: document.getElementById('addReqMaterialName').value,
                    category: document.getElementById('addReqMaterialCategory').value,
                    unit: document.getElementById('addReqMaterialUnit').value,
                    requiredQuantity: parseFloat(document.getElementById('addReqQuantity').value),
                    estimatedPrice: parseFloat(document.getElementById('addReqPrice').value) || 0,
                    requiredBy: document.getElementById('addReqDate').value,
                    priority: document.getElementById('addReqPriority').value,
                    description: document.getElementById('addReqDescription').value,
                    estimatedCost: (parseFloat(document.getElementById('addReqQuantity').value) || 0) * (parseFloat(document.getElementById('addReqPrice').value) || 0)
                };
                
                if (!formData.name || !formData.category || !formData.unit || isNaN(formData.requiredQuantity) || !formData.requiredBy || !formData.priority) {
                    showNotification('Please fill in all required fields!', 'error');
                    return;
                }
                
                // Add to required materials table (in a real app, this would be stored in database)
                addRequiredMaterialToTable(formData);
                closeAddRequiredMaterialModal();
                showNotification(`Material requirement ${formData.id} added successfully!`, 'success');
            });
            
            // Add Upcoming Order Form Handler
            document.getElementById('addUpcomingOrderForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const formData = {
                    id: document.getElementById('addUpcomingOrderId').value,
                    materialName: document.getElementById('addUpcomingMaterialName').value,
                    category: document.getElementById('addUpcomingCategory').value,
                    unit: document.getElementById('addUpcomingUnit').value,
                    quantity: parseFloat(document.getElementById('addUpcomingQuantity').value),
                    unitPrice: parseFloat(document.getElementById('addUpcomingPrice').value),
                    supplier: document.getElementById('addUpcomingSupplier').value,
                    orderDate: document.getElementById('addUpcomingOrderDate').value,
                    deliveryDate: document.getElementById('addUpcomingDeliveryDate').value,
                    status: document.getElementById('addUpcomingStatus').value,
                    notes: document.getElementById('addUpcomingNotes').value,
                    totalCost: (parseFloat(document.getElementById('addUpcomingQuantity').value) || 0) * (parseFloat(document.getElementById('addUpcomingPrice').value) || 0)
                };
                
                if (!formData.materialName || !formData.category || !formData.unit || isNaN(formData.quantity) || isNaN(formData.unitPrice) || !formData.supplier || !formData.deliveryDate) {
                    showNotification('Please fill in all required fields!', 'error');
                    return;
                }
                
                // Add to upcoming orders table (in a real app, this would be stored in database)
                addUpcomingOrderToTable(formData);
                closeAddUpcomingOrderModal();
                showNotification(`Purchase order ${formData.id} created successfully!`, 'success');
            });
            
            // Initialize raw materials display
            setTimeout(() => {
                updateRawMaterialsDisplay();
                if (typeof loadOrdersList === 'function') {
                    loadOrdersList();
                }
            }, 100);

            // Wire up New Order form if present
            const orderForm = document.getElementById('orderForm') || document.querySelector('[data-form="order"]');
            if (orderForm) {
                orderForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    const token = getAuthToken();
                    if (!token) { showNotification('Please login as admin to create orders', 'error'); return; }

                    function val(sel) {
                        const el = document.getElementById(sel) || document.querySelector(`[name="${sel}"]`) || document.querySelector(`[data-field="${sel}"]`);
                        return el ? el.value : '';
                    }

                    const rawQuantity = val('orderQuantity');
                    const rawUnitPrice = val('orderUnitPrice');
                    let deadline = val('orderDeadline');
                    // Attempt to normalize date if user typed DD/MM/YYYY
                    if (deadline && deadline.includes('/') && deadline.split('/').length === 3) {
                        const [d, m, y] = deadline.split('/');
                        if (y && m && d && y.length === 4) deadline = `${y}-${m.padStart(2,'0')}-${d.padStart(2,'0')}`;
                    }

                    const payload = {
                        customer_name: val('orderCustomerName'),
                        product: val('orderProduct'),
                        quantity: parseFloat(rawQuantity),
                        deadline: deadline,
                        unit_price: rawUnitPrice ? parseFloat(rawUnitPrice) : undefined,
                        priority: val('orderPriority') || 'medium',
                        special_instructions: val('orderInstructions') || undefined
                    };

                    if (!payload.customer_name || !payload.product || isNaN(payload.quantity) || payload.quantity <= 0 || !payload.deadline) {
                        showNotification('Please fill all required fields (customer, product, quantity>0, deadline YYYY-MM-DD)', 'error');
                        return;
                    }

                    fetch('/api/orders', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${token}` },
                        body: JSON.stringify(payload)
                    })
                    .then(async r => {
                        const res = await r.json().catch(() => ({}));
                        if (!r.ok || res.error) {
                            if (r.status === 403) {
                                showNotification('Admin access required to create orders', 'error');
                            } else if (r.status === 400) {
                                showNotification(res.error || 'Invalid data. Check required fields and date format (YYYY-MM-DD).', 'error');
                            } else {
                                showNotification(res.error || 'Failed to create order. Please try again.', 'error');
                            }
                            return;
                        }
                        showNotification('Order created successfully', 'success');
                        if (typeof loadOrdersList === 'function') loadOrdersList();
                        // Optional: reset form
                        try { orderForm.reset(); } catch (_) {}
                    })
                    .catch(err => { console.error(err); showNotification('Failed to create order', 'error'); });
                });
            }
        });
    </script>
</body>
</html>